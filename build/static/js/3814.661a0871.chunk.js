!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=(new Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="0902a32f-1667-4b2e-bac2-79a8b2d97375",e._sentryDebugIdIdentifier="sentry-dbid-0902a32f-1667-4b2e-bac2-79a8b2d97375")}catch(e){}}();var _global="undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:{};_global.SENTRY_RELEASE={id:"a086bfaddc61e7dbbcac0a9c42145052439dbbf3"},(self.webpackChunkkennekt_front_end_client=self.webpackChunkkennekt_front_end_client||[]).push([[3814],{3814:function(e,t,n){n.r(t),n.d(t,{default:function(){return ln}});var i=n(70885),a=n(72791),s=n(85880),r=n(22553),l=n(40084),o=n(31102),d=n(27945),c=n(42339),u=n(26864),m=n(55248),h=n(26181),p=n.n(h),v=n(78820),f=n(9478),g=n(80184),x="".concat(f.Z.PUBLIC_ASSETS,"img");function _(e){var t=e.onSuccess,n=e.setFieldValue,s=e.isSubmitting,r=e.values,l=e.isEditing,o=void 0!==l&&l,d=(0,a.useState)(null),h=(0,i.Z)(d,2),f=h[0],_=h[1],b=(0,a.useState)(!1),y=(0,i.Z)(b,2),j=y[0],Z=y[1],w=(0,a.useState)(o?r.image:null),C=(0,i.Z)(w,2),N=C[0],S=C[1];return(0,a.useEffect)((function(){N&&n("image",N)}),[N]),(0,g.jsxs)("div",{children:[(0,g.jsx)("h2",{className:"mb-4 text-xl font-bold",children:"".concat(o?"Edit":"Create"," Group Chat")}),(0,g.jsx)(u.gN,{label:"Group chat title",labelClasses:"ml-6 text-xs font-light text-kgrey-welcome mb-2 block",name:"title",component:c.Mg,placeholder:"Group chat title",required:!0,autoComplete:"off",maxLength:100}),(0,g.jsx)(u.gN,{label:"Group description",labelClasses:"ml-6 text-xs font-light text-kgrey-welcome mb-2 block",placeholder:"Type Group Description",name:"description",component:c.Mg,type:"textarea",autoComplete:"off",maxLength:250}),(0,g.jsxs)("div",{className:"mb-4 flex items-center",children:[(0,g.jsx)("div",{className:"mr-4",children:(0,g.jsx)(m.bA,{uploadMeta:f,setUploadMeta:_,cancelSending:j,setCancelSending:Z,setFile:S})}),(0,g.jsxs)("div",{className:"user-avatar-box__display relative h-20 w-20 overflow-hidden rounded-full",children:[(0,g.jsx)("img",{src:p()(N,"thumbnail_150")||"".concat(x,"/chat-placeholder.svg"),alt:"",className:"h-full object-cover"}),null!==f&&(0,g.jsxs)("div",{className:"absolute top-1/2 left-1/2 z-10 h-10 w-10 -translate-y-1/2 -translate-x-1/2",children:[(0,g.jsx)("div",{className:"upload-media-spinner",children:(0,g.jsx)(m.aN,{variant:"determinate",value:f})}),(0,g.jsx)("div",{onClick:function(){Z(!0),_(null)},className:"absolute top-[21px] left-[25px] z-20 h-8 w-8 -translate-y-1/2 -translate-x-1/2 cursor-pointer text-3xl text-primary-dark transition hover:text-primary",children:(0,g.jsx)(v.SV5,{})})]})]})]}),(0,g.jsxs)("div",{className:"btn-row mt-6 flex justify-end",children:[s&&(0,g.jsx)(m.aN,{tiled:!0,withOverlay:!0}),(0,g.jsx)(m.zx,{className:"mr-5 border border-kgrey text-kgrey",type:"button",onClickHandler:t,children:"Cancel"}),(0,g.jsx)(m.Ik,{type:"submit",className:"ml-4 dark:text-white dark:hover:bg-primary-300 dark:focus:ring-primary-300",color:"primary",isDisabled:s||!!f,children:o?"Edit Group Chat":"Create Group Chat"})]})]})}function b(e){var t=e.onSuccess,n=(0,l.m)(),i=n.companyId,a=n.groupSearchQuery,s=(0,o.Kx)().changeUrlParams;return(0,g.jsx)(d.Z.Main,{entity:"ims-chats",name:"AllImsChats-".concat(i,"-").concat(a),url:"/".concat(i,"/ims/groups/"),method:"post",primaryKey:"id",sendAsFormData:!1,normalizeData:function(e){return e},prependData:!0,fields:[{name:"title",required:!0,value:"",onSubmitKey:""},{name:"description",value:"",onSubmitKey:""},{name:"image",onSubmitKey:"",type:"object"}],onSuccess:function(e,n){s({chat:e.id}),t(),n()},onError:function(e,t){console.log(e)},children:function(e){var n=e.isSubmitting,i=e.values,a=e.setFieldValue;return(0,g.jsx)(_,{onSuccess:t,isSubmitting:n,setFieldValue:a,values:i})}})}var y=n(8826),j=n(84373),Z=n(39126);function w(e){var t,n=e.toggleIsUnreadFilter,d=e.isUnreadFilter,c=(0,a.useState)(""),u=(0,i.Z)(c,2),m=u[0],h=u[1],p=(0,r.Z)(m,500),f=(0,i.Z)(p,1)[0],x=(0,l.m)(),_=x.setGroupSearchQuery,w=x.groupsUnreadCountData,C=(0,o.dF)(),N=C.open,S=C.modalHandler,k=C.WhiteModal,M=null===(t=Object.values(w))||void 0===t?void 0:t.filter((function(e){return e>0})).length;return(0,a.useEffect)((function(){_(f)}),[f]),(0,g.jsxs)("div",{className:"mb-4 flex",children:[M?(0,g.jsx)("div",{onClick:function(){return n()},className:"relative mr-3 mt-1.5 cursor-pointer rounded-10 bg-kgrey-dark-2 p-2",children:d?(0,g.jsx)(v.n5H,{}):(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)("span",{className:"absolute -top-1 left-1.5 right-1.5 rounded-md bg-kred-pink text-center text-10px text-white",children:M}),(0,g.jsx)(Z.nzA,{})]})}):null,(0,g.jsxs)("div",{className:"group-sidebar__search relative flex-grow  pr-2",children:[(0,g.jsx)("input",{type:"search",value:m,className:"group-sidebar__search-input w-full border-b outline-none border-kgrey-border-solid pl-7 transition focus:border-primary placeholder-[rgba(45, 45, 45, 0.3)] py-2 dark:bg-kdark dark:text-white",placeholder:"Search for chats",onChange:function(e){return h(e.target.value)}}),(0,g.jsx)("div",{className:"absolute top-1/2 left-0 -translate-y-1/2",children:(0,g.jsx)("div",{className:"text-kgrey",children:(0,g.jsx)(s.lnn,{})})})]}),(0,g.jsx)(y.Z,{color:"primary",size:"small",onClick:S,children:(0,g.jsx)(j.D0w,{className:"text-2xl text-white"})}),(0,g.jsx)(k,{handleModalOpen:S,open:N,children:(0,g.jsx)(b,{onSuccess:S})})]})}var C=n(1413),N=n(42982),S=n(28175),k=n(30168),M=n(28182),I=n(52554),D=n(92005),F=n(26e3),A=n(72248),E=n(38145),P=n(84230),R=n(51859),O=n(76525),L=n(32380),B=n(87818),U=L.Z.entities.updateEntitiesSuccess;function T(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=(0,a.useState)(null),r=(0,i.Z)(s,2),d=r[0],c=r[1],u=(0,a.useState)(!1),m=(0,i.Z)(u,2),h=m[0],p=m[1],v=(0,l.m)(),f=v.companyId,g=(v.toggleChatPanel,Boolean(d)),x=(0,B.I0)(),_=function(e){c(e.currentTarget)},b=(0,o.bK)({url:"/".concat(f,"/ims/groups/").concat(t,"/pin/"),method:"".concat(e?"delete":"put"),cb:{success:function(e,a){var s=(0,i.Z)(a,1)[0];x(U({entity:"ims-chats",entityId:String(t),data:{pin_time:s?Date.now():null}})),n&&x(U({entity:"ims-chats",entityId:String(t),data:{pin_time:s?Date.now():null}}))},error:function(e){}}}),y=b.fetchData,j=function(e,t){"clickaway"!==t&&p(!1)},Z=function(e){switch(e){case"pin":y(!0);break;case"unpin":y(!1);break;default:return null}},w=function(){c(null)};return{open:g,handleClick:_,anchorEl:d,managerRequested:h,handleNotificationClose:j,handleMenuItemClick:Z,handleCloseMenu:w}}var G,K=n(60978),H=n(63524),W=n(64923),V="".concat(f.Z.PUBLIC_ASSETS,"img/");function Q(e){var t,n,i=e.chatId,a=e.image,s=e.title,r=e.last_message_author,d=e.last_message_type,c=e.last_message_text,u=e.last_message_time,m=e.pin_time,h=e.draftMessage,p=e.isMuted,v=void 0!==p&&p,f=e.lastReadMessage,g=void 0===f?null:f,x=(0,l.m)(),_=x.groupsUnreadCountData,b=x.setActiveDraft,y=x.chatsMentionList,j=x.scheduledMessageIds,Z=x.setChatUuid,w=(0,o.Kx)(),N=w.changeUrlParams,S=w.query,L=T(m,i),B=L.open,U=L.handleClick,Q=L.anchorEl,q=L.handleMenuItemClick,z=L.handleCloseMenu,X=S&&Number(S.chat)===i,$=a||"".concat(V,"chat-placeholder.png"),Y=null===_||void 0===_?void 0:_[i],J=null===y||void 0===y||null===(t=y[i])||void 0===t?void 0:t.length,ee=null===j||void 0===j||null===(n=j[i])||void 0===n?void 0:n.length;return(0,W.tZ)("div",{className:(0,M.Z)("chat-item mb-3 cursor-pointer rounded-lg p-2 transition hover:opacity-80 ",{"bg-primary-300 dark:bg-primary-300":X,"dark:bg-white/10":!X}),children:(0,W.BX)("div",{className:"chat-item__inner flex w-full items-center justify-between",children:[(0,W.tZ)("div",{className:"chat-item__img h-14 w-14 flex-shrink-0 overflow-hidden rounded-full",children:(0,W.tZ)("img",{src:$,alt:"",className:"h-full object-cover"})}),(0,W.BX)("div",{className:"chat-item__body flex flex-grow items-center justify-between pl-2",css:(0,I.iv)(G||(G=(0,k.Z)(["\n\t\t\t\t\t\twidth: 275px;\n\t\t\t\t\t"]))),children:[(0,W.BX)("div",{className:"chat-item__content w-9/12 overflow-hidden pr-2",onClick:function(){N((0,C.Z)({chat:i},(0,C.Z)({},g&&Y?{unread:g,hasUnreadMessage:!0,lastReadMessage:g}:{}))),Z((0,D.x0)()),b(h)},children:[(0,W.BX)("div",{className:"chat-item__title flex-center-y truncate text-sm font-semibold dark:text-white",children:[(0,W.tZ)("span",{children:s}),v&&(0,W.tZ)("span",{className:"ml-1 block h-4 w-4 text-kgrey",children:(0,W.tZ)(O.vP,{})})]}),(0,W.tZ)("div",{className:"chat-item__muted",children:r?(0,W.tZ)(F.cm,{last_message_type:d,last_message_text:c||"",last_message_author:r,draftMessage:h}):null})]}),(0,W.BX)("div",{className:"chat-item__info  flex w-3/12 flex-shrink-0 flex-col  items-end",children:[(0,W.BX)("div",{className:"chat-item___actions mb-2.5 flex items-center justify-between",children:[(0,W.tZ)("div",{className:"chat-item__date text-[10px] font-bold text-kgrey-chatGrey/30 dark:text-white",children:A.XV.toLastTime(u)}),(0,W.BX)("div",{className:"chat-item__dots",children:[(0,W.tZ)("div",{className:"more-btn w-4 cursor-pointer text-right text-kgrey-menuText transition-colors hover:text-primary dark:text-white dark:hover:text-primary",onClick:U,children:(0,W.tZ)(E.i,{className:"inline"})}),(0,W.tZ)(P.v2,{id:"long-menu",anchorEl:Q,keepMounted:!0,open:B,onClose:z,children:(0,W.tZ)(R.Z,{onClick:function(){z(),q(m?"unpin":"pin")},children:"".concat(m?"Unpin":"Pin"," Chat")})})]})]}),(0,W.BX)("div",{className:"chat-item___pin mt-auto flex items-center justify-end leading-none",children:[ee?(0,W.tZ)("div",{className:"chat-item__scheduled-icon mr-1.5 items-start text-xl dark:text-white",children:(0,W.tZ)(H.lPB,{})}):null,m?(0,W.tZ)(O.Dg,{className:"text-kgrey-menuText"}):null,Y?(0,W.tZ)("div",{className:(0,M.Z)("ml-2 h-6 w-6  rounded-full text-center text-sm font-semibold leading-6 text-white",{"bg-primary":!v,"bg-kgrey":v}),children:Y}):null,J?(0,W.tZ)("div",{className:" px-1 text-lg text-primary",children:(0,W.tZ)(K.Hlc,{})}):null]})]})]})]})})}function q(e){var t=e.chatId,n=e.image,i=e.pin_time,a=e.last_message_type,s=e.last_message_text,r=e.title,l=e.last_message_author,o=e.last_message_time,d=e.isMuted,c=e.draftMessage,u=e.lastReadMessage;return(0,g.jsx)(Q,{chatId:t,title:r,image:n,last_message_author:l,last_message_type:a,last_message_text:s,last_message_time:o,pin_time:i,isMuted:d,draftMessage:c,lastReadMessage:u})}function z(e){return(0,g.jsx)(m.SV,{isCompact:!0,children:(0,g.jsx)(q,(0,C.Z)({},e))})}var X=n(35741),$=n(97689),Y=n(82486);function J(e){var t=e.isUnreadFilter,n=(0,a.useState)(1),s=(0,i.Z)(n,2),r=s[0],d=s[1],c=(0,a.useState)(1),u=(0,i.Z)(c,2),h=u[0],p=u[1],v=(0,l.m)(),f=v.companyId,x=v.groupSearchQuery,_=v.groupsUnreadCountData,b=(0,$.a)().userData,y=(0,o.Kx)().query.chat;return(0,a.useEffect)((function(){p(1),d(1)}),[x]),(0,g.jsx)("div",{className:"group-sidebar__chats flex-grow overflow-y-auto pt-2",children:f?(0,g.jsx)(X.Z.All,{entity:"ims-chats",name:"AllImsChats-".concat(f,"-").concat(x),url:"/".concat(f,"/ims/groups/"),params:{extra:(0,Y.f)(x,t),limit:Y.B,page:x.length?h:r},appendData:!0,isCancellable:!!x.length,cancelField:"groupChat",children:function(e){var n=e.items,i=e.isFetched,s=e.meta,l=n.filter((function(e){return t?_[e.id]>0||e.id.toString()===y:e})),o=(0,A.kd)(l);return(0,g.jsxs)(g.Fragment,{children:[o.map((function(e){var t,n,i;return(0,g.jsx)(a.Fragment,{children:(0,g.jsx)(z,{chatId:e.id,title:e.title,pin_time:e.pin_time,last_message_type:e.last_message_type,last_message_author:e.last_message_author,last_message_text:e.last_message_text,last_message_time:e.last_message_time,image:(null===(t=e.image)||void 0===t?void 0:t.thumbnail_150)||null,isMuted:null===e||void 0===e||null===(n=e.members)||void 0===n||null===(i=n.find((function(e){return e.user.id===b.id})))||void 0===i?void 0:i.is_mute,draftMessage:e.draft_message,lastReadMessage:e.last_read_message},e.id)},e.id)})),(0,g.jsx)(g.Fragment,{children:i?null:(0,g.jsx)(g.Fragment,{children:(0,N.Z)(Array(10)).map((function(e,t){return(0,g.jsx)("div",{className:"mb4",children:(0,g.jsx)(te,{})},t)}))})}),(0,g.jsx)(g.Fragment,{children:i&&null!==s&&void 0!==s&&s.current_page&&null!==s&&void 0!==s&&s.last_page&&(null===s||void 0===s?void 0:s.current_page)<(null===s||void 0===s?void 0:s.last_page)?(0,g.jsx)(m.$K,{setPage:function(){s.current_page!==r?d(s.current_page):x.length?p(h+1):d(r+1)}}):null})]})}}):null})}function ee(e){return(0,g.jsx)(m.SV,{children:(0,g.jsx)(J,(0,C.Z)({},e))})}function te(){return(0,g.jsxs)(S.ZP,{speed:2,width:362,height:72,viewBox:"0 0 362 72",backgroundColor:"#f3f3f3",foregroundColor:"#ecebeb",children:[(0,g.jsx)("circle",{cx:"48",cy:"33",r:"24"}),(0,g.jsx)("rect",{x:"79",y:"14",rx:"7",ry:"7",width:"217",height:"18"}),(0,g.jsx)("rect",{x:"80",y:"42",rx:"5",ry:"5",width:"155",height:"11"}),(0,g.jsx)("rect",{x:"351",y:"12",rx:"4",ry:"4",width:"12",height:"32"}),(0,g.jsx)("rect",{x:"313",y:"13",rx:"5",ry:"5",width:"30",height:"11"})]})}var ne,ie=n(96206),ae=n(9321),se=n(70629),re=n(12555),le=n(1172),oe=n(14545),de=n(44740),ce=n(46572),ue=n.n(ce),me=n(79841),he=n(30663);function pe(e){var t=e.chatId,n=(0,ae.Z)(),s=(0,i.Z)(n,2),r=s[0],d=s[1].height,c=(0,oe.O9)(),u=c.setIsDelayedMessage,m=c.isDelayedMessage,h=(0,o.JN)().afterMessagesFetchService,p=(0,l.m)(),v=(p.entityPage,p.groupsUnreadCountData),f=(0,o.Kx)().query,g=f.unread&&Number(f.unread)||null,x=!(null===v||void 0===v||!v[t]),_=(0,a.useMemo)((function(){return!(null===v||void 0===v||!v[t])}),[t]),b=(0,a.useRef)(null),y=(0,re.m)(),j=y.entityId,Z=y.isSetSearchReply,w=y.allowToLoad,C=y.setAllowToLoad,N=y.direction,S=y.messagesLimit,D=y.replyLoading,F=y.scrollToMsgId,A=(y.state,y.setScrollPosition),E=y.isMsgHasBeenIndicated,P=y.virtuosoRef,R=y.isScheduledChat,O=y.entityType,L=(0,o.QY)({entity:"ims-chats",entityId:j,entityName:"GroupChat-".concat(j,"One")}),B=(0,de.W)(),U=B.cursorTop,T=B.cursorBot,G=B.handlePageLoading,K=B.localEntityId,H=B.scrollIntoElement,V=B.isLoadedRepliedMessage,Q=B.messageVisibleHandler,q=B.setUpdateEntityPage,z=B.searchedMessageId,$=B.paginationDepsRef,Y=B.cursor,J=B.isLastPageFetched,ee=B.setIsLastPageFetched,te=B.isFirstPageFetched,ie=B.setIsFirstPageFetched,ce=B.totalMessagesCount,pe=B.removeUnreadCountFromCaseList,ve=B.messagesUrl;var fe=g&&null===N,ge=(0,me.pA)({isScheduled:R,entityId:K,entityType:O});return(0,W.tZ)(X.Z.All,{entity:"imsMessages",name:ge,url:ve,primaryKey:"custom_uuid",prependData:("next"===N||null===N)&&!Z,appendData:"previous"===N&&!Z,isUniq:!0,cursorBased:!0,direction:g&&null===N?"1":Y===Number(F)?"0":"next"===N||null===N?"-1":"1",replaceIds:V&&Y===F&&null===N||null===Y&&("next"===N||null===N)||x&&!!g,params:{limit:S,extra:{entity_id:K,cursor:Y}},onInit:function(e){h({data:e,isDelayedMessage:m,setIsDelayedMessage:u,setAllowToLoad:C,direction:N,scrollToMsgId:F,isMsgHasBeenIndicated:E,cursorTop:U,cursorBot:T,scrollIntoElement:H,setUpdateEntityPage:q,searchedMessageId:z,paginationDepsRef:$,cursor:Y,setIsLastPageFetched:ee,messagesLimit:S,setIsFirstPageFetched:ie,totalMessagesCount:ce,isLoadedRepliedMessage:V,virtuosoRef:P})},children:function(e){var n,i,a=e.items,s=e.isFetched,l=e.meta,o=null!==(n=a)&&void 0!==n?n:[],c=w||!Z;return(0,W.tZ)("div",{ref:r,id:"chat-body",className:(0,M.Z)("chat__body flex-grow"),children:(0,W.tZ)("div",{className:(0,M.Z)("h-full w-full px-5",{"pt-11":null===(i=L.item)||void 0===i?void 0:i.pinned_message}),css:(0,I.iv)(ne||(ne=(0,k.Z)(["\n\t\t\t\t\t\t\t\theight: ",";\n\t\t\t\t\t\t\t"])),se.G6&&"".concat(d,"px")),children:l?(0,W.tZ)(he.OO,{context:{isFetched:s,items:a,isSetSearchReply:Z,direction:N,replyLoading:D,isConfirmationRequired:!1},ref:P,firstItemIndex:null===l||void 0===l?void 0:l.firstItemIndex,overscan:{reverse:200,main:100},initialTopMostItemIndex:{index:fe?0:"LAST",align:"center",behavior:"auto"},atTopStateChange:function(e){e&&c&&s&&!te&&G(!0,"next",j)},atBottomStateChange:function(e){e&&(A(!0),J&&null!==v&&void 0!==v&&v[t]&&pe(),w&&s&&!J&&G(!0,"previous",j)),e||A(!1)},data:o,itemContent:function(e,t){var n,i,a,s,r,l={id:1e8,name:"Error message",text:"Error occured. This message is not valid",type:"ERROR",from_user:{}},d=o.findIndex((function(e){return e.id===t.id}));Number(null===f||void 0===f?void 0:f.lastReadMessage)===t.id&&_&&!z&&(b.current=null===(r=o[d+1])||void 0===r?void 0:r.id);var c=b.current&&t.id&&b.current===t.id,u=t?(null===t||void 0===t?void 0:t.custom_uuid)||t.id:l.id,m=(0,me.ix)({currentMsgAuthorId:t.from_user.id,prevMsgAuthorId:null===(n=o[d-1])||void 0===n?void 0:n.from_user.id,nextMsgAuthorId:null===(i=o[d+1])||void 0===i?void 0:i.from_user.id,prevMsgType:null===(a=o[d-1])||void 0===a?void 0:a.type,nextMsgType:null===(s=o[d+1])||void 0===s?void 0:s.type}),h=m.isSameFromUserWithPrev,p=m.isSameFromUserWithNext,v=(0,W.BX)(W.HY,{children:[c&&(null===o||void 0===o?void 0:o.length)>1?(0,W.tZ)("div",{className:"my-2 mx-0 w-full bg-kgrey-inputBg text-center text-kdark-424242 dark:bg-kdark-dark333 dark:text-white",children:"Unread messages"}):null,(0,W.tZ)(le.J,{message:t||l,isSameFromUserWithPrev:h,isSameFromUserWithNext:p},u)]});return(0,W.tZ)(ue(),{offset:{bottom:50},scrollDelay:50,onChange:function(e){Q(e,t)},children:(0,W.tZ)("div",{children:v})},u)},components:{Scroller:le.bt,Item:le.nN,Footer:J?void 0:le.K}}):(0,W.tZ)(le.JE,{})})})}})}function ve(e){var t=(0,a.useMemo)((function(){return e.chatId}),[e.chatId]),n=(0,a.useCallback)((function(){window.location.reload()}),[]);return(0,W.tZ)(m.SV,{resetKeys:t,onResetHandler:n,children:(0,W.tZ)(pe,(0,C.Z)({},e))})}var fe=n(24560),ge=n(39814),xe=n(77676).Z.getOne();function _e(e){var t=e.isAllowedSendMsg,n=(0,fe.O)(),s=n.setMessage,r=n.reply,d=n.setReply,c=n.editingMessage,u=n.isDelayedMessage,m=n.setIsDelayedMessage,h=n.message,p=n.isMentionSearching,v=n.setMessageScheduleDate,f=n.messageScheduleDate,x=n.handleScheduleModalToggle,_=(0,re.m)(),b=_.entityId,y=_.entityType,j=_.isLastPageFetched,Z=_.isScheduledChat,w=(0,ge.R)().sendJsonMessage,N=(0,o.bL)({sendJsonMessage:w,entityId:b,entityType:y}).sendChatMessage,S=(0,o.r1)().updateEntities,k=(0,l.m)(),M=k.setActiveDraft,I=k.activeDraft,F=(0,o.cX)(),A=F.removeLS,E=F.updateEntityDraft,P=F.getLS,R=(0,a.useState)(null),O=(0,i.Z)(R,2),L=O[0],U=O[1],T=P(),G=(0,B.v9)((function(e){return xe(e,{id:b,entity:"case"===y?"cases":"ims-chats",name:"".concat("case"===y?"CaseChat":"GroupChat","-").concat(b,"One")})})),K=function(e){var t,n;if(!p){var i;if(null===e||void 0===e||e.preventDefault(),L&&U(null),(I||b in T)&&(E("reset"),M(null),A(b)),c&&(null===c||void 0===c?void 0:c.id)===(null===G||void 0===G||null===(t=G.item.pinned_message)||void 0===t?void 0:t.id))S({entity:"ims-chats",entityId:b,updatingData:{pinned_message:(0,C.Z)((0,C.Z)({},null===G||void 0===G||null===(i=G.item)||void 0===i?void 0:i.pinned_message),{},{text:h})}});N({type:"text",replied_to_id:r?r.id:null,replied_to:null,msgSendingChatId:b,uuid:(0,D.x0)(),edited:!!c,is_draft:!(null===(n=G.item)||void 0===n||!n.draft_message),scheduled_to:f}),s(""),v(null),r&&d(null)}};(0,a.useEffect)((function(){Z&&f&&L&&K(L)}),[f]),(0,a.useEffect)((function(){!u&&L&&K(L)}),[u]);return(0,g.jsx)(le.lv,{onFormSubmit:function(e){return e.preventDefault(),Z&&!f&&!c&&h?(x(),void U(e)):j||c?void K(e):(m(!0),void U(e))},isAllowedSendMsg:t,isGroup:!0})}function be(e){return(0,g.jsx)(m.SV,{children:(0,g.jsx)(_e,(0,C.Z)({},e))})}var ye=n(66364),je=n.n(ye),Ze=n(49185),we=n(38596),Ce=n(6330),Ne=n(15861),Se=n(4942),ke=n(64687),Me=n.n(ke),Ie=n(80180),De=n(7692),Fe=n(16856),Ae=n(40071);var Ee=n(25763),Pe=n(87976);function Re(e){var t=e.text,n=e.Component,i=e.iconProp,a=e.field_name,s=e.handleChange,r=e.property;return(0,g.jsx)("div",{className:"permissions__item mb-4 ",children:(0,g.jsxs)("div",{className:"permission flex items-center rounded-xl bg-white p-3 shadow-lg dark:bg-kdark-dark333",children:[(0,g.jsx)("div",{className:"icon flex-centered h-10 w-10 rounded-lg bg-primary",children:(0,g.jsx)("div",{className:"text-white",children:(0,g.jsx)(n,(0,C.Z)({},i))})}),(0,g.jsx)("div",{className:"ml-4 text-sm",children:t}),(0,g.jsx)("div",{className:"ml-auto",children:(0,g.jsx)(Pe.B,{handleChange:function(e){return s(e)},disabled:!1,name:a,checked:r[a]})})]})})}function Oe(e){var t=e.handler,n=e.Icon,i=e.text;return(0,g.jsxs)("div",{className:"permissions__leave flex cursor-pointer items-center pl-2 font-semibold transition hover:text-primary",onClick:t,children:[(0,g.jsx)("div",{className:"icon flex-centered h-10  w-10",children:(0,g.jsx)(n,{})}),(0,g.jsx)("div",{className:"ml-2 text-sm",children:i})]})}var Le=n(23853);function Be(e){var t=e.onSuccess,n=e.title,i=e.description,a=e.image,s=e.id,r=(0,l.m)(),o=r.groupSearchQuery,c=r.companyId;return(0,g.jsx)(g.Fragment,{children:(0,g.jsx)(d.Z.Main,{entity:"ims-chats",name:"AllImsChats-".concat(c,"-").concat(o),url:"/".concat(c,"/ims/groups/").concat(s,"/"),id:s,method:"put",primaryKey:"id",sendAsFormData:!1,normalizeData:function(e){return e},prependData:!0,fields:[{name:"title",required:!0,value:n,onSubmitKey:""},{name:"description",value:i,onSubmitKey:""},{name:"image",onSubmitKey:"",type:"object",value:a}],onSuccess:function(e,n){t(),n()},onError:function(e,t){console.log(e)},children:function(e){var n=e.isSubmitting,i=e.values,a=e.setFieldValue;return(0,g.jsx)(_,{onSuccess:t,isSubmitting:n,setFieldValue:a,values:i,isEditing:!0})}})})}function Ue(e){var t=e.title,n=e.image,r=e.membersCount,d=e.isMuted,c=e.chatId,u=e.memberId,h=e.isOwner,f=function(e){var t,n,r,d,c=e.chatId,u=e.isMuted,m=e.memberId,h=(0,l.m)(),f=h.companyId,g=h.groupSearchQuery,x=h.isAdmin,_=(0,$.a)().userData,b=(0,o.Kx)(),y=b.removeQueryParams,j=b.query,Z=(0,a.useState)(!1),w=(0,i.Z)(Z,2),S=w[0],k=w[1],M=(0,a.useState)(!1),I=(0,i.Z)(M,2),D=I[0],F=I[1],A=(0,a.useState)(!1),E=(0,i.Z)(A,2),P=E[0],R=E[1],O=(0,a.useState)(!1),L=(0,i.Z)(O,2),B=L[0],U=L[1],T=function(){return R((function(e){return!e}))},G=function(){return U((function(e){return!e}))},K=(0,a.useRef)(null),H=(0,o.r1)().updateEntities,W=null!==j&&void 0!==j&&j.searchedMessageId?null===j||void 0===j?void 0:j.searchedMessageId:c,V=(0,o.QY)({entity:"ims-chats",entityId:c,entityName:"GroupChat-".concat(W,"One")});(0,a.useEffect)((function(){K.current=V.item.property}),[V.item.property]);var Q=p()(V,"item.members",[]).find((function(e){return"OWNER"===e.role})),q=p()(V,"item.members",[]).find((function(e){return e.user.id===_.id})),z=(null===Q||void 0===Q?void 0:Q.user.id)===_.id,X=!0;(z||x||null===q||void 0===q||!q.is_allowed_exit_group)&&(X=!1);var Y=!1;(x||z||null!==q&&void 0!==q&&q.is_allowed_delete_group)&&(Y=!0);var J=(0,o.bK)({url:"/".concat(f,"/ims/groups/").concat(c,"/"),dynamicValues:!0,method:"put",cb:{success:function(e,t){},error:function(e,t){var n,i;te(null===(n=t[0])||void 0===n?void 0:n.fieldName,!(null!==(i=t[0])&&void 0!==i&&i.checked))}}}).fetchData,ee=(0,a.useCallback)((function(e,t){var n;H({entity:"ims-chats",entityId:e,updatingData:{members:[].concat((0,N.Z)(null===V||void 0===V||null===(n=V.item)||void 0===n?void 0:n.members.filter((function(e){return e.user.id!==_.id}))),[(0,C.Z)((0,C.Z)({},q),t)])}})}),[null===V||void 0===V?void 0:V.item]),te=function(e,t){var n=(0,C.Z)({},K.current)||{};H({entity:"ims-chats",entityId:c,updatingData:{property:(0,C.Z)((0,C.Z)({},n),{},(0,Se.Z)({},e,t))}})},ne=(0,a.useCallback)(function(){var e=(0,Ne.Z)(Me().mark((function e(t){var n,i;return Me().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.target.name,i=t.target.checked,te(n,i),e.next=5,J({values:(0,Se.Z)({},n,i),fieldName:n,checked:i});case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[V.item.property]),ie=(0,o.bK)({url:"/".concat(f,"/ims/groups/").concat(c,"/"),method:"put",values:{is_mute:!u},cb:{success:function(e,t){},error:function(e,t){null===ee||void 0===ee||ee(c,{is_mute:u})}}}).fetchData,ae=(0,Ie.v)({entity:"ims-chats",name:"AllImsChats-".concat(f,"-"),deleteData:!0,id:c,url:"",method:"delete",cb:{success:function(e){},error:function(e){},finally:function(){}}}).handleLocalDelete,se=(0,Ie.v)({entity:"ims-chats",name:"AllImsChats-".concat(f,"-").concat(g),method:D?"patch":"delete",url:D?"/".concat(f,"/ims/groups/").concat(c,"/members/").concat(m,"/leave/"):"/".concat(f,"/ims/groups/").concat(c,"/"),deleteData:!0,id:Number(W),cb:{success:function(e){null===k||void 0===k||k(!1),null===F||void 0===F||F(!1),B&&G(),P&&T(),y(),g&&ae()},error:function(e){null===k||void 0===k||k(!1),G()},finally:function(){}}}).handleRequest;return{leaveGroupChat:function(){null===k||void 0===k||k(!0),se()},localDelete:function(){ae(),null===F||void 0===F||F(!1),y()},permissions:[{Component:De.kK8,handleChange:ne,iconProp:{},text:"Send Messages",field_name:"is_allowed_send_msg",show:x||z},{Component:s.wZc,handleChange:ne,iconProp:{},text:"Add Users",field_name:"is_allowed_add_user",show:x||z},{Component:Fe.XH4,handleChange:ne,iconProp:{},text:"Remove users",field_name:"is_allowed_remove_user",show:x||z},{Component:v.bI9,handleChange:ne,iconProp:{},text:"Pin Messages",field_name:"is_allowed_pin_msg",show:x||z},{Component:v.$iz,handleChange:ne,iconProp:{width:11,height:11},text:"Edit Group Info",field_name:"is_allowed_edit_info",show:x||z},{Component:Ae.wzU,handleChange:ne,iconProp:{className:"chat-icon-exit"},text:"Exit From Group",field_name:"is_allowed_exit_group",show:x||z}],handlePropertyChange:ne,currentUserProperty:null!==(t=null===V||void 0===V||null===(n=V.item)||void 0===n?void 0:n.members.find((function(e){return(null===e||void 0===e?void 0:e.id)===m})))&&void 0!==t?t:{},property:null!==(r=null===V||void 0===V||null===(d=V.item)||void 0===d?void 0:d.property)&&void 0!==r?r:{},handlerSwitchMute:function(e){ee(c,{is_mute:!e}),ie(e)},canLeaveChat:X,canDeleteChat:Y,deleteVisible:P,deleteLoading:B,toggleDeleteVisible:T,deleteGroupChat:function(){G(),se()},exitLoading:S,open:D,setExitOpen:F,imsData:null===V||void 0===V?void 0:V.item}}({chatId:c,isMuted:d,memberId:u}),x=f.leaveGroupChat,_=f.permissions,b=f.handlePropertyChange,y=f.property,j=f.handlerSwitchMute,Z=f.canLeaveChat,w=f.canDeleteChat,S=f.deleteVisible,k=f.deleteLoading,M=f.toggleDeleteVisible,I=f.deleteGroupChat,D=f.exitLoading,F=f.open,A=f.setExitOpen,E=f.imsData,P=f.currentUserProperty,R=(0,l.m)().isAdmin,O=(0,o.dF)(),L=O.open,B=O.modalHandler,U=O.WhiteModal;return(0,g.jsx)("div",{className:"w-72 ",children:(0,g.jsxs)("div",{className:"permissions font-poppins",children:[(0,g.jsx)("div",{className:"permissions__top",children:(0,g.jsxs)("div",{className:"permission__header flex rounded-lg bg-primary p-2 text-white  shadow-lg",children:[(0,g.jsx)("div",{className:"permissions__img flex-centered mr-2 h-14 w-14 flex-shrink-0 overflow-hidden rounded-md bg-white text-primary-dark",children:n?(0,g.jsx)("img",{src:n.thumbnail_150,alt:t}):null===t||void 0===t?void 0:t[0].toUpperCase()}),(0,g.jsxs)("div",{className:"permissions__header-text flex-grow ",children:[(0,g.jsxs)("div",{className:"flex-center-between text-base",children:[(0,g.jsx)("span",{children:t}),R||h||null!==P&&void 0!==P&&P.is_allowed_edit_info?(0,g.jsx)("div",{className:"cursor-pointer transition hover:text-primary-dark",onClick:B,children:(0,g.jsx)(Le.vPQ,{})}):null,(0,g.jsx)(U,{handleModalOpen:B,open:L,children:(0,g.jsx)(Be,{onSuccess:B,title:E.title,description:E.description,image:E.image,id:E.id})})]}),(0,g.jsx)("div",{className:"text-sm",children:"".concat(r," members")})]})]})}),(0,g.jsxs)("div",{className:"permissions__content mt-4",children:[_.map((function(e){return(0,g.jsx)(a.Fragment,{children:e.show?(0,g.jsx)(Re,{text:e.text,Component:e.Component,iconProp:e.iconProp,field_name:e.field_name,handleChange:b,property:y},e.text):null},e.text)})),(0,g.jsx)(Oe,{text:d?"Unmute notifications":"Mute notifications",handler:function(){return j(d)},Icon:d?Ee.rZs:Ee.sF0}),w?(0,g.jsx)(Oe,{text:"Delete Group",handler:M,Icon:Fe.$vK}):null,Z?(0,g.jsx)(g.Fragment,{children:(0,g.jsx)(Oe,{text:"Leave group",handler:function(){return A(!0)},Icon:Ae.wzU})}):null,(0,g.jsx)(m.sm,{featureHandler:x,isOpen:Boolean(F),toggleHandler:function(){return A((function(e){return!e}))},title:"Are you sure to exit ".concat(t," group"),hasLoader:!0,isLoading:D}),(0,g.jsx)(m.sm,{featureHandler:I,isOpen:Boolean(S),toggleHandler:M,title:"Are you sure to delete  ".concat(t," group"),hasLoader:!0,isLoading:k})]})]})})}function Te(e){return(0,g.jsx)(m.SV,{isCompact:!0,children:(0,g.jsx)(Ue,(0,C.Z)({},e))})}var Ge=n(13889);function Ke(){var e=(0,a.useState)(""),t=(0,i.Z)(e,2),n=t[0],s=t[1],o=(0,a.useState)(1),d=(0,i.Z)(o,2),c=d[0],u=d[1],h=(0,r.Z)(n,300),p=(0,i.Z)(h,1)[0],v=(0,oe.mx)().entityId,f=(0,l.m)().companyId;return(0,g.jsxs)("div",{className:"group-members",children:[(0,g.jsx)("h2",{className:"mb-4 text-xl font-bold",children:"Group chat members"}),(0,g.jsx)("div",{className:"mb-4",children:(0,g.jsx)("input",{type:"text",className:"inline-block w-full rounded-xl border p-2 outline-none hover:border-primary focus:border-primary dark:bg-kdark-lighter dark:text-white",value:n,onChange:function(e){return s(e.target.value)},placeholder:"Search members"})}),(0,g.jsx)("div",{className:"group-members__content h-48",children:(0,g.jsx)(Ge.$B,{autoHide:!0,style:{height:"100%"},children:(0,g.jsx)(X.Z.All,{entity:"group-members",name:"GroupMembers-".concat(v),url:"/".concat(f,"/ims/").concat(v,"/members_list/"),params:{extra:{search:p},page:c,limit:10},appendData:!0,children:function(e){var t=e.items,n=e.isFetched,i=e.meta,a=(0,N.Z)(t);return(0,g.jsxs)(g.Fragment,{children:[a.map((function(e){var t,n,i;return(0,g.jsxs)("div",{className:"msg-info__content-user mb-3 flex items-center",children:[(0,g.jsx)("div",{className:"avatar mr-3 flex-shrink-0",children:(0,g.jsx)(P.Rz,{size:36,smallSize:36,className:"",letter:"".concat(e.user.first_name[0]).concat(e.user.last_name[0]),alt:"".concat(e.user.first_name," ").concat(e.user.last_name),src:(null===(t=e.user.avatar)||void 0===t?void 0:t.thumbnail_150)||(null===(n=e.user.avatar)||void 0===n?void 0:n.thumbnail)||(null===(i=e.user.avatar)||void 0===i?void 0:i.url)})}),(0,g.jsx)("div",{className:"msg-info__user-content",children:(0,g.jsxs)("div",{className:"msg-info__user-name mb-1 text-sm",children:[(0,g.jsx)("span",{children:"".concat(e.user.first_name," ").concat(e.user.last_name)}),"OWNER"===e.role&&(0,g.jsx)("span",{className:"italic text-kgrey",children:" Group owner"})]})})]},e.id)})),n?null:(0,N.Z)(Array(6)).map((function(e,t){return(0,g.jsx)("div",{className:"mb-2",children:(0,g.jsx)(We,{})},t)})),n&&null!==i&&void 0!==i&&i.current_page&&null!==i&&void 0!==i&&i.last_page&&(null===i||void 0===i?void 0:i.current_page)<(null===i||void 0===i?void 0:i.last_page)?(0,g.jsx)(m.$K,{setPage:function(){return u((function(e){return e+1}))}}):null]})}})})})]})}function He(){return(0,g.jsx)(m.SV,{children:(0,g.jsx)(Ke,{})})}function We(){return(0,g.jsxs)(S.ZP,{speed:2,width:369,height:40,viewBox:"0 0 369 40",backgroundColor:"#f3f3f3",foregroundColor:"#ecebeb",children:[(0,g.jsx)("circle",{cx:"75",cy:"125",r:"27"}),(0,g.jsx)("circle",{cx:"30",cy:"20",r:"20"}),(0,g.jsx)("rect",{x:"55",y:"10",rx:"4",ry:"4",width:"69",height:"18"}),(0,g.jsx)("rect",{x:"131",y:"10",rx:"4",ry:"4",width:"151",height:"18"})]})}function Ve(){var e=(0,l.m)(),t=e.setGroupSearchOpen,n=e.groupSearchOpen;return{handleSearchBtnClick:function(){console.log("clicked")},toggleSearchSidebar:function(){return t(!n)}}}var Qe=n(45987),qe=n(88167),ze=n(38192),Xe=n(1370),$e=n(58997),Ye=n(14621),Je=n(38302),et=n(42541),tt=n(70272),nt=n(95569),it=n(81694),at=n.n(it),st=n(78096),rt=n(93969),lt=n(80159),ot=n(64212),dt=n(67025),ct=n(20632),ut=n(57407),mt=n(21079),ht=(0,we.Z)((function(e){return{root:{display:"flex","& > *":{margin:e.spacing(1)}},purple:{color:e.palette.getContrastText(nt.Z[500]),backgroundColor:nt.Z[500]}}})),pt=function(e){var t,n,i=e.member,a=e.areAddedMembers,s=e.onClickHandler,r=void 0===s?function(){}:s,l=e.selectedMembers,o=void 0===l?[]:l,d=e.isAddingMember,c=void 0!==d&&d,u=e.isOwner,m=void 0!==u&&u,h=e.isAdminManager,v=e.showChatEditSettingModal,f=void 0===v?function(){}:v,x=e.setOpen,_=e.currentMember,b=ht(),y=c?i.first_name:p()(i,"user.first_name"),j=c?i.last_name:p()(i,"user.last_name"),Z=p()(i,"company.name"),w=c?Z===(null===i||void 0===i?void 0:i.username):Z===p()(i,"user.username"),C=c?p()(i,"avatar.thumbnail_150"):p()(i,"user.avatar.thumbnail_150"),N=null===(t=y[0])||void 0===t?void 0:t.toUpperCase(),S=null===(n=j[0])||void 0===n?void 0:n.toUpperCase(),k="".concat(y," ").concat(j),M=c?i.id:p()(i,"user.id"),I=c?null:i.role,D=c?null:null===i||void 0===i?void 0:i.is_admin,F=null===i||void 0===i?void 0:i.is_staff,A="OWNER"===i.role,E=o.find((function(e){var t;return e.id===M&&e.companyId===(null===i||void 0===i||null===(t=i.company)||void 0===t?void 0:t.id)}));return(0,g.jsxs)(st.Z,{button:!a,onClick:function(){return r(M,i)},className:at()("member-list-item",{"item-active":o.includes(M)}),children:[(0,g.jsx)(rt.Z,{children:(0,g.jsx)(tt.Z,{alt:N,src:C,className:b.purple,children:"".concat(N," ").concat(S)})}),(0,g.jsx)(lt.Z,{primary:k,secondary:"".concat(A?"GROUP OWNER":""," ").concat(F&&A?"":"".concat(F?"Staff":"Client"," | ").concat(w?"Individual":Z))}),E&&(0,g.jsx)(g.Fragment,{children:(0,g.jsx)(ot.Z,{children:(0,g.jsx)(dt.Z,{edge:"end","aria-label":"checked",children:(0,g.jsx)(ct.Z,{})})})}),a&&(h||m||_.is_allowed_remove_user)&&(0,g.jsxs)(ot.Z,{children:[(h||m)&&(0,g.jsx)(dt.Z,{edge:"end","aria-label":"checked",disabled:"OWNER"===I||D,onClick:function(){return f(i)},children:(0,g.jsx)(mt.Z,{})}),(0,g.jsx)(dt.Z,{edge:"end","aria-label":"checked",disabled:"OWNER"===I,onClick:function(){return x(i)},children:(0,g.jsx)(ut.Z,{})})]})]})},vt=n(52067),ft=n(93188),gt=n(58528);var xt=function(e){var t=e.className,n=e.handler,i=e.text,a=e.Component,s=e.iconProp,r=e.hasSwitch,l=e.field_name,o=e.handleChange,d=e.property,c=e.isMuteSetting,u=e.isMute;return(0,g.jsxs)("div",{className:"chat-sett-toggler flex items-center dark:!bg-kdark-dark333 ".concat(t),onClick:function(){return c?o({target:{checked:!u}}):n(!0)},children:[(0,g.jsx)("div",{className:"chat-sett-toggler__icon flex items-center justify-center text-white",children:(0,g.jsx)(a,(0,C.Z)({},s))}),(0,g.jsx)("div",{className:"chat-sett-toggler__name",children:i}),r&&!c&&(0,g.jsx)("div",{className:"chat-sett-toggler__switch",children:(0,g.jsx)(gt.Z,{color:"primary",edge:"end",name:l,checked:d[l],onChange:o,inputProps:{"aria-labelledby":"switch-list-label-group-admin"}})})]})},_t=L.Z.entity.formRequest,bt=function(e){var t=e.companyId,n=e.member,s=e.chatId,r=e.isOwner,l=e.staffMembersLength,d=e.isAdminManager,c=n&&n,u=c.is_allowed_send_msg,m=c.is_allowed_add_user,h=c.is_allowed_remove_user,p=c.is_allowed_pin_msg,v=c.is_allowed_edit_info,f=c.is_allowed_delete_group,x=c.is_allowed_exit_group,_=c.is_mute,b=(0,a.useState)({is_allowed_send_msg:u,is_allowed_add_user:m,is_allowed_remove_user:h,is_allowed_pin_msg:p,is_allowed_edit_info:v,is_allowed_delete_group:f,is_allowed_exit_group:x,is_mute:_}),y=(0,i.Z)(b,2),j=y[0],Z=y[1],w=n.id,N=(0,o.Zp)().reloadEntityAll,S=(0,B.I0)(),k=function(e){var i=e.target.name,a=e.target.checked,r=(0,C.Z)({},j);Z((function(e){return(0,C.Z)((0,C.Z)({},e),{},(0,Se.Z)({},i,a))}));var o=(0,Se.Z)({},i,a);S(_t({id:null===n||void 0===n?void 0:n.id,entity:"chatmembers",name:"Allchatmembers-".concat(s,"-").concat(l),url:"/".concat(t,"/ims/groups/").concat(s,"/members/").concat(w,"/"),method:"patch",params:{},updateData:!0,values:o,normalizeData:function(e){return e},cb:{success:function(e){N({url:"/".concat(t,"/ims/").concat(s,"/members_list/"),entity:"userCompanies",name:"Allchatmembers-".concat(s,"-").concat(l),params:{page:1,limit:10}})},error:function(e){Z(r)},finally:function(){}}}))},M=[{Component:O.fu,handleChange:k,iconProp:{},text:"Send Messages",field_name:"is_allowed_send_msg",className:"",handler:function(){},hasSwitch:!0,show:d||r},{Component:O.N_,handleChange:k,iconProp:{},text:"Add Users",field_name:"is_allowed_add_user",className:"",handler:function(){},hasSwitch:!0,show:d||r},{Component:O.HF,handleChange:k,iconProp:{},text:"Remove users",field_name:"is_allowed_remove_user",className:"",handler:function(){},hasSwitch:!0,show:d||r},{Component:O.Dg,handleChange:k,iconProp:{},text:"Pin Messages",field_name:"is_allowed_pin_msg",className:"",handler:function(){},hasSwitch:!0,show:d||r},{Component:O.yl,handleChange:k,iconProp:{width:11,height:11},text:"Edit Group Info",field_name:"is_allowed_edit_info",className:"",handler:function(){},hasSwitch:!0,show:d||r},{Component:O.WC,handleChange:k,iconProp:{className:"chat-icon-exit"},text:"Exit From Group",field_name:"is_allowed_exit_group",className:"white-icon",handler:function(){},hasSwitch:!0,show:d||r}];return(0,g.jsx)("div",{className:"chat-settings__inner",children:(0,g.jsxs)("div",{className:"chat-settings__content",children:[(0,g.jsx)("div",{className:"chat-settings__title mb-4 font-bold",children:"Individual Permissions"}),(0,g.jsx)("div",{className:"chat-settings__l",children:M.map((function(e){var t=e.className,n=e.handler,i=e.text,a=e.hasSwitch,s=e.field_name,r=e.Component,l=e.iconProp,o=e.show,d=e.handleChange;return o&&(0,g.jsx)("div",{className:"chat-settings__i",children:(0,g.jsx)(xt,{className:t,handler:n,text:i,Component:r,iconProp:l,hasSwitch:a,field_name:s,handleChange:d,property:j,isMuteSetting:!1,isMute:!1})},s)}))})]})})},yt=n(49935),jt=L.Z.entity.formRequest,Zt=function(e){var t=(0,a.useState)(1),n=(0,i.Z)(t,2),s=n[0],d=n[1],c=(0,a.useState)(""),u=(0,i.Z)(c,2),h=u[0],p=u[1],v=(0,r.Z)(h,300),f=(0,i.Z)(v,1)[0],x=(0,a.useState)(!1),_=(0,i.Z)(x,2),b=_[0],y=_[1],j=(0,a.useState)(!1),Z=(0,i.Z)(j,2),w=Z[0],C=Z[1],N=(0,a.useState)(!1),S=(0,i.Z)(N,2),k=S[0],M=S[1],I=(0,l.m)().companyId,D=(0,oe.mx)().entityId,F=(0,B.I0)(),A=(0,o.eC)().showNotification,E=e.isAdminManager,R=e.isOwner,O=e.currentMember,L=e.staffMembersLength,U=function(){return y(!1)};return(0,g.jsx)("div",{className:"members-list",children:(0,g.jsx)(X.Z.All,{entity:"chatmembers",name:"Allchatmembers-".concat(D,"-").concat(L),url:"/".concat(I,"/ims/").concat(D,"/members_list/"),appendData:!0,params:{page:s,limit:20,extra:{search:f}},onInit:function(e){},children:function(e){var t=e.items,n=e.isFetched,i=e.meta;return(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)("div",{className:"members-list__search p-4",children:(0,g.jsx)(ft.Z,{label:"Search members",value:h,onChange:function(e){return p(e.target.value)},variant:"outlined",size:"small",fullWidth:!0})}),(0,g.jsx)(Ge.$B,{className:"rct-scroll",autoHide:!0,style:{height:"300px"},children:(0,g.jsx)("div",{className:"members-list__list",children:(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(vt.Z,{dense:!0,children:t.map((function(e){return(0,g.jsx)(pt,{member:e,isAdminManager:E,isOwner:R,showChatEditSettingModal:C,setOpen:y,currentMember:O,areAddedMembers:!0},e.id)}))}),n&&(null===i||void 0===i?void 0:i.current_page)&&(null===i||void 0===i?void 0:i.last_page)&&(null===i||void 0===i?void 0:i.current_page)<(null===i||void 0===i?void 0:i.last_page)&&(0,g.jsx)(m.$K,{setPage:function(){return d((function(e){return e+1}))}}),n?null:(0,g.jsx)("div",{className:"case-chat-loader flex items-center justify-center",children:(0,g.jsx)(m.aN,{})}),(0,g.jsx)(m.sm,{featureHandler:function(){return e=b,M(!0),void F(jt({entity:"chatmembers",name:"Allchatmembers-".concat(D,"-").concat(L),method:"delete",url:"/".concat(I,"/ims/groups/").concat(D,"/members/").concat(e.id,"/"),deleteData:!0,id:e.id,cb:{success:function(){F((0,yt.Gx)({id:D,entity:"ims-chats",name:"GroupChat-".concat(D),url:"/".concat(I,"/ims/groups/").concat(D,"/"),params:{},primaryKey:"id",relations:""})),A({message:"Successfully deleted",variant:"success"})},error:function(e){A({message:"Something went wrong",variant:"error"})},finally:function(){y(!1),M(!1)}},params:{},primaryKey:"id",values:{}}));var e},isOpen:Boolean(b),toggleHandler:U,title:"Are you sure to remove the member from group chat?",hasLoader:!0,isLoading:k}),(0,g.jsx)(P.Cx,{handleModalOpen:function(){return C(!1)},open:w,maxWidth:310,minWidth:310,children:(0,g.jsx)(bt,{companyId:I,chatId:D,isAdminManager:E,isOwner:R,member:w,staffMembersLength:L})})]})})})]})}})})};function wt(e){return(0,g.jsx)(m.SV,{children:(0,g.jsx)(Zt,(0,C.Z)({},e))})}var Ct=n(78420),Nt=n(28912),St=n(92475),kt=n(94135),Mt=n(66828),It=n(10083),Dt=function(e){var t=e.value,n=e.handleChange;return(0,g.jsx)("div",{className:"members-list__filter",children:(0,g.jsxs)(Mt.Z,{component:"fieldset",children:[(0,g.jsx)(It.Z,{component:"legend",children:"Filter:"}),(0,g.jsx)(St.Z,{"aria-label":"gender",name:"filter",value:t,onChange:n,children:(0,g.jsxs)("div",{className:"members-list__filter_inner",children:[(0,g.jsx)("div",{className:"members-list__filter_item",children:(0,g.jsx)(kt.Z,{value:"all",control:(0,g.jsx)(Nt.Z,{color:"primary"}),label:"All"})}),(0,g.jsx)("div",{className:"members-list__filter_item",children:(0,g.jsx)(kt.Z,{value:"staff",control:(0,g.jsx)(Nt.Z,{color:"primary"}),label:"Staff"})}),(0,g.jsx)("div",{className:"members-list__filter_item",children:(0,g.jsx)(kt.Z,{value:"individual",control:(0,g.jsx)(Nt.Z,{color:"primary"}),label:"Individual Clients"})}),(0,g.jsx)("div",{className:"members-list__filter_item",children:(0,g.jsx)(kt.Z,{value:"clients",control:(0,g.jsx)(Nt.Z,{color:"primary"}),label:"Business Client Users"})})]})})]})})},Ft=n(82036),At=function(e){var t=(0,a.useState)(1),n=(0,i.Z)(t,2),s=n[0],d=n[1],c=e.onSuccess,u=e.activeChat,h=e.staffMembersLength,p=(0,l.m)().companyId,v=(0,oe.mx)().entityId,f=(0,a.useState)([]),x=(0,i.Z)(f,2),_=x[0],b=x[1],j=(0,a.useState)([]),Z=(0,i.Z)(j,2),w=Z[0],C=Z[1],S=(0,a.useState)(!1),k=(0,i.Z)(S,2),M=k[0],I=k[1],D=(0,a.useState)("all"),F=(0,i.Z)(D,2),A=F[0],E=F[1],R=(0,a.useState)({is_individual:"true",is_business:"true",is_member:"true"}),O=(0,i.Z)(R,2),L=O[0],U=O[1],T=(0,B.I0)(),G=(0,a.useState)("All"),K=(0,i.Z)(G,2),H=K[0],W=K[1],V=(0,o.eC)().showNotification,Q=(0,Ie.v)({entity:"chatmembers",name:"Allchatmembers-".concat(v,"-").concat(h),method:"post",url:"/".concat(p,"/ims/groups/").concat(v,"/members/"),values:w.reduce((function(e,t){return[].concat((0,N.Z)(e),[{user:{id:t.id},role:"MEMBER",company:{id:t.companyId}}])}),[]),cb:{success:function(e){T((0,yt.Gx)({id:v,entity:"ims-chats",name:"GroupChat-".concat(v),url:"/".concat(p,"/ims/groups/").concat(v,"/"),params:{},primaryKey:"id",relations:""})),V({message:"Members successfully added",variant:"success"})},error:function(e){V({message:"Something went wrong",variant:"error"})},finally:function(){I(!1),c()}}}).handleRequest;(0,a.useEffect)((function(){!function(){switch(A){case"all":W("All");break;case"individual":W("Individual Clients");break;case"clients":W("Business Client Users");break;case"staff":W("Staff");break;default:;}}()}),[A]);var q=L.is_individual,z=L.is_business,$=L.is_member,Y=(0,a.useState)(""),J=(0,i.Z)(Y,2),ee=J[0],te=J[1],ne=(0,a.useState)(!1),ie=(0,i.Z)(ne,2),ae=ie[0],se=ie[1],re=(0,r.Z)(ee,300),le=(0,i.Z)(re,1)[0];(0,a.useEffect)((function(){d(1)}),[le]);var de=function(e,t){if(_.includes(e)){var n=_.filter((function(t){return t!==e})),i=w.filter((function(t){return t.id!==e}));b(n),C(i)}else b((function(t){return[].concat((0,N.Z)(t),[e])})),C((function(e){var n;return[].concat((0,N.Z)(e),[{id:t.id,companyId:null===t||void 0===t||null===(n=t.company)||void 0===n?void 0:n.id}])}))};return(0,g.jsxs)("div",{className:"members-list relative",children:[(0,g.jsx)(X.Z.All,{entity:"clientMembers",name:"AllClientMembers-".concat(v,"-").concat(h),url:"/".concat(p,"/my/company/client_users/"),primaryKey:function(e){return"".concat(e.id,"-").concat(e.company.id)},appendData:!0,isUniq:!1,params:{page:s,limit:20,extra:{search:le,is_individual:q,is_business:z,is_member:$,exclude_ids:u.members.filter((function(e){return"KICKED"!==e.role.toUpperCase()})).reduce((function(e,t){return[].concat((0,N.Z)(e),[null===t||void 0===t?void 0:t.user.id])}),[]).join(",")}},onInit:function(e){I(!1)},children:function(e){var t=e.items,n=e.isFetched,i=e.meta;return(0,g.jsxs)(g.Fragment,{children:[(0,g.jsxs)("div",{className:"members-list__settings",children:[(0,g.jsx)("div",{className:"members-list__search",children:(0,g.jsx)(ft.Z,{label:"Search members",value:ee,onChange:function(e){d(1),te(e.target.value)},variant:"outlined",size:"small",fullWidth:!0})}),(0,g.jsx)("div",{className:"members-list__filter-btn pl-2.5",children:(0,g.jsx)(dt.Z,{"aria-label":"filter",color:"default",onClick:function(){return se(!0)},children:(0,g.jsx)(Ft.Z,{})})})]}),(0,g.jsxs)("div",{className:"ml-2.5 flex items-center",children:[(0,g.jsx)("div",{className:"mr-2.5",children:(0,g.jsx)("strong",{children:"Filtering type:"})}),(0,g.jsx)("div",{className:"mr-2.5",children:H})]}),(0,g.jsx)(Ge.$B,{className:"rct-scroll",autoHide:!0,style:{height:"300px"},children:(0,g.jsxs)("div",{className:"members-list__list",children:[M&&(0,g.jsx)(m.aN,{tiled:!0}),(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(vt.Z,{className:"add-chat-member__list",dense:!0,children:t.map((function(e,t){return(0,g.jsx)(pt,{member:e,onClickHandler:de,selectedMembers:w,isAddingMember:!0},t)}))}),n&&(null===i||void 0===i?void 0:i.current_page)&&(null===i||void 0===i?void 0:i.last_page)&&(null===i||void 0===i?void 0:i.current_page)<(null===i||void 0===i?void 0:i.last_page)&&(0,g.jsx)(m.$K,{setPage:function(){return d((function(e){return e+1}))}}),n?null:(0,g.jsx)("div",{className:"case-chat-loader flex items-center justify-center",children:(0,g.jsx)(m.aN,{})})]})]})})]})}}),(0,g.jsx)(P.Cx,{handleModalOpen:function(){return se(!1)},open:ae,children:(0,g.jsx)(Dt,{value:A,handleChange:function(e){var t=e.target.value;switch(E(t),I(!0),d(1),se(!1),t){case"all":U({is_individual:"true",is_business:"true",is_member:"true"});break;case"individual":U({is_individual:"true",is_business:"false",is_member:"false"});break;case"clients":U({is_individual:"false",is_business:"true",is_member:"false"});break;case"staff":U({is_individual:"false",is_business:"false",is_member:"true"});break;default:return null}}})}),(0,g.jsx)("div",{className:"absolute bottom-2.5 right-2.5",children:(0,g.jsx)(y.Z,{color:"primary","aria-label":"add",onClick:function(){I(!0),Q()},disabled:0===_.length,children:(0,g.jsx)(Ct.Z,{})})})]})};function Et(e){return(0,g.jsx)(m.SV,{children:(0,g.jsx)(At,(0,C.Z)({},e))})}var Pt=["children","value","index"];function Rt(e){var t=e.children,n=e.value,i=e.index,a=(0,Qe.Z)(e,Pt);return(0,g.jsx)("div",(0,C.Z)((0,C.Z)({role:"tabpanel",hidden:n!==i,id:"scrollable-force-tabpanel-".concat(i),"aria-labelledby":"scrollable-force-tab-".concat(i)},a),{},{children:n===i&&(0,g.jsx)(et.Z,{p:0,children:(0,g.jsx)(Je.Z,{component:"div",children:t})})}))}function Ot(e){return{id:"scrollable-force-tab-".concat(e),"aria-controls":"scrollable-force-tabpanel-".concat(e)}}var Lt=function(e){var t=e.onSuccess,n=(0,l.m)(),s=n.isPermitted,r=n.companyId,d=(0,oe.mx)().entityId,c=(0,$.a)().userData,u=a.useState(0),m=(0,i.Z)(u,2),h=m[0],v=m[1],f=(0,o.QY)({entity:"ims-chats",entityId:d,entityName:"GroupChat-".concat(d,"One")}),x=f.item||{},_=p()(f,"item.members",[]).find((function(e){return"OWNER"===e.role})),b=p()(f,"item.members",[]).find((function(e){return e.user.id===c.id})),y=(null===_||void 0===_?void 0:_.user.id)===c.id,j=(null===b||void 0===b?void 0:b.is_allowed_add_user)||s;return(0,g.jsxs)("div",{className:"case-form case-form_group-chat -mt-5 rounded-xl",children:[(0,g.jsx)(qe.Z,{position:"static",color:"default",children:(0,g.jsxs)(ze.Z,{value:h,onChange:function(e,t){v(t)},variant:"fullWidth",indicatorColor:"primary",textColor:"primary","aria-label":"scrollable2 force tabs example",children:[(0,g.jsx)(Xe.Z,(0,C.Z)({label:"Members",icon:(0,g.jsx)($e.Z,{})},Ot(0))),(0,g.jsx)(Xe.Z,(0,C.Z)((0,C.Z)({label:"Add Members",icon:(0,g.jsx)(Ye.Z,{})},Ot(1)),{},{disabled:!j}))]})}),(0,g.jsx)(Rt,{value:h,index:0,children:(0,g.jsx)(wt,{isAdminManager:s,isOwner:y,currentMember:b,staffMembersLength:123})}),(0,g.jsx)(Rt,{value:h,index:1,children:(0,g.jsx)(Et,{chatId:d,companyId:r,onSuccess:t,activeChat:x,staffMembersLength:123})})]})},Bt=(0,we.Z)((0,Ce.Z)({paper:{borderRadius:"16px",padding:"10px"}}));function Ut(e){var t,n,i,s,r,d,c,u,m=e.imsData,h=e.isFetched,p=(0,re.m)(),f=p.setScrollToMessageHandler,x=p.lastReadMessageId,_=(0,$.a)().userData,b=Bt(),y=(0,o.Kx)().removeQueryParams,j=(0,oe.RT)().closeSocket,Z=(0,l.m)(),w=Z.setActiveDraft,C=Z.activeDraft,N=Z.setGroupSearchOpen,S=Z.groupSearchOpen,k=Z.isAdmin,M=(0,o.cX)().saveDraft,I=Ve().toggleSearchSidebar,D=m.pin_time,F=(0,o.dF)(),A=F.open,E=F.modalHandler,R=F.WhiteModal,L=(0,o.r1)().updateEntities,B=(0,o.dF)(),U=B.open,G=B.modalHandler,K=B.WhiteModal,H=T(m.pin_time,m.id,!0),W=H.open,V=H.handleClick,Q=H.anchorEl,q=H.handleCloseMenu,z=m.title,X=null;h&&!je()(m)&&(X={avatarSrc:null===m||void 0===m||null===(c=m.image)||void 0===c?void 0:c.thumbnail_150,avatarLetter:null===m||void 0===m||null===(u=m.title)||void 0===u?void 0:u[0],avatarAlt:null===m||void 0===m?void 0:m.title});var Y=null===m||void 0===m||null===(t=m.members)||void 0===t?void 0:t.find((function(e){var t;return(null===e||void 0===e||null===(t=e.user)||void 0===t?void 0:t.id)===_.id})),J=null===m||void 0===m||null===(n=m.members)||void 0===n?void 0:n.find((function(e){return"OWNER"===e.role})),ee=(null===J||void 0===J||null===(i=J.user)||void 0===i?void 0:i.id)===_.id;return(0,a.useEffect)((function(){"draft_message"in m&&null!==m&&void 0!==m&&m.draft_message&&!C&&w(m.draft_message)}),[m]),(0,g.jsx)(Ze.F,{isFetched:!0,HeaderActions:(0,g.jsxs)(g.Fragment,{children:[D?(0,g.jsx)("div",{className:"mr-4",children:(0,g.jsx)(O.Dg,{className:"text-kgrey-menuText"})}):null,k||ee||null!==Y&&void 0!==Y&&Y.is_allowed_add_user?(0,g.jsx)("button",{className:"flex-centered mr-2 h-8 w-8 rounded-full bg-primary text-white transition hover:bg-primary-dark active:translate-y-0.5 active:shadow-inner",onClick:G,children:(0,g.jsx)(v.Zev,{})}):(0,g.jsx)("button",{className:"flex-centered h-8 w-8 rounded-full bg-primary text-white transition hover:bg-primary-dark active:translate-y-0.5 active:shadow-inner",onClick:E,children:(0,g.jsx)(Le.WY8,{})}),(0,g.jsx)(K,{handleModalOpen:G,open:U,noPadding:!0,cropRounded:!0,children:(0,g.jsx)(Lt,{onSuccess:G})}),(0,g.jsx)(R,{handleModalOpen:E,open:A,children:(0,g.jsx)(He,{})}),(0,g.jsx)("button",{className:"flex-centered ml-2 h-8 w-8 rounded-full bg-primary text-white transition hover:bg-primary-dark active:translate-y-0.5 active:shadow-inner",onClick:I,children:(0,g.jsx)(v.RB5,{})}),(0,g.jsx)("div",{className:"more-btn w-4 cursor-pointer text-right text-kdark-dark333 transition hover:text-primary dark:text-white dark:hover:text-primary",onClick:V,children:(0,g.jsx)(v.fXH,{className:"inline text-3xl"})}),(0,g.jsx)(P.v2,{id:"long-menu",anchorEl:Q,keepMounted:!0,open:W,classes:{paper:b.paper},onClose:q,children:h?(0,g.jsx)(Te,{image:null===m||void 0===m?void 0:m.image,title:null===m||void 0===m?void 0:m.title,membersCount:null===m||void 0===m||null===(s=m.members)||void 0===s?void 0:s.length,isMuted:null===Y||void 0===Y?void 0:Y.is_mute,chatId:m.id,memberId:null===Y||void 0===Y?void 0:Y.id,isOwner:ee}):null}),(0,g.jsx)("button",{className:"flex-center-y border-border-solid border-l px-4 py-2 text-kred-pink transition hover:opacity-80 lg:ml-4",type:"button",onClick:function(){S&&N(!1),y(),null===j||void 0===j||j(),C&&M();try{L({entity:"ims-chats",entityId:null===m||void 0===m?void 0:m.id,updatingData:{last_read_message:x}})}catch(e){}},children:(0,g.jsx)("div",{className:"icon ",children:(0,g.jsx)(Ae.bjh,{})})})]}),mainText:z,data:X,pinnedMessage:{title:null===m||void 0===m||null===(r=m.pinned_message)||void 0===r?void 0:r.text,id:null===m||void 0===m||null===(d=m.pinned_message)||void 0===d?void 0:d.id},scrollToHandler:f})}function Tt(e){return(0,g.jsx)(m.SV,{children:(0,g.jsx)(Ut,(0,C.Z)({},e))})}function Gt(e){var t,n=e.isUnreadFilterActive,i=(0,o.Kx)(),a=i.query,s=i.removeQueryParams,r=(0,o.eC)().showNotification,d=(0,l.m)(),c=d.companyId,u=d.groupSearchQuery,m=Number("chat"in a?a.chat:void 0),h=(0,$.a)().userData,p=(0,o.s6)({entity:"ims-chats",entityName:"AllImsChats-".concat(c,"-").concat(u)}).all;return(0,g.jsx)(g.Fragment,{children:m&&c?(0,g.jsx)(X.Z.One,{id:String(m),relations:"",entity:"ims-chats",name:"GroupChat-".concat(m),url:"/".concat(c,"/ims/groups/").concat(m,"/"),params:{},onError:function(e){var t;404===(null===e||void 0===e||null===(t=e.response)||void 0===t?void 0:t.status)&&(s(),r({variant:"error",message:"You don't have access to the chat."}))},children:function(e){var t,n=e.item,i=e.isFetched,a=(0,C.Z)({},n),s=null===a||void 0===a||null===(t=a.members)||void 0===t?void 0:t.find((function(e){var t;return(null===e||void 0===e||null===(t=e.user)||void 0===t?void 0:t.id)===h.id}));return(0,g.jsx)(oe.Rv,{entityId:m,entityType:"ims",children:(0,g.jsx)(oe.GR,{children:(0,g.jsx)(oe.eo,{entityId:m,entityType:"ims",children:(0,g.jsx)(ie.g,{ChatHeader:(0,g.jsx)(Tt,{isFetched:i,imsData:a}),ChatBody:(0,g.jsx)(ve,{chatId:m}),ChatInput:(0,g.jsx)(be,{isAllowedSendMsg:null===s||void 0===s?void 0:s.is_allowed_send_msg})})})})})}}):(0,g.jsx)("div",{className:"flex-centered h-full w-full text-xl font-semibold dark:text-white",children:null!==p&&void 0!==p&&null!==(t=p.items)&&void 0!==t&&t.length?"Please select group chat":"You have ".concat(n?"no unread":"no"," group chats")})})}function Kt(e){return(0,g.jsx)(m.SV,{children:(0,g.jsx)(Gt,(0,C.Z)({},e))})}var Ht=n(37080);var Wt=n(54270),Vt=n(30014),Qt=n(17447),qt=n(96263),zt=n.n(qt);function Xt(e){var t=e.searchQuery,n=e.messageText;if(t){var i=t.split(/\s/).filter((function(e){return e})),a=""+(0,F.H$)(n,t,25);return(0,g.jsx)("span",{children:(0,g.jsx)(zt(),{highlightClassName:"highlighted",searchWords:i,textToHighlight:a})})}return(0,g.jsx)("span",{children:n})}var $t=function(e){var t,n,i,a,s=e.message,r=e.listItemClickHandler,l=e.searchQuery,o="".concat(null===(t=s.from_user)||void 0===t?void 0:t.first_name," ").concat(null===(n=s.from_user)||void 0===n?void 0:n.last_name),d=null===s||void 0===s||null===(i=s.from_user)||void 0===i||null===(a=i.avatar)||void 0===a?void 0:a.thumbnail_150;return(0,g.jsxs)(g.Fragment,{children:[(0,g.jsxs)(st.Z,{onClick:function(){return r(s.message_id)},className:"hover:bg-kprimary-200 cursor-pointer transition",children:[(0,g.jsx)(rt.Z,{children:(0,g.jsx)(tt.Z,{alt:o,src:d})}),(0,g.jsx)(lt.Z,{className:"dark:text-white",primary:o,secondary:(0,g.jsx)(Xt,{messageText:(null===s||void 0===s?void 0:s.text)||"",searchQuery:l})})]}),(0,g.jsx)(Qt.Z,{variant:"inset",component:"li"})]})};function Yt(){var e=(0,a.useState)(1),t=(0,i.Z)(e,2),n=t[0],s=t[1],r=(0,l.m)(),d=r.groupSearchOpen,c=r.companyId,u=r.setGroupMessageSearchQuery,h=r.setIsLastPageLoadedTriggered,p=(0,o.A3)(),f=p.query,x=p.setQuery,_=p.searchQuery,b=Ve().toggleSearchSidebar,y=(0,o.Kx)().query,j=(0,o.Kx)().changeUrlParams,Z=(0,a.useRef)(null),w=(0,a.useCallback)((function(e){_.length>0&&(j({chat:Number(y.chat),searchedMessageId:e}),h(!0))}),[_,y]);(0,a.useEffect)((function(){d&&Z.current&&setTimeout((function(){(null===Z||void 0===Z?void 0:Z.current).focus()}),300)}),[d]),(0,a.useEffect)((function(){u(_)}),[_]);var C=null===y||void 0===y?void 0:y.chat;return(0,g.jsxs)("div",{className:"flex h-full flex-col border-l p-1 pr-2 dark:bg-kdark-dark333",children:[(0,g.jsxs)("div",{className:"flex items-center justify-between",children:[(0,g.jsx)(dt.Z,{"aria-label":"close",onClick:function(){j({chat:Number(y.chat)},!0),b()},className:"!mr-1",children:(0,g.jsx)(Vt.Z,{})}),(0,g.jsxs)("div",{className:"search-input relative flex-grow",children:[(0,g.jsx)("input",{type:"search",className:"group-search-input w-full rounded border p-2 pr-4 transition focus:outline-none focus:ring focus:ring-primary dark:bg-kdark-lighter dark:text-white",value:f,onChange:function(e){s(1),x(e.target.value)},ref:Z,placeholder:"Type message keywords"}),(0,g.jsx)("div",{className:"hover:text-kprimary absolute right-3 top-3 cursor-pointer",children:f.length?null:(0,g.jsx)(v.RB5,{})})]})]}),(0,g.jsx)("div",{className:"content flex-grow",children:(0,g.jsx)(g.Fragment,{children:(0,g.jsx)(Ge.$B,{className:"rct-scroll",autoHide:!0,style:{height:"calc(100vh - 104px)"},onScroll:function(){},children:(0,g.jsx)(vt.Z,{className:"mb-0 p-0",children:_.length&&c?(0,g.jsx)(X.Z.All,{entity:"search-messages",name:"".concat(c,"-AllSearchMessages-").concat(C),url:"/".concat(c,"/ims/message_search/"),appendData:!0,params:{page:n,limit:20,extra:{search:_,group_chat_id:C}},primaryKey:"message_id",children:function(e){var t=e.isFetched,n=e.items,i=e.meta;return!n.length&&_&&t?(0,g.jsx)("p",{className:"p-4 !text-xl font-bold dark:text-white",children:"No messages found"}):(0,g.jsxs)(g.Fragment,{children:[n.map((function(e){return(0,g.jsx)($t,{searchQuery:_,listItemClickHandler:w,message:e},e.message_id)})),!t&&(0,g.jsx)("div",{style:{textAlign:"center"},children:(0,g.jsx)(m.aN,{})}),t&&null!==i&&void 0!==i&&i.current_page&&null!==i&&void 0!==i&&i.last_page&&(null===i||void 0===i?void 0:i.current_page)<(null===i||void 0===i?void 0:i.last_page)?(0,g.jsx)(m.$K,{setPage:function(){return s((function(e){return e+1}))}}):null]})}}):(0,g.jsx)("p",{className:"!p-4 dark:text-white",children:"Please search for messages"})})})})})]})}var Jt=285,en=28,tn=362,nn=8,an=285,sn=77;function rn(){!function(){var e=(0,l.m)(),t=e.setPageType,n=e.companyId,i=(0,Ht.Y)().fetchGroupsUnreadMessagesCount;(0,a.useEffect)((function(){n&&i()}),[n]),(0,a.useEffect)((function(){return t(!0),function(){t(!1)}}),[t])}();var e=(0,o.gQ)("Group chats"),t=e.unreadCasesQuantity,n=e.isHidden,s=(0,o.Kx)().query,r=(0,l.m)(),d=r.groupSearchOpen,c=r.groupsUnreadCountData,u=(r.isDarkMode,(0,o.iP)().width),m=(0,a.useState)(!1),h=(0,i.Z)(m,2),p=h[0],v=h[1],f=(0,a.useCallback)((function(){v((function(e){return!e}))}),[]);(0,a.useEffect)((function(){var e;!p||null!==(e=Object.values(c))&&void 0!==e&&e.filter((function(e){return e>0})).length||v(!1)}),[c]);var g=u-Jt-en-tn-nn-an,x=u-Jt-en-tn-nn;return(0,W.tZ)("div",{className:"flex h-full w-full flex-col  pl-2 pb-1 lg:pl-7 lg:pt-7",children:(0,W.BX)("div",{className:"relative flex h-full",children:[(!n||0===t)&&(0,W.tZ)(Wt.q,{children:(0,W.tZ)("title",{children:"KENNEKT | Group chats"})}),(0,W.tZ)("div",{className:(0,M.Z)("w-full flex-shrink-0 transition-all lg:mr-2",{hidden:s.chat&&se.tq,"lg:w-[362px]":!d,"lg:w-[285px]":d}),children:(0,W.BX)("div",{className:"group-sidebar flex h-full flex-col pt-4 font-poppins lg:pt-0",children:[(0,W.tZ)(w,{isUnreadFilter:p,toggleIsUnreadFilter:f}),(0,W.tZ)(ee,{isUnreadFilter:p})]})}),(0,W.tZ)("div",{className:(0,M.Z)(!d&&"flex-grow","transition-all"),style:{width:d?"".concat(g+sn,"px"):x},children:(0,W.tZ)(Kt,{isUnreadFilterActive:p})}),(0,W.BX)("div",{className:(0,M.Z)("message-search bottom-o absolute top-0 right-0 w-[285px] bg-white transition",{"translate-x-[285px]":!d,"translate-x-0":d}),children:[(0,W.tZ)(Yt,{}),(0,W.tZ)("span",{className:" hidden focus:ring-2 focus:ring-primary"})]})]})})}function ln(){return(0,W.tZ)(m.SV,{children:(0,W.tZ)(rn,{})})}},87976:function(e,t,n){n.d(t,{B:function(){return h.B}});var i=n(1413),a=(n(72791),n(5088)),s=n(38596),r=n(6330),l=n(80184),o=(0,s.Z)((function(e){return(0,r.Z)({root:{border:"1px solid #B8BCCF",fontSize:"15px",lineHeight:1,borderRadius:"12px",padding:"10px 30px",fontWeight:300,width:"100%"},input:{padding:0}})}));function d(e){var t=o();return(0,l.jsx)(a.Z,(0,i.Z)({classes:{root:t.root,input:t.input}},e))}var c=n(1288),u=n(13880),m=(0,s.Z)((function(e){return(0,r.Z)({root:{border:"1px solid #B8BCCF",fontSize:"15px",lineHeight:1,borderRadius:"12px",padding:"10px 40px 10px 20px",fontWeight:300,width:"100%"},input:{padding:0},gridContainer:{position:"relative"},iconRoot:{position:"absolute",top:"50%",transform:"translateY(-50%)",fontSize:"22px",width:"22px",height:"22px",right:"15px"},svgRoot:{position:"absolute"}})}));var h=n(86053);h.B}}]);
//# sourceMappingURL=3814.661a0871.chunk.js.map