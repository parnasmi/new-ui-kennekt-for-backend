"use strict";(self.webpackChunkkennekt_front_end_client=self.webpackChunkkennekt_front_end_client||[]).push([[9669],{2213:function(e,t,n){n.d(t,{Z:function(){return d}});var a=n(42982),r=(n(47313),n(84365)),l=n(77344),i=n(85457),s=n(87180),o=n(46417);function c(e){switch(e){case"member":return{label:"Member",value:"member"};case"admin":return{label:"Admin",value:"admin"};case"manager":return{label:"Manager",value:"manager"};default:return null}}function d(e){var t=e.entity,n=e.onSuccess,d=(0,l.m)().companyId,u=(0,i.r1)().updateEntities,m=(0,i.eC)().showNotification;return t?(0,o.jsx)("div",{children:d?(0,o.jsx)(r.Z.Main,{entity:"staffEmployee",name:"staffEmployee-".concat(d),url:"".concat(d,"/employee/").concat(t.id,"/"),method:"patch",id:t.id,primaryKey:"id",sendAsFormData:!1,normalizeData:function(e){return e},updateData:!0,fields:[{name:"avatar",required:!1,value:null===t||void 0===t?void 0:t.avatar,onSubmitKey:"",type:"object",onSubmitValue:function(e){return e||null}},{name:"first_name",required:!0,value:null===t||void 0===t?void 0:t.first_name,onSubmitKey:""},{name:"username",required:!0,value:null===t||void 0===t?void 0:t.username,onSubmitKey:""},{name:"last_name",required:!0,value:null===t||void 0===t?void 0:t.last_name,onSubmitKey:""},{name:"mobile",required:!0,value:null===t||void 0===t?void 0:t.mobile,onSubmitKey:""},{name:"roles",required:!0,value:c(null===t||void 0===t?void 0:t.roles[0]),type:"object",onSubmitKey:"",onSubmitValue:function(e){return[e.value]}},{name:"departments",onSubmitValue:function(e){return e.reduce((function(e,t){return[].concat((0,a.Z)(e),[{id:t}])}),[])},required:!0,type:"array",onSubmitKey:""},{name:"can_send_news",required:!1,value:!0,onSubmitKey:""}],onSuccess:function(e,a){m({message:"Success! "}),u({entity:"staffEmployee",entityId:null===t||void 0===t?void 0:t.id,updatingData:{departments:null===e||void 0===e?void 0:e.departments}}),a(),n()},onError:function(e,t){var n,a,r;m({message:null!==(n=null===e||void 0===e||null===(a=e.response)||void 0===a||null===(r=a.data)||void 0===r?void 0:r.message)&&void 0!==n?n:"Something went wrong",variant:"error"}),t()},children:function(e){var a=e.isSubmitting,r=e.values,l=e.setFieldValue,i=e.errors,c=e.setFieldError,d=e.resetForm;return(0,o.jsx)(s.Z,{values:r,setFieldValue:l,setFieldError:c,isSubmitting:a,errors:i,closeModal:n,resetForm:d,departments:null===t||void 0===t?void 0:t.departments,isCreate:!1,isBeingEditedUserOwner:t.is_business_owner})}}):null}):null}d.defaultProps={onSuccess:function(){}}},87180:function(e,t,n){n.d(t,{Z:function(){return N}});var a=n(1413),r=n(42982),l=n(70885),i=n(47313),s=n(94715),o=n(17480),c=n(79513),d=n(22934),u=n(46225),m=n(77344),f=n(26402),p=n(69706),h=n.n(p),v=n(57864),x=n(32335),b=n(95762),g=n(12715),y=n(85457),j=n(11760),w=n(46417),S="".concat(x.Z.PUBLIC_ASSETS,"img"),_=[{label:"Admin",value:"admin"},{label:"Manager",value:"manager"},{label:"Member",value:"member"}];function N(e){var t,n,p=e.values,x=e.setFieldValue,N=(e.setFieldError,e.isSubmitting),k=e.errors,C=e.closeModal,Z=e.resetForm,E=e.isCreate,D=e.departments,F=e.formValuesSetter,P=void 0===F?function(){}:F,V=e.isBeingEditedUserOwner,T=void 0!==V&&V,M=(0,m.m)().companyId,A=(0,j.a)(),K=A.company,q=A.userData,L=(0,y.h9)({canSend:!E&&p.can_send_news}),I=L.checked,B=(L.handleChange,(0,i.useState)(null)),O=(0,l.Z)(B,2),U=O[0],z=O[1],R=(0,i.useState)(!1),X=(0,l.Z)(R,2),Y=X[0],H=X[1],G=(0,i.useState)(E?null===p||void 0===p?void 0:p.avatar:null),J=(0,l.Z)(G,2),Q=J[0],W=J[1],$=q.id===(null===K||void 0===K||null===(t=K.company)||void 0===t||null===(n=t.owner)||void 0===n?void 0:n.id),ee=(0,i.useState)({clientDeps:D?D.reduce((function(e,t){return t.is_staff?(0,r.Z)(e):[].concat((0,r.Z)(e),[t.id])}),[]):[],staffDeps:D?D.reduce((function(e,t){return t.is_staff?[].concat((0,r.Z)(e),[t.id]):(0,r.Z)(e)}),[]):[]}),te=(0,l.Z)(ee,2),ne=te[0],ae=te[1],re=[],le=[];(0,i.useEffect)((function(){Q&&x("avatar",Q)}),[Q]);var ie=ne.clientDeps,se=ne.staffDeps;(0,i.useEffect)((function(){x("departments",[].concat((0,r.Z)(ie),(0,r.Z)(se)))}),[ne]),(0,i.useEffect)((function(){if(E){var e=["first_name","username","last_name","mobile","departments"],t=Object.keys(p).filter((function(t){if((Array.isArray(p[t])?p[t].length:p[t])&&e.includes(t))return p[t]}));P(t)}}),[p]),(0,i.useEffect)((function(){x("can_send_news",I.canSend)}),[I.canSend]);var oe=window.location.href.includes("qa")||!1;return(0,w.jsxs)("div",{id:"department-form",children:[(0,w.jsxs)("div",{className:"branch-form__header border-b border-kgrey-dark-1/30 px-6 py-4 -mt-5 flex-center-between",children:[(0,w.jsx)("div",{className:"branch-form__heading font-base font-medium",children:"".concat(E?"Create new":"Edit"," staff")}),E?(0,w.jsx)("div",{className:"branch-form__reset text-kgrey text-sm cursor-pointer hover:text-kdark transition",onClick:Z,children:"Clear"}):null]}),(0,w.jsxs)("div",{className:" w-100 p-6",children:[(0,w.jsx)("div",{className:"text-sm font-light mb-2 ml-2 text-kgrey-menuText",children:"Profile photo"}),(0,w.jsxs)("div",{className:"flex items-center mb-5",children:[(0,w.jsxs)("div",{className:"user-avatar-box__display relative dark:bg-kdark-lighter  w-20 h-20 rounded-full overflow-hidden flex-centered",children:[(0,w.jsx)("img",{src:E?h()(Q,"thumbnail_150")||"".concat(S,"/chat-placeholder.png"):h()(null===p||void 0===p?void 0:p.avatar,"thumbnail_150")||"".concat(S,"/chat-placeholder.png"),alt:"",className:"object-fit"}),null!==U&&(0,w.jsxs)("div",{className:"absolute top-1/2 left-1/2 -translate-y-1/2 -translate-x-1/2 w-10 h-10 z-10",children:[(0,w.jsx)("div",{className:"upload-media-spinner",children:(0,w.jsx)(c.aN,{variant:"determinate",value:U})}),(0,w.jsx)("div",{onClick:function(){H(!0),z(null)},className:"absolute w-8 h-8 z-20 top-1/2 left-1/2 -translate-y-1/2 -translate-x-1/2 text-3xl text-primary-dark hover:text-primary transition cursor-pointer",children:(0,w.jsx)(v.SV5,{})})]})]}),(0,w.jsx)("div",{className:"ml-5",children:(0,w.jsx)(c.bA,{uploadMeta:U,setUploadMeta:z,cancelSending:Y,setCancelSending:H,setFile:W})})]}),(0,w.jsx)(s.gN,{label:"First name:",name:"first_name",component:o.Mg,placeholder:"Enter First name"}),(0,w.jsx)(s.gN,{label:"Last name",name:"last_name",component:o.Mg,placeholder:"Enter Last name"}),(0,w.jsx)(s.gN,{type:"email",label:"Email",name:"username",component:o.Mg,placeholder:"Enter Email"}),(0,w.jsx)(s.gN,{label:"Phone number",name:"mobile",component:o.UO,placeholder:"Enter company mobile phone number",enableSearch:!0,onChangeHandler:x}),(0,w.jsxs)("div",{className:"row align-user-start remove-inner-label mb-3.5",children:[(0,w.jsx)("div",{className:"text-sm font-light mb-2 ml-2 text-kgrey-menuText",children:"Staff Departments"}),(0,w.jsx)(b.Z.All,{entity:"tree",name:"AllTreeDepartments-Staff-".concat(M),url:"/".concat(M,"/departments/tree/"),params:{limit:100,extra:{is_staff:"True"}},children:function(e){var t=e.items,n=e.isFetched;return re=n&&(0,g.w)(t),(0,w.jsx)(w.Fragment,{children:n?(0,w.jsxs)("div",{children:[(0,w.jsx)(f.ZP,(0,a.Z)({getPopupContainer:function(e){return e.parentNode},className:"w-full",transitionName:"rc-tree-select-dropdown-slide-up",choiceTransitionName:"rc-tree-select-selection__choice-zoom",dropdownStyle:{overflow:"auto"},dropdownPopupAlign:{overflow:{adjustY:0,adjustX:0},offset:[0,2]},placeholder:(0,w.jsx)("i",{children:"Select Staff Departments"}),searchPlaceholder:"please search",treeLine:!0,maxTagTextLength:10,multiple:!0,allowClear:!0,autoClearSearchValue:!0,treeData:re,treeNodeFilterProp:"title",treeCheckable:!0,showCheckedStrategy:f.hT,onChange:function(e){ae((function(t){return(0,a.Z)((0,a.Z)({},t),{},{staffDeps:e})}))}},E?null:{value:(0,r.Z)(se)})),null!==se&&void 0!==se&&se.length?null:(0,w.jsx)(s.Bc,{name:"departments",children:function(e){return(0,w.jsx)("div",{className:"text-xs text-red-500 mt-0.5",children:e})}}),null!==se&&void 0!==se&&se.length||null!==k&&void 0!==k&&k.departments?null:(0,w.jsx)("p",{className:"text-xs text-red-500 mt-0.5",children:"Select at least one staff department"})]}):(0,w.jsx)("div",{className:"flex justify-center",children:(0,w.jsx)(c.aN,{})})})}})]}),(0,w.jsxs)("div",{className:"mb-3.5",children:[(0,w.jsx)("div",{className:"text-sm font-light mb-2 ml-2 text-kgrey-menuText",children:"Client Departments"}),(0,w.jsx)(b.Z.All,{entity:"tree",name:"AllTreeDepartments-Client-".concat(M),url:"/".concat(M,"/departments/tree/"),params:{limit:100,extra:{is_staff:"False"}},children:function(e){var t=e.items,n=e.isFetched;return le=n&&(0,g.w)(t),(0,w.jsx)(w.Fragment,{children:n?(0,w.jsxs)("div",{children:[(0,w.jsx)(f.ZP,(0,a.Z)({getPopupContainer:function(e){return e.parentNode},className:"w-full",transitionName:"rc-tree-select-dropdown-slide-up",choiceTransitionName:"rc-tree-select-selection__choice-zoom",dropdownStyle:{overflow:"auto"},dropdownPopupAlign:{overflow:{adjustY:0,adjustX:0},offset:[0,2]},placeholder:(0,w.jsx)("i",{children:"Select \u0421lient Departments"}),searchPlaceholder:"please search",treeLine:!0,maxTagTextLength:10,multiple:!0,allowClear:!0,autoClearSearchValue:!0,treeData:le,treeNodeFilterProp:"title",treeCheckable:!0,showCheckedStrategy:f.hT,onChange:function(e){ae((function(t){return(0,a.Z)((0,a.Z)({},t),{},{clientDeps:e})}))}},E?null:{value:(0,r.Z)(ie)})),null!==ie&&void 0!==ie&&ie.length?null:(0,w.jsx)(s.Bc,{name:"departments",children:function(e){return(0,w.jsx)("div",{className:"text-xs text-red-500 mt-0.5",children:e})}})]}):(0,w.jsx)("div",{className:"flex justify-center",children:(0,w.jsx)(c.aN,{})})})}})]}),(0,w.jsxs)("div",{className:"mb-3.5",children:[(0,w.jsx)("div",{className:"text-sm font-light mb-2 text-kgrey-menuText ml-2",children:"Roles"}),(0,w.jsx)(s.gN,{component:o.mg,styles:d.gb,name:"roles",defaultValue:_[2],options:[].concat(_,(0,r.Z)($&&!E&&oe?[{label:"Owner",value:"owner"}]:[])),isSearchable:!u.tq,isDisabled:T})]})]}),(0,w.jsxs)("div",{className:"branch-form__footer px-6 pt-4 pb-9 flex justify-end",children:[(0,w.jsx)(c.Ik,{className:"text-kgrey border-kgrey border mr-5",color:"default",onClick:C,children:"Cancel"}),(0,w.jsx)(c.Ik,{className:"dark:hover:bg-primary-300 dark:focus:ring-primary-300 dark:text-white",type:"submit",isSubmitting:N,color:"primary",isDisabled:!(null!==se&&void 0!==se&&se.length)&&!(null!==k&&void 0!==k&&k.departments),children:E?"Create":"Update"})]}),N?(0,w.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-white bg-opacity-70",children:(0,w.jsx)(c.aN,{})}):null]})}N.defaultProps={isCreate:!0,department:null,resetForm:function(){}}},23867:function(e,t,n){n.d(t,{O:function(){return f}});var a=n(15861),r=n(70885),l=n(64687),i=n.n(l),s=n(85457),o=n(77344),c=n(93905),d=n(92241),u=n(47313),m=n(11760);function f(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){},t=(0,o.m)(),n=t.companyId,l=(0,m.a)(),f=l.companies,p=(0,d.I0)(),h=(0,s.eC)(),v=h.showNotification,x=(0,u.useState)(0),b=(0,r.Z)(x,2),g=b[0],y=b[1],j=(0,s.iR)(),w=j.visible,S=j.showVisible,_=j.loading,N=j.toggleLoading,k=j.closePopup,C=(0,s.iR)(),Z=C.visible,E=C.showVisible,D=C.closePopup,F=(0,u.useMemo)((function(){return"/".concat(n,"/companies/staffs_count/")}),[n]),P=(0,s.bK)({url:F}),V=P.fetchData,T=P.response,M=P.loading;(0,u.useEffect)((function(){n&&(0,a.Z)(i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,V();case 2:case"end":return e.stop()}}),e)})))()}),[n]),(0,u.useEffect)((function(){if(n&&f.length){var e=f.find((function(e){return e.company.id===n})),t=null===e||void 0===e?void 0:e.company.comp_subscription;t&&y(t.paid_staffs_count)}}),[f,n]);var A=function(t){N(),p((0,c.Bi)({entity:"staffEmployee",name:"staffEmployee-".concat(n),method:"delete",url:"/".concat(n,"/employee/").concat(t.id,"/"),deleteData:!0,id:t.id,cb:{success:function(){v({message:"Successfully deleted",variant:"success"}),p((0,c.KX)("staffEmployee","staffEmployee-".concat(n))),e()},error:function(e){v({message:"Something went wrong",variant:"error"})},finally:function(){N(),k()}},params:{},primaryKey:"id",values:{}}))};return{deleteLoading:_,handleClientDelete:A,showDeleteVisible:S,closeDeletePopup:k,deleteVisible:w,editVisible:Z,showEditVisible:E,closeEditPopup:D,staffCountLoading:M,staffCountResponse:T,paidMemberCount:g,fetchStaffCount:V}}},12715:function(e,t,n){n.d(t,{w:function(){return r}});var a=n(42982),r=function e(t){return t.reduce((function(t,n){if(!(n.sub_departments.length>0))return[].concat((0,a.Z)(t),[{title:n.name,key:n.id,value:n.id}]);for(;n.sub_departments.length>0;)return[].concat((0,a.Z)(t),[{title:n.name,key:n.id,value:n.id,children:e(n.sub_departments)}])}),[])}}}]);