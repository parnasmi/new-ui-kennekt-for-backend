"use strict";(self.webpackChunkkennekt_front_end_client=self.webpackChunkkennekt_front_end_client||[]).push([[9669],{2213:function(e,n,t){t.d(n,{Z:function(){return d}});var a=t(42982),r=(t(47313),t(84365)),l=t(77344),s=t(65188),i=t(87180),o=t(46417);function c(e){switch(e){case"member":return{label:"Member",value:"member"};case"admin":return{label:"Admin",value:"admin"};case"manager":return{label:"Manager",value:"manager"};default:return null}}function d(e){var n=e.entity,t=e.onSuccess,d=(0,l.m)().companyId,u=(0,s.eC)().showNotification;return n?(0,o.jsx)("div",{children:d?(0,o.jsx)(r.Z.Main,{entity:"staffEmployee",name:"staffEmployee-".concat(d),url:"".concat(d,"/employee/").concat(n.id,"/"),method:"patch",id:n.id,primaryKey:"id",sendAsFormData:!1,normalizeData:function(e){return e},updateData:!0,fields:[{name:"avatar",required:!1,value:null===n||void 0===n?void 0:n.avatar,onSubmitKey:"",type:"object",onSubmitValue:function(e){return e||null}},{name:"first_name",required:!0,value:null===n||void 0===n?void 0:n.first_name,onSubmitKey:""},{name:"username",required:!0,value:null===n||void 0===n?void 0:n.username,onSubmitKey:""},{name:"last_name",required:!0,value:null===n||void 0===n?void 0:n.last_name,onSubmitKey:""},{name:"mobile",required:!0,value:null===n||void 0===n?void 0:n.mobile,onSubmitKey:""},{name:"roles",required:!0,value:c(null===n||void 0===n?void 0:n.roles[0]),type:"object",onSubmitKey:"",onSubmitValue:function(e){return[e.value]}},{name:"departments",onSubmitValue:function(e){return e.reduce((function(e,n){return[].concat((0,a.Z)(e),[{id:n}])}),[])},required:!0,type:"array",onSubmitKey:""},{name:"can_send_news",required:!1,value:null===n||void 0===n?void 0:n.can_send_news,onSubmitKey:""}],onSuccess:function(e,n){u({message:"Success! "}),n(),t()},onError:function(e,n){var t,a,r;u({message:null!==(t=null===e||void 0===e||null===(a=e.response)||void 0===a||null===(r=a.data)||void 0===r?void 0:r.message)&&void 0!==t?t:"Something went wrong",variant:"error"}),n()},children:function(e){var a=e.isSubmitting,r=e.values,l=e.setFieldValue,s=e.errors,c=e.setFieldError,d=e.resetForm;return(0,o.jsx)(i.Z,{values:r,setFieldValue:l,setFieldError:c,isSubmitting:a,errors:s,closeModal:t,resetForm:d,departments:null===n||void 0===n?void 0:n.departments,isOwner:null===n||void 0===n?void 0:n.is_business_owner,isCreate:!1})}}):null}):null}d.defaultProps={onSuccess:function(){}}},87180:function(e,n,t){t.d(n,{Z:function(){return C}});var a=t(1413),r=t(42982),l=t(70885),s=t(47313),i=t(94715),o=t(17480),c=t(79320),d=t(70654),u=t(46225),m=t(77344),f=t(26402),p=t(69706),h=t.n(p),v=t(57864),x=t(32335),b=t(95762),g=t(12715),y=t(52654),j=t(26926),w=t(65188),_=t(11760),S=t(46417),N="".concat(x.Z.PUBLIC_ASSETS,"img"),k=[{label:"Admin",value:"admin"},{label:"Manager",value:"manager"},{label:"Member",value:"member"}];function C(e){var n,t,p=e.values,x=e.setFieldValue,C=(e.setFieldError,e.isSubmitting),Z=e.errors,E=e.closeModal,D=e.resetForm,F=e.isCreate,P=e.departments,V=e.formValuesSetter,T=void 0===V?function(){}:V,A=(0,m.m)().companyId,M=(0,_.a)(),K=M.company,L=M.userData,q=(0,w.h9)({canSend:!F&&p.can_send_news}),I=q.checked,z=q.handleChange,B=(0,s.useState)(null),O=(0,l.Z)(B,2),R=O[0],U=O[1],X=(0,s.useState)(!1),Y=(0,l.Z)(X,2),H=Y[0],G=Y[1],J=(0,s.useState)(F?null===p||void 0===p?void 0:p.avatar:null),Q=(0,l.Z)(J,2),W=Q[0],$=Q[1],ee=L.id===(null===K||void 0===K||null===(n=K.company)||void 0===n||null===(t=n.owner)||void 0===t?void 0:t.id),ne=(0,s.useState)({clientDeps:P?P.reduce((function(e,n){return n.is_staff?(0,r.Z)(e):[].concat((0,r.Z)(e),[n.id])}),[]):[],staffDeps:P?P.reduce((function(e,n){return n.is_staff?[].concat((0,r.Z)(e),[n.id]):(0,r.Z)(e)}),[]):[]}),te=(0,l.Z)(ne,2),ae=te[0],re=te[1],le=[],se=[];(0,s.useEffect)((function(){W&&x("avatar",W)}),[W]),(0,s.useEffect)((function(){ee&&x("can_send_news",!0)}),[]);var ie=ae.clientDeps,oe=ae.staffDeps;return(0,s.useEffect)((function(){x("departments",[].concat((0,r.Z)(ie),(0,r.Z)(oe)))}),[ae]),(0,s.useEffect)((function(){if(F){var e=["first_name","username","last_name","mobile","departments"],n=Object.keys(p).filter((function(n){if((Array.isArray(p[n])?p[n].length:p[n])&&e.includes(n))return p[n]}));T(n)}}),[p]),(0,s.useEffect)((function(){x("can_send_news",I.canSend)}),[I.canSend]),console.log("deps",{deps:ae,errors:Z}),(0,S.jsxs)("div",{id:"department-form",children:[(0,S.jsxs)("div",{className:"branch-form__header border-b border-kgrey-dark-1/30 px-6 py-4 -mt-5 flex-center-between",children:[(0,S.jsx)("div",{className:"branch-form__heading font-base font-medium",children:"".concat(F?"Create new":"Edit"," staff")}),F?(0,S.jsx)("div",{className:"branch-form__reset text-kgrey text-sm cursor-pointer hover:text-kdark transition",onClick:D,children:"Clear"}):null]}),(0,S.jsxs)("div",{className:" w-100 p-6",children:[(0,S.jsx)("div",{className:"text-sm font-light mb-2 ml-2 text-kgrey-menuText",children:"Profile photo"}),(0,S.jsxs)("div",{className:"flex items-center mb-5",children:[(0,S.jsxs)("div",{className:"user-avatar-box__display relative dark:bg-kdark-lighter  w-20 h-20 rounded-full overflow-hidden flex-centered",children:[(0,S.jsx)("img",{src:F?h()(W,"thumbnail_150")||"".concat(N,"/chat-placeholder.png"):h()(null===p||void 0===p?void 0:p.avatar,"thumbnail_150")||"".concat(N,"/chat-placeholder.png"),alt:"",className:"object-fit"}),null!==R&&(0,S.jsxs)("div",{className:"absolute top-1/2 left-1/2 -translate-y-1/2 -translate-x-1/2 w-10 h-10 z-10",children:[(0,S.jsx)("div",{className:"upload-media-spinner",children:(0,S.jsx)(c.aN,{variant:"determinate",value:R})}),(0,S.jsx)("div",{onClick:function(){G(!0),U(null)},className:"absolute w-8 h-8 z-20 top-1/2 left-1/2 -translate-y-1/2 -translate-x-1/2 text-3xl text-primary-dark hover:text-primary transition cursor-pointer",children:(0,S.jsx)(v.SV5,{})})]})]}),(0,S.jsx)("div",{className:"ml-5",children:(0,S.jsx)(c.bA,{uploadMeta:R,setUploadMeta:U,cancelSending:H,setCancelSending:G,setFile:$})})]}),(0,S.jsx)(i.gN,{label:"First name:",name:"first_name",component:o.Mg,placeholder:"Enter First name"}),(0,S.jsx)(i.gN,{label:"Last name",name:"last_name",component:o.Mg,placeholder:"Enter Last name"}),(0,S.jsx)(i.gN,{label:"Email",name:"username",component:o.Mg,placeholder:"Enter Email"}),(0,S.jsx)(i.gN,{label:"Phone number",name:"mobile",component:o.UO,placeholder:"Enter company mobile phone number",enableSearch:!0,onChangeHandler:x}),(0,S.jsxs)("div",{className:"row align-user-start remove-inner-label mb-3.5",children:[(0,S.jsx)("div",{className:"text-sm font-light mb-2 ml-2 text-kgrey-menuText",children:"Staff Departments"}),(0,S.jsx)(b.Z.All,{entity:"tree",name:"AllTreeDepartments-Staff-".concat(A),url:"/".concat(A,"/departments/tree/"),params:{limit:100,extra:{is_staff:"True"}},children:function(e){var n=e.items,t=e.isFetched;return le=t&&(0,g.w)(n),(0,S.jsx)(S.Fragment,{children:t?(0,S.jsxs)("div",{children:[(0,S.jsx)(f.ZP,(0,a.Z)({getPopupContainer:function(e){return e.parentNode},className:"w-full",transitionName:"rc-tree-select-dropdown-slide-up",choiceTransitionName:"rc-tree-select-selection__choice-zoom",dropdownStyle:{overflow:"auto"},dropdownPopupAlign:{overflow:{adjustY:0,adjustX:0},offset:[0,2]},placeholder:(0,S.jsx)("i",{children:"Select Staff Departments"}),searchPlaceholder:"please search",treeLine:!0,maxTagTextLength:10,multiple:!0,allowClear:!0,autoClearSearchValue:!0,treeData:le,treeNodeFilterProp:"title",treeCheckable:!0,showCheckedStrategy:f.hT,onChange:function(e){re((function(n){return(0,a.Z)((0,a.Z)({},n),{},{staffDeps:e})}))}},F?null:{value:(0,r.Z)(oe)})),null!==oe&&void 0!==oe&&oe.length?null:(0,S.jsx)(i.Bc,{name:"departments",children:function(e){return(0,S.jsx)("div",{className:"text-xs text-red-500 mt-0.5",children:e})}}),null!==oe&&void 0!==oe&&oe.length||null!==Z&&void 0!==Z&&Z.departments?null:(0,S.jsx)("p",{className:"text-xs text-red-500 mt-0.5",children:"Select at least one staff department"})]}):(0,S.jsx)("div",{className:"flex justify-center",children:(0,S.jsx)(c.aN,{})})})}})]}),(0,S.jsxs)("div",{className:"mb-3.5",children:[(0,S.jsx)("div",{className:"text-sm font-light mb-2 ml-2 text-kgrey-menuText",children:"Client Departments"}),(0,S.jsx)(b.Z.All,{entity:"tree",name:"AllTreeDepartments-Client-".concat(A),url:"/".concat(A,"/departments/tree/"),params:{limit:100,extra:{is_staff:"False"}},children:function(e){var n=e.items,t=e.isFetched;return se=t&&(0,g.w)(n),(0,S.jsx)(S.Fragment,{children:t?(0,S.jsxs)("div",{children:[(0,S.jsx)(f.ZP,(0,a.Z)({getPopupContainer:function(e){return e.parentNode},className:"w-full",transitionName:"rc-tree-select-dropdown-slide-up",choiceTransitionName:"rc-tree-select-selection__choice-zoom",dropdownStyle:{overflow:"auto"},dropdownPopupAlign:{overflow:{adjustY:0,adjustX:0},offset:[0,2]},placeholder:(0,S.jsx)("i",{children:"Select \u0421lient Departments"}),searchPlaceholder:"please search",treeLine:!0,maxTagTextLength:10,multiple:!0,allowClear:!0,autoClearSearchValue:!0,treeData:se,treeNodeFilterProp:"title",treeCheckable:!0,showCheckedStrategy:f.hT,onChange:function(e){re((function(n){return(0,a.Z)((0,a.Z)({},n),{},{clientDeps:e})}))}},F?null:{value:(0,r.Z)(ie)})),null!==ie&&void 0!==ie&&ie.length?null:(0,S.jsx)(i.Bc,{name:"departments",children:function(e){return(0,S.jsx)("div",{className:"text-xs text-red-500 mt-0.5",children:e})}})]}):(0,S.jsx)("div",{className:"flex justify-center",children:(0,S.jsx)(c.aN,{})})})}})]}),(0,S.jsxs)("div",{className:"mb-3.5",children:[(0,S.jsx)("div",{className:"text-sm font-light mb-2 text-kgrey-menuText ml-2",children:"Roles"}),(0,S.jsx)(i.gN,{component:o.mg,styles:d.gb,name:"roles",defaultValue:k[2],options:[].concat(k),isSearchable:!u.tq})]}),(0,S.jsx)("div",{children:(0,S.jsx)(j.D8,{control:(0,S.jsx)(y.k,{checked:I.canSend,onChange:z,name:"canSend"}),label:"Can send news",className:"mb-4",classes:{label:"!text-xs font-light text-kgrey-welcome"}})})]}),(0,S.jsxs)("div",{className:"branch-form__footer px-6 pt-4 pb-9 flex justify-end",children:[(0,S.jsx)(c.Ik,{className:"text-kgrey border-kgrey border mr-5",color:"default",onClick:E,children:"Cancel"}),(0,S.jsx)(c.Ik,{className:"dark:hover:bg-primary-300 dark:focus:ring-primary-300 dark:text-white",type:"submit",isSubmitting:C,color:"primary",isDisabled:!(null!==oe&&void 0!==oe&&oe.length)&&!(null!==Z&&void 0!==Z&&Z.departments),children:F?"Create":"Update"})]}),C?(0,S.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-white bg-opacity-70",children:(0,S.jsx)(c.aN,{})}):null]})}C.defaultProps={isCreate:!0,department:null,resetForm:function(){}}},23867:function(e,n,t){t.d(n,{O:function(){return f}});var a=t(15861),r=t(70885),l=t(64687),s=t.n(l),i=t(65188),o=t(77344),c=t(93905),d=t(92241),u=t(47313),m=t(11760);function f(){var e=(0,o.m)().companyId,n=(0,m.a)().companies,t=(0,d.I0)(),l=(0,i.eC)().showNotification,f=(0,u.useState)(0),p=(0,r.Z)(f,2),h=p[0],v=p[1],x=(0,i.iR)(),b=x.visible,g=x.showVisible,y=x.loading,j=x.toggleLoading,w=x.closePopup,_=(0,i.iR)(),S=_.visible,N=_.showVisible,k=_.closePopup,C=(0,i.bK)({url:"/".concat(e,"/companies/staffs_count/")}),Z=C.fetchData,E=C.response,D=C.loading;(0,u.useEffect)((function(){e&&(0,a.Z)(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Z();case 2:case"end":return e.stop()}}),e)})))()}),[e]),(0,u.useEffect)((function(){if(e&&n.length){var t=n.find((function(n){return n.company.id===e})),a=null===t||void 0===t?void 0:t.company.comp_subscription;a&&v(a.paid_staffs_count)}}),[n,e]);return{deleteLoading:y,handleClientDelete:function(n){j(),t((0,c.Bi)({entity:"staffEmployee",name:"staffEmployee-".concat(e),method:"delete",url:"/".concat(e,"/employee/").concat(n.id,"/"),deleteData:!0,id:n.id,cb:{success:function(){l({message:"Successfully deleted",variant:"success"}),t((0,c.KX)("staffEmployee","staffEmployee-".concat(e)))},error:function(e){l({message:"Something went wrong",variant:"error"})},finally:function(){j(),w()}},params:{},primaryKey:"id",values:{}}))},showDeleteVisible:g,closeDeletePopup:w,deleteVisible:b,editVisible:S,showEditVisible:N,closeEditPopup:k,staffCountLoading:D,staffCountResponse:E,paidMemberCount:h}}},12715:function(e,n,t){t.d(n,{w:function(){return r}});var a=t(42982),r=function e(n){return n.reduce((function(n,t){if(!(t.sub_departments.length>0))return[].concat((0,a.Z)(n),[{title:t.name,key:t.id,value:t.id}]);for(;t.sub_departments.length>0;)return[].concat((0,a.Z)(n),[{title:t.name,key:t.id,value:t.id,children:e(t.sub_departments)}])}),[])}}}]);