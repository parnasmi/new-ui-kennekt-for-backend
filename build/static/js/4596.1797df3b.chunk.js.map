{"version":3,"file":"static/js/4596.1797df3b.chunk.js","mappings":"0yBAoFA,MA5EA,WACC,OAAwBA,EAAAA,EAAAA,UAAS,0CAAjC,eAAOC,EAAP,KAAaC,EAAb,KACMC,GAAoBC,EAAAA,EAAAA,SAAO,GAEzBC,GAAUC,EAAAA,EAAAA,MAAVD,MACR,GAAmCE,EAAAA,EAAAA,KAA3BC,EAAR,EAAQA,UAAWC,EAAnB,EAAmBA,YACXC,GAAwBC,EAAAA,EAAAA,KAAxBD,oBACFE,GAAUC,EAAAA,EAAAA,OAIhBC,EAAAA,EAAAA,YAAU,WACT,IAAIX,EAAkBY,QAAtB,CAGA,IAAQC,EAA+DX,EAA/DW,YAAaC,EAAkDZ,EAAlDY,OAAQC,EAA0Cb,EAA1Ca,UAAWC,EAA+Bd,EAA/Bc,iBAAkBC,EAAaf,EAAbe,SAK1D,GAHAX,EAAYW,GAGRZ,IAAca,OAAOF,GAcxB,OAbAjB,EAAQ,iDAGRoB,EAAc,CACbC,IAAI,mBACJC,wBAAyBL,EACzBM,OAAQ,CACPC,MAAO,YAITvB,EAAkBY,SAAU,GAMT,SAAhBC,GACHJ,EAAQe,KAAR,+BAAqCT,EAArC,mBAAyDD,IAGtC,QAAhBD,GACHJ,EAAQe,KAAR,4BAAkCT,OAEjC,CAACV,IAGJ,OAAqCoB,EAAAA,EAAAA,IAAS,CAC7CL,IAAK,GACLM,YAAY,EACZC,GAAI,CACHC,QAAQ,WAAD,wBAAE,aAAoBC,GAApB,kFAASC,EAAT,EAASA,QAETT,EAA4BQ,EAAK,GAAjCR,wBACFU,EAAaD,EAAQE,MAC1B,SAACC,GAAD,OAAkBA,EAAIC,QAAQC,KAAOjB,OAAOG,MAJrC,SAQFd,EAAoBwB,GARlB,OAWkB,SAAtB7B,EAAMW,YACTJ,EAAQe,KAAR,+BAAqCtB,EAAMa,UAA3C,mBAA+Db,EAAMY,SAErEL,EAAQe,KAAR,4BAAkCtB,EAAMa,YAdjC,2CAAF,qDAAC,GAiBRqB,MAAO,SAACA,EAAOP,QArBEV,EAAnB,EAAQkB,UAyBR,OAAO,gBAAKC,UAAW,oCAAhB,SAAsDxC","sources":["pages/PreloaderPage/PreloaderPage.tsx"],"sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\nimport { useAxios, useQueryParams } from 'shared/hooks';\nimport { useAppState } from 'shared/state';\nimport { useHistory } from 'react-router';\nimport { Company } from '../../modules/user/reducers';\nimport { useAsStaff } from '../BusinessManagement/hooks/useAsStaff';\nimport { CaseType } from '../../shared/state/reducer';\n\nfunction PreloaderPage() {\n\tconst [text, setText] = useState('Checking data. Please, wait a while...');\n\tconst switchBusinessRef = useRef(false);\n\n\tconst { query } = useQueryParams();\n\tconst { companyId, setCaseType } = useAppState();\n\tconst { handleChangeCompany } = useAsStaff();\n\tconst history = useHistory();\n\n\t//Check case or chat whether it belongs to current selected company before opening chat or case\n\t//If case|chat is belongs not to selected company we must switch business before opening it\n\tuseEffect(() => {\n\t\tif (switchBusinessRef.current) {\n\t\t\treturn;\n\t\t}\n\t\tconst { entity_type, status, entity_id, business_company, caseType } = query;\n\n\t\tsetCaseType(caseType as CaseType);\n\n\t\t//If the notification is not from selected business we must switch business\n\t\tif (companyId !== Number(business_company)) {\n\t\t\tsetText('Switching business... Please, wait a while...');\n\n\t\t\t//Send async request to get list of user companies\n\t\t\tfetchBusiness({\n\t\t\t\turl: `/user/companies/`,\n\t\t\t\tnotificationFromCompany: business_company,\n\t\t\t\tparams: {\n\t\t\t\t\tlimit: 100\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tswitchBusinessRef.current = true;\n\n\t\t\treturn;\n\t\t}\n\n\t\t//If case | chat is for current selected company we open it immediately\n\t\tif (entity_type === 'case') {\n\t\t\thistory.push(`/case-messages/?case=${entity_id}&status=${status}`);\n\t\t}\n\n\t\tif (entity_type === 'ims') {\n\t\t\thistory.push(`/group-chat/?chat=${entity_id}`);\n\t\t}\n\t}, [companyId]);\n\n\t//loading companies list before switching to another business\n\tconst { fetchData: fetchBusiness } = useAxios({\n\t\turl: '',\n\t\tdynamicUrl: true,\n\t\tcb: {\n\t\t\tsuccess: async ({ results }, args) => {\n\t\t\t\t//Switch to selected business whose notification came\n\t\t\t\tconst { notificationFromCompany } = args[0];\n\t\t\t\tconst newCompany = results.find(\n\t\t\t\t\t(cmp: Company) => cmp.company.id === Number(notificationFromCompany)\n\t\t\t\t);\n\n\t\t\t\t//switch to business from push\n\t\t\t\tawait handleChangeCompany(newCompany);\n\n\t\t\t\t//Open case or chat after switching is successful\n\t\t\t\tif (query.entity_type === 'case') {\n\t\t\t\t\thistory.push(`/case-messages/?case=${query.entity_id}&status=${query.status}`);\n\t\t\t\t} else {\n\t\t\t\t\thistory.push(`/group-chat/?chat=${query.entity_id}`);\n\t\t\t\t}\n\t\t\t},\n\t\t\terror: (error, args) => {}\n\t\t}\n\t});\n\n\treturn <div className={'h-full w-full p-8 dark:text-white'}>{text}</div>;\n}\n\nexport default PreloaderPage;\n"],"names":["useState","text","setText","switchBusinessRef","useRef","query","useQueryParams","useAppState","companyId","setCaseType","handleChangeCompany","useAsStaff","history","useHistory","useEffect","current","entity_type","status","entity_id","business_company","caseType","Number","fetchBusiness","url","notificationFromCompany","params","limit","push","useAxios","dynamicUrl","cb","success","args","results","newCompany","find","cmp","company","id","error","fetchData","className"],"sourceRoot":""}