!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=(new Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="edd81776-4eb3-4a9d-ad20-23fcba065963",e._sentryDebugIdIdentifier="sentry-dbid-edd81776-4eb3-4a9d-ad20-23fcba065963")}catch(e){}}();var _global="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};_global.SENTRY_RELEASE={id:"92c588a922034147d52c8df4651841419a0c4114"},(self.webpackChunkkennekt_front_end_client=self.webpackChunkkennekt_front_end_client||[]).push([[3814],{3814:function(e,t,n){n.r(t),n.d(t,{default:function(){return un}});var a=n(29439),i=n(72791),s=n(85880),r=n(22553),l=n(40084),o=n(16178),c=n(27945),d=n(94389),u=n(76188),m=n(62055),h=n(26181),p=n.n(h),g=n(78820),f=n(9478),x=n(17173),v=n(80184),_="".concat(f.Z.PUBLIC_ASSETS,"img");function b(e){var t=e.onSuccess,n=e.setFieldValue,s=e.isSubmitting,r=e.values,l=e.isEditing,o=void 0!==l&&l,c=(0,i.useState)(null),h=(0,a.Z)(c,2),f=h[0],b=h[1],y=(0,i.useState)(!1),j=(0,a.Z)(y,2),Z=j[0],w=j[1],N=(0,i.useState)(o?r.image:null),C=(0,a.Z)(N,2),k=C[0],S=C[1],M=(0,x.$G)().t;return(0,i.useEffect)((function(){k&&n("image",k)}),[k]),(0,v.jsxs)("div",{children:[(0,v.jsx)("h2",{className:"mb-4 text-xl font-bold",children:M(o?"edit_group_chat":"create_group_chat")}),(0,v.jsx)(u.gN,{label:M("group_chat_title"),labelClasses:"ml-6 text-xs font-light text-kgrey-welcome mb-2 block",name:"title",component:d.Mg,placeholder:M("enter_group_title"),required:!0,autoComplete:"off",maxLength:100,onBlur:function(e){var t,a;n(e.target.name,null===(t=e.target)||void 0===t||null===(a=t.value)||void 0===a?void 0:a.trim())}}),(0,v.jsx)(u.gN,{label:M("group_description"),labelClasses:"ml-6 text-xs font-light text-kgrey-welcome mb-2 block",placeholder:M("type_group_description"),name:"description",component:d.Mg,type:"textarea",autoComplete:"off",maxLength:250}),(0,v.jsxs)("div",{className:"mb-4 flex items-center",children:[(0,v.jsx)("div",{className:"mr-4",children:(0,v.jsx)(m.bA,{uploadMeta:f,setUploadMeta:b,cancelSending:Z,setCancelSending:w,setFile:S,accept:".jpg,.jpeg,.png,.webg"})}),(0,v.jsxs)("div",{className:"user-avatar-box__display relative h-20 w-20 overflow-hidden rounded-full",children:[(0,v.jsx)("img",{src:p()(k,"thumbnail_150")||"".concat(_,"/chat-placeholder.svg"),alt:"",className:"h-full object-cover"}),null!==f&&(0,v.jsxs)("div",{className:"absolute top-1/2 left-1/2 z-10 h-10 w-10 -translate-y-1/2 -translate-x-1/2",children:[(0,v.jsx)("div",{className:"upload-media-spinner",children:(0,v.jsx)(m.aN,{variant:"determinate",value:f})}),(0,v.jsx)("div",{onClick:function(){w(!0),b(null)},className:"absolute top-[21px] left-[25px] z-20 h-8 w-8 -translate-y-1/2 -translate-x-1/2 cursor-pointer text-3xl text-primary-dark transition hover:text-primary",children:(0,v.jsx)(g.SV5,{})})]})]})]}),(0,v.jsxs)("div",{className:"btn-row mt-6 flex justify-end",children:[s&&(0,v.jsx)(m.aN,{tiled:!0,withOverlay:!0}),(0,v.jsx)(m.zx,{className:"mr-5 border border-kgrey text-kgrey",type:"button",onClickHandler:t,children:M("cancel")}),(0,v.jsx)(m.Ik,{type:"submit",className:"ml-4 dark:text-white dark:hover:bg-primary-300 dark:focus:ring-primary-300",color:"primary",isDisabled:s||!!f,children:M(o?"edit_group_chat":"create_group_chat")})]})]})}function y(e){var t=e.onSuccess,n=(0,l.m)(),a=n.companyId,i=n.groupSearchQuery,s=(0,o.Kx)().changeUrlParams;return(0,v.jsx)(c.Z.Main,{entity:"ims-chats",name:"AllImsChats-".concat(a,"-").concat(i),url:"/".concat(a,"/ims/groups/"),method:"post",primaryKey:"id",sendAsFormData:!1,normalizeData:function(e){return e},prependData:!0,fields:[{name:"title",required:!0,value:"",onSubmitKey:""},{name:"description",value:"",onSubmitKey:""},{name:"image",onSubmitKey:"",type:"object"}],onSuccess:function(e,n){s({chat:e.id}),t(),n()},onError:function(e,t){console.log(e)},children:function(e){var n=e.isSubmitting,a=e.values,i=e.setFieldValue;return(0,v.jsx)(b,{onSuccess:t,isSubmitting:n,setFieldValue:i,values:a})}})}var j=n(8826),Z=n(84373),w=n(39126),N=n(90218),C=n(28182);function k(e){var t,n=e.toggleIsUnreadFilter,c=e.isUnreadFilter,d=(0,i.useState)(""),u=(0,a.Z)(d,2),m=u[0],h=u[1],p=(0,r.Z)(m,500),f=(0,a.Z)(p,1)[0],_=(0,l.m)(),b=_.setGroupSearchQuery,k=_.groupsUnreadCountData,S=(0,o.dF)(),M=S.open,I=S.modalHandler,D=S.WhiteModal,F=null===(t=Object.values(k))||void 0===t?void 0:t.filter((function(e){return e>0})).length,P=(0,x.$G)().t,E=(0,N.K)().isRTL;return(0,i.useEffect)((function(){b(f)}),[f]),(0,v.jsxs)("div",{className:"mb-4 flex",children:[F?(0,v.jsx)("div",{onClick:function(){return n()},className:(0,C.Z)("relative mt-1.5 cursor-pointer rounded-10 bg-kgrey-dark-2 p-2",E?"ml-3":"mr-3"),children:c?(0,v.jsx)(g.n5H,{}):(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("span",{className:"absolute -top-1 left-1.5 right-1.5 rounded-md bg-kred-pink text-center text-10px text-white",children:F}),(0,v.jsx)(w.nzA,{})]})}):null,(0,v.jsxs)("div",{className:"group-sidebar__search relative flex-grow  pr-2",children:[(0,v.jsx)("input",{type:"search",value:m,className:"group-sidebar__search-input w-full border-b px-4 outline-none border-kgrey-border-solid pl-7 transition focus:border-primary placeholder-[rgba(45, 45, 45, 0.3)] py-2 dark:bg-kdark dark:text-white",placeholder:P("search_for_chats"),onChange:function(e){return h(e.target.value)}}),(0,v.jsx)("div",{className:(0,C.Z)("absolute top-1/2 -translate-y-1/2",{"right-0":E,"left-0":!E}),children:(0,v.jsx)("div",{className:"text-kgrey",children:(0,v.jsx)(s.lnn,{})})})]}),(0,v.jsx)(j.Z,{color:"primary",size:"small",onClick:I,children:(0,v.jsx)(Z.D0w,{className:"text-2xl text-white"})}),(0,v.jsx)(D,{handleModalOpen:I,open:M,children:(0,v.jsx)(y,{onSuccess:I})})]})}var S=n(1413),M=n(93433),I=n(28175),D=n(30168),F=n(52554),P=n(92005),E=n(26e3),A=n(80266),R=n(38145),L=n(53148),O=n(51859),B=n(76525),K=n(32380),T=n(87818),U=K.Z.entities.updateEntitiesSuccess;function G(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=(0,i.useState)(null),r=(0,a.Z)(s,2),c=r[0],d=r[1],u=(0,i.useState)(!1),m=(0,a.Z)(u,2),h=m[0],p=m[1],g=(0,l.m)(),f=g.companyId,x=(g.toggleChatPanel,Boolean(c)),v=(0,T.I0)(),_=(0,o.bK)({url:"/".concat(f,"/ims/groups/").concat(t,"/pin/"),method:"".concat(e?"delete":"put"),cb:{success:function(e,i){var s=(0,a.Z)(i,1)[0];v(U({entity:"ims-chats",entityId:String(t),data:{pin_time:s?Date.now():null}})),n&&v(U({entity:"ims-chats",entityId:String(t),data:{pin_time:s?Date.now():null}}))},error:function(e){}}}).fetchData;return{open:x,handleClick:function(e){d(e.currentTarget)},anchorEl:c,managerRequested:h,handleNotificationClose:function(e,t){"clickaway"!==t&&p(!1)},handleMenuItemClick:function(e){switch(e){case"pin":_(!0);break;case"unpin":_(!1);break;default:return null}},handleCloseMenu:function(){d(null)}}}var H,W=n(60978),$=n(63524),V=n(64923),Q="".concat(f.Z.PUBLIC_ASSETS,"img/");function q(e){var t,n,a=e.chatId,i=e.image,s=e.title,r=e.last_message_author,c=e.last_message_type,d=e.last_message_text,u=e.last_message_time,m=e.pin_time,h=e.draftMessage,p=e.isMuted,g=void 0!==p&&p,f=e.lastReadMessage,v=void 0===f?null:f,_=(0,l.m)(),b=_.groupsUnreadCountData,y=_.setActiveDraft,j=_.chatsMentionList,Z=_.scheduledMessageIds,w=_.setChatUuid,N=(0,o.Kx)(),k=N.changeUrlParams,M=N.query,I=(0,x.$G)().t,K=G(m,a),T=K.open,U=K.handleClick,q=K.anchorEl,z=K.handleMenuItemClick,X=K.handleCloseMenu,Y=M&&Number(M.chat)===a,J=i||"".concat(Q,"chat-placeholder.png"),ee=null==b?void 0:b[a],te=null==j||null===(t=j[a])||void 0===t?void 0:t.length,ne=null==Z||null===(n=Z[a])||void 0===n?void 0:n.length;return(0,V.tZ)("div",{className:(0,C.Z)("chat-item mb-3 cursor-pointer rounded-lg p-2 transition hover:opacity-80 ",{"bg-primary-300 dark:bg-primary-300":Y,"dark:bg-white/10":!Y}),children:(0,V.BX)("div",{className:"chat-item__inner flex w-full items-center justify-between",children:[(0,V.tZ)("div",{className:"chat-item__img h-14 w-14 flex-shrink-0 overflow-hidden rounded-full",children:(0,V.tZ)("img",{src:J,alt:"",className:"h-full object-cover"})}),(0,V.BX)("div",{className:"chat-item__body flex flex-grow items-center justify-between pl-2",css:(0,F.iv)(H||(H=(0,D.Z)(["\n\t\t\t\t\t\twidth: 275px;\n\t\t\t\t\t"]))),children:[(0,V.BX)("div",{className:"chat-item__content w-9/12 overflow-hidden pr-2",onClick:function(){k((0,S.Z)({chat:a},(0,S.Z)({},v&&ee?{unread:v,hasUnreadMessage:!0,lastReadMessage:v}:{})),!0),w((0,P.x0)()),y(h)},children:[(0,V.BX)("div",{className:"chat-item__title flex-center-y truncate text-sm font-semibold dark:text-white",children:[(0,V.tZ)("span",{children:s}),g&&(0,V.tZ)("span",{className:"ml-1 block h-4 w-4 text-kgrey",children:(0,V.tZ)(B.vP,{})})]}),(0,V.tZ)("div",{className:"chat-item__muted",children:r?(0,V.tZ)(E.cm,{last_message_type:c,last_message_text:d||"",last_message_author:r,draftMessage:h}):null})]}),(0,V.BX)("div",{className:"chat-item__info  flex w-3/12 flex-shrink-0 flex-col  items-end",children:[(0,V.BX)("div",{className:"chat-item___actions mb-2.5 flex items-center justify-between",children:[(0,V.tZ)("div",{className:"chat-item__date text-[10px] font-bold text-kgrey-chatGrey/30 dark:text-white",children:A.XV.toLastTime(u)}),(0,V.BX)("div",{className:"chat-item__dots",children:[(0,V.tZ)("div",{className:"more-btn w-4 cursor-pointer pr-1.5 text-right text-kgrey-menuText transition-colors hover:text-primary dark:text-white dark:hover:text-primary",onClick:U,children:(0,V.tZ)(R.i,{className:"inline"})}),(0,V.tZ)(L.v2,{id:"long-menu",anchorEl:q,keepMounted:!0,open:T,onClose:X,children:(0,V.tZ)(O.Z,{onClick:function(){X(),z(m?"unpin":"pin")},children:I(m?"unpin_chat":"pin_chat")})})]})]}),(0,V.BX)("div",{className:"chat-item___pin mt-auto flex items-center justify-end leading-none",children:[ne?(0,V.tZ)("div",{className:"chat-item__scheduled-icon mr-1.5 items-start text-xl dark:text-white",children:(0,V.tZ)($.lPB,{})}):null,m?(0,V.tZ)(B.Dg,{className:"text-kgrey-menuText"}):null,ee?(0,V.tZ)("div",{className:(0,C.Z)("ml-2 h-6 w-6  rounded-full text-center text-sm font-semibold leading-6 text-white",{"bg-primary":!g,"bg-kgrey":g}),children:ee}):null,te?(0,V.tZ)("div",{className:" px-1 text-lg text-primary",children:(0,V.tZ)(W.Hlc,{})}):null]})]})]})]})})}function z(e){var t=e.chatId,n=e.image,a=e.pin_time,i=e.last_message_type,s=e.last_message_text,r=e.title,l=e.last_message_author,o=e.last_message_time,c=e.isMuted,d=e.draftMessage,u=e.lastReadMessage;return(0,v.jsx)(q,{chatId:t,title:r,image:n,last_message_author:l,last_message_type:i,last_message_text:s,last_message_time:o,pin_time:a,isMuted:c,draftMessage:d,lastReadMessage:u})}function X(e){return(0,v.jsx)(m.SV,{isCompact:!0,children:(0,v.jsx)(z,(0,S.Z)({},e))})}var Y=n(35741),J=n(97689),ee=n(82486);function te(e){var t=e.isUnreadFilter,n=(0,i.useState)(1),s=(0,a.Z)(n,2),r=s[0],c=s[1],d=(0,i.useState)(1),u=(0,a.Z)(d,2),h=u[0],p=u[1],g=(0,l.m)(),f=g.companyId,x=g.groupSearchQuery,_=g.groupsUnreadCountData,b=(0,J.a)().userData,y=(0,o.Kx)().query.chat;return(0,i.useEffect)((function(){p(1),c(1)}),[x,t]),(0,v.jsx)("div",{className:"group-sidebar__chats flex-grow overflow-y-auto pt-2",children:f?(0,v.jsx)(Y.Z.All,{entity:"ims-chats",name:"AllImsChats-".concat(f,"-").concat(x),url:"/".concat(f,"/ims/groups/"),params:{extra:(0,ee.f)(x,t),limit:ee.B,page:x.length?h:r},appendData:!0,isCancellable:!!x.length,cancelField:"groupChat",children:function(e){var n=e.items,a=e.isFetched,s=e.meta,l=n.filter((function(e){return t?_[e.id]>0||e.id.toString()===y:e})),o=(0,A.kd)(l);return(0,v.jsxs)(v.Fragment,{children:[o.map((function(e){var t,n,a;return(0,v.jsx)(i.Fragment,{children:(0,v.jsx)(X,{chatId:e.id,title:e.title,pin_time:e.pin_time,last_message_type:e.last_message_type,last_message_author:e.last_message_author,last_message_text:e.last_message_text,last_message_time:e.last_message_time,image:(null===(t=e.image)||void 0===t?void 0:t.thumbnail_150)||null,isMuted:null==e||null===(n=e.members)||void 0===n||null===(a=n.find((function(e){return e.user.id===b.id})))||void 0===a?void 0:a.is_mute,draftMessage:e.draft_message,lastReadMessage:e.last_read_message},e.id)},e.id)})),(0,v.jsx)(v.Fragment,{children:a?null:(0,v.jsx)(v.Fragment,{children:(0,M.Z)(Array(10)).map((function(e,t){return(0,v.jsx)("div",{className:"mb4",children:(0,v.jsx)(ae,{})},t)}))})}),(0,v.jsx)(v.Fragment,{children:a&&null!=s&&s.current_page&&null!=s&&s.last_page&&(null==s?void 0:s.current_page)<(null==s?void 0:s.last_page)?(0,v.jsx)(m.$K,{setPage:function(){s.current_page!==r?c(s.current_page):x.length?p(h+1):c(r+1)}}):null})]})}}):null})}function ne(e){return(0,v.jsx)(m.SV,{children:(0,v.jsx)(te,(0,S.Z)({},e))})}function ae(){return(0,v.jsxs)(I.ZP,{speed:2,width:362,height:72,viewBox:"0 0 362 72",backgroundColor:"#f3f3f3",foregroundColor:"#ecebeb",children:[(0,v.jsx)("circle",{cx:"48",cy:"33",r:"24"}),(0,v.jsx)("rect",{x:"79",y:"14",rx:"7",ry:"7",width:"217",height:"18"}),(0,v.jsx)("rect",{x:"80",y:"42",rx:"5",ry:"5",width:"155",height:"11"}),(0,v.jsx)("rect",{x:"351",y:"12",rx:"4",ry:"4",width:"12",height:"32"}),(0,v.jsx)("rect",{x:"313",y:"13",rx:"5",ry:"5",width:"30",height:"11"})]})}var ie,se=n(96206),re=n(9321),le=n(70629),oe=n(94370),ce=n(46763),de=n(14545),ue=n(44740),me=n(46572),he=n.n(me),pe=n(28843),ge=n(30663);function fe(e){var t=e.chatId,n=(0,x.$G)().t,s=(0,re.Z)(),r=(0,a.Z)(s,2),c=r[0],d=r[1].height,u=(0,de.O9)(),m=u.setIsDelayedMessage,h=u.isDelayedMessage,p=(0,o.JN)().afterMessagesFetchService,g=(0,l.m)(),f=(g.entityPage,g.groupsUnreadCountData),v=(0,o.Kx)().query,_=v.unread&&Number(v.unread)||null,b=!(null==f||!f[t]),y=(0,i.useMemo)((function(){return!(null==f||!f[t])}),[t]),j=(0,i.useRef)(null),Z=(0,oe.m)(),w=Z.entityId,N=Z.isSetSearchReply,k=Z.allowToLoad,S=Z.setAllowToLoad,M=Z.direction,I=Z.messagesLimit,P=Z.replyLoading,E=Z.scrollToMsgId,A=(Z.state,Z.setScrollPosition),R=Z.isMsgHasBeenIndicated,L=Z.virtuosoRef,O=Z.isScheduledChat,B=Z.entityType,K=Z.isBottomLoading,T=Z.setBottomLoading,U=(0,o.QY)({entity:"ims-chats",entityId:w,entityName:"GroupChat-".concat(w,"One")}),G=(0,ue.W)(),H=G.cursorTop,W=G.cursorBot,$=G.handlePageLoading,Q=G.localEntityId,q=G.scrollIntoElement,z=G.isLoadedRepliedMessage,X=G.messageVisibleHandler,J=G.setUpdateEntityPage,ee=G.searchedMessageId,te=G.paginationDepsRef,ne=G.cursor,ae=G.isLastPageFetched,se=G.setIsLastPageFetched,me=G.isFirstPageFetched,fe=G.setIsFirstPageFetched,xe=(G.totalMessagesCount,G.removeUnreadCountFromCaseList),ve=G.messagesUrl,_e=G.handleFollowOutput;var be=_&&null===M,ye=(0,pe.pA)({isScheduled:O,entityId:Q,entityType:B});return(0,V.tZ)(Y.Z.All,{entity:"imsMessages",name:ye,url:ve,primaryKey:"custom_uuid",prependData:("next"===M||null===M)&&!N,appendData:"previous"===M&&!N,isUniq:!0,cursorBased:!0,direction:_&&null===M?"1":ne===Number(E)?"0":"next"===M||null===M?"-1":"1",replaceIds:z&&ne===E&&null===M||null===ne&&("next"===M||null===M)||b&&!!_,params:{limit:I,extra:{entity_id:Q,cursor:ne}},onInit:function(e){p({data:e,isDelayedMessage:h,setIsDelayedMessage:m,setAllowToLoad:S,direction:M,scrollToMsgId:E,isMsgHasBeenIndicated:R,cursorTop:H,cursorBot:W,scrollIntoElement:q,setUpdateEntityPage:J,searchedMessageId:ee,paginationDepsRef:te,cursor:ne,setIsLastPageFetched:se,messagesLimit:I,setIsFirstPageFetched:fe,setBottomLoading:T,isLoadedRepliedMessage:z,virtuosoRef:L})},children:function(e){var a,i,s=e.items,r=e.isFetched,l=e.meta,o=null!==(a=s)&&void 0!==a?a:[],u=k||!N;return(0,V.tZ)("div",{ref:c,id:"chat-body",className:(0,C.Z)("chat__body flex-grow"),children:(0,V.tZ)("div",{className:(0,C.Z)("h-full w-full px-5",{"pt-11":null===(i=U.item)||void 0===i?void 0:i.pinned_message}),css:(0,F.iv)(ie||(ie=(0,D.Z)(["\n\t\t\t\t\t\t\t\theight: ",";\n\t\t\t\t\t\t\t"])),le.G6&&"".concat(d,"px")),children:l&&o.length>=0?(0,V.tZ)(ge.OO,{followOutput:_e(Number(null==v?void 0:v.lastReadMessage)),context:{isFetched:r,items:s,isSetSearchReply:N,direction:M,replyLoading:P,isConfirmationRequired:!1},ref:L,firstItemIndex:null==l?void 0:l.firstItemIndex,increaseViewportBy:{top:800,bottom:800},initialTopMostItemIndex:{index:be?0:"LAST",align:be?"start":"end",behavior:"auto",offset:be?0:100},atTopStateChange:function(e){e&&u&&r&&!me&&$(!0,"next",w)},atBottomStateChange:function(e){e&&(A(!0),ae&&null!=f&&f[t]&&xe(),k&&r&&!ae&&(T(!0),$(!0,"previous",w))),e||A(!1)},data:o,itemContent:function(e,t){var a,i,s,r,l,c={id:1e8,name:"Error message",text:"Error occured. This message is not valid",type:"ERROR",from_user:{}},d=o.findIndex((function(e){return e.id===t.id}));Number(null==v?void 0:v.lastReadMessage)===t.id&&y&&!ee&&(j.current=null===(l=o[d+1])||void 0===l?void 0:l.id);var u=j.current&&t.id&&j.current===t.id,m=t?(null==t?void 0:t.custom_uuid)||t.id:c.id,h=(0,pe.ix)({currentMsgAuthorId:t.from_user.id,prevMsgAuthorId:null===(a=o[d-1])||void 0===a?void 0:a.from_user.id,nextMsgAuthorId:null===(i=o[d+1])||void 0===i?void 0:i.from_user.id,prevMsgType:null===(s=o[d-1])||void 0===s?void 0:s.type,nextMsgType:null===(r=o[d+1])||void 0===r?void 0:r.type}),p=h.isSameFromUserWithPrev,g=h.isSameFromUserWithNext,f=(0,V.BX)(V.HY,{children:[u&&(null==o?void 0:o.length)>1?(0,V.tZ)("div",{className:"my-2 mx-0 w-full bg-kgrey-inputBg text-center text-kdark-424242 dark:bg-kdark-dark333 dark:text-white",children:n("unread_messages")}):null,(0,V.tZ)(ce.J,{message:t||c,isSameFromUserWithPrev:p,isSameFromUserWithNext:g},m)]});return(0,V.tZ)(he(),{offset:{bottom:50},scrollDelay:50,onChange:function(e){X(e,t)},children:(0,V.tZ)("div",{children:f})},m)},components:{Scroller:ce.bt,Item:ce.nN,Footer:!ae&&K?ce.K:void 0}}):(0,V.tZ)(ce.JE,{})})})}})}function xe(e){var t=(0,i.useMemo)((function(){return e.chatId}),[e.chatId]),n=(0,i.useCallback)((function(){window.location.reload()}),[]);return(0,V.tZ)(m.SV,{resetKeys:t,onResetHandler:n,children:(0,V.tZ)(fe,(0,S.Z)({},e))})}var ve=n(24560),_e=n(39814),be=n(77676).Z.getOne();function ye(e){var t=e.isAllowedSendMsg,n=(0,ve.O)(),s=n.setMessage,r=n.reply,c=n.setReply,d=n.editingMessage,u=n.isDelayedMessage,m=n.setIsDelayedMessage,h=n.message,p=n.isMentionSearching,g=n.setMessageScheduleDate,f=n.messageScheduleDate,x=n.handleScheduleModalToggle,_=(0,oe.m)(),b=_.entityId,y=_.entityType,j=_.isLastPageFetched,Z=_.isScheduledChat,w=(0,_e.R)().sendJsonMessage,N=(0,o.bL)({sendJsonMessage:w,entityId:b,entityType:y}).sendChatMessage,C=(0,o.r1)().updateEntities,k=(0,l.m)(),M=k.setActiveDraft,I=k.activeDraft,D=(0,o.cX)(),F=D.removeLS,E=D.updateEntityDraft,A=D.getLS,R=D.sendDeleteDraft,L=(0,i.useState)(null),O=(0,a.Z)(L,2),B=O[0],K=O[1],U=A(),G=(0,T.v9)((function(e){return be(e,{id:b,entity:"case"===y?"cases":"ims-chats",name:"".concat("case"===y?"CaseChat":"GroupChat","-").concat(b,"One")})})),H=function(e){var t,n;if(!p){var a;if(null==e||e.preventDefault(),B&&K(null),(I||b in U)&&(E("reset"),M(null),F(b),R()),d&&(null==d?void 0:d.id)===(null==G||null===(t=G.item.pinned_message)||void 0===t?void 0:t.id))C({entity:"ims-chats",entityId:b,updatingData:{pinned_message:(0,S.Z)((0,S.Z)({},null==G||null===(a=G.item)||void 0===a?void 0:a.pinned_message),{},{text:h})}});N({type:"text",replied_to_id:r?r.id:null,replied_to:null,msgSendingChatId:b,uuid:(0,P.x0)(),edited:!!d,is_draft:!(null===(n=G.item)||void 0===n||!n.draft_message),scheduled_to:f}),s(""),g(null),r&&c(null)}};(0,i.useEffect)((function(){Z&&f&&B&&H(B)}),[f]),(0,i.useEffect)((function(){!u&&B&&H(B)}),[u]);return(0,v.jsx)(ce.lv,{onFormSubmit:function(e){return e.preventDefault(),Z&&!f&&!d&&h?(x(),void K(e)):j||d?void H(e):(m(!0),void K(e))},isAllowedSendMsg:t,isGroup:!0})}function je(e){return(0,v.jsx)(m.SV,{children:(0,v.jsx)(ye,(0,S.Z)({},e))})}var Ze=n(66364),we=n.n(Ze),Ne=n(49185),Ce=n(38596),ke=n(6330),Se=n(15861),Me=n(4942),Ie=n(64687),De=n.n(Ie),Fe=n(80180),Pe=n(7692),Ee=n(16856),Ae=n(40071);var Re=n(25763),Le=n(22906);function Oe(e){var t=e.text,n=e.Component,a=e.iconProp,i=e.field_name,s=e.handleChange,r=e.property,l=(0,N.K)().isRTL;return(0,v.jsx)("div",{className:"permissions__item mb-4 ",children:(0,v.jsxs)("div",{className:"permission flex items-center rounded-xl bg-white p-3 shadow-lg dark:bg-kdark-dark333",children:[(0,v.jsx)("div",{className:"icon flex-centered h-10 w-10 rounded-lg bg-primary",children:(0,v.jsx)("div",{className:"text-white",children:(0,v.jsx)(n,(0,S.Z)({},a))})}),(0,v.jsx)("div",{className:"mx-4 text-sm",children:t}),(0,v.jsx)("div",{className:(0,C.Z)({"ml-auto":!l,"mr-auto":l}),children:(0,v.jsx)(Le.B,{handleChange:function(e){return s(e)},disabled:!1,name:i,checked:r[i]})})]})})}function Be(e){var t=e.handler,n=e.Icon,a=e.text;return(0,v.jsxs)("div",{className:"permissions__leave flex cursor-pointer items-center pl-2 font-semibold transition hover:text-primary",onClick:t,children:[(0,v.jsx)("div",{className:"icon flex-centered h-10  w-10",children:(0,v.jsx)(n,{})}),(0,v.jsx)("div",{className:"ml-2 text-sm",children:a})]})}var Ke=n(23853);function Te(e){var t=e.onSuccess,n=e.title,a=e.description,i=e.image,s=e.id,r=(0,l.m)(),o=r.groupSearchQuery,d=r.companyId;return(0,v.jsx)(v.Fragment,{children:(0,v.jsx)(c.Z.Main,{entity:"ims-chats",name:"AllImsChats-".concat(d,"-").concat(o),url:"/".concat(d,"/ims/groups/").concat(s,"/"),id:s,method:"put",primaryKey:"id",sendAsFormData:!1,normalizeData:function(e){return e},prependData:!0,fields:[{name:"title",required:!0,value:n,onSubmitKey:""},{name:"description",value:a,onSubmitKey:""},{name:"image",onSubmitKey:"",type:"object",value:i}],onSuccess:function(e,n){t(),n()},onError:function(e,t){console.log(e)},children:function(e){var n=e.isSubmitting,a=e.values,i=e.setFieldValue;return(0,v.jsx)(b,{onSuccess:t,isSubmitting:n,setFieldValue:i,values:a,isEditing:!0})}})})}var Ue=n(21105);function Ge(e){var t,n=e.title,r=e.image,c=e.membersCount,d=e.isMuted,u=e.chatId,h=e.memberId,f=e.isOwner,_=function(e){var t,n,r,c,d=e.chatId,u=e.isMuted,m=e.memberId,h=(0,x.$G)().t,f=(0,l.m)(),v=f.companyId,_=f.groupSearchQuery,b=f.isAdmin,y=(0,J.a)().userData,j=(0,o.Kx)(),Z=j.removeQueryParams,w=j.query,N=(0,i.useState)(!1),C=(0,a.Z)(N,2),k=C[0],I=C[1],D=(0,i.useState)(!1),F=(0,a.Z)(D,2),P=F[0],E=F[1],A=(0,i.useState)(!1),R=(0,a.Z)(A,2),L=R[0],O=R[1],B=(0,i.useState)(!1),K=(0,a.Z)(B,2),T=K[0],U=K[1],G=function(){return O((function(e){return!e}))},H=function(){return U((function(e){return!e}))},W=(0,i.useRef)(null),$=(0,o.r1)().updateEntities,V=null!=w&&w.searchedMessageId?null==w?void 0:w.searchedMessageId:d,Q=(0,o.QY)({entity:"ims-chats",entityId:d,entityName:"GroupChat-".concat(V,"One")});(0,i.useEffect)((function(){W.current=Q.item.property}),[Q.item.property]);var q=p()(Q,"item.members",[]).find((function(e){return"OWNER"===e.role})),z=p()(Q,"item.members",[]).find((function(e){return e.user.id===y.id})),X=(null==q?void 0:q.user.id)===y.id,Y=!0;(X||b||null==z||!z.is_allowed_exit_group)&&(Y=!1);var ee=!1;(b||X||null!=z&&z.is_allowed_delete_group)&&(ee=!0);var te=(0,o.bK)({url:"/".concat(v,"/ims/groups/").concat(d,"/"),dynamicValues:!0,method:"put",cb:{success:function(e,t){},error:function(e,t){var n,a;ae(null===(n=t[0])||void 0===n?void 0:n.fieldName,!(null!==(a=t[0])&&void 0!==a&&a.checked))}}}).fetchData,ne=(0,i.useCallback)((function(e,t){var n;$({entity:"ims-chats",entityId:e,updatingData:{members:[].concat((0,M.Z)(null==Q||null===(n=Q.item)||void 0===n?void 0:n.members.filter((function(e){return e.user.id!==y.id}))),[(0,S.Z)((0,S.Z)({},z),t)])}})}),[null==Q?void 0:Q.item]),ae=function(e,t){var n=(0,S.Z)({},W.current)||{};$({entity:"ims-chats",entityId:d,updatingData:{property:(0,S.Z)((0,S.Z)({},n),{},(0,Me.Z)({},e,t))}})},ie=(0,i.useCallback)(function(){var e=(0,Se.Z)(De().mark((function e(t){var n,a;return De().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.target.name,a=t.target.checked,ae(n,a),e.next=5,te({values:(0,Me.Z)({},n,a),fieldName:n,checked:a});case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[Q.item.property]),se=(0,o.bK)({url:"/".concat(v,"/ims/groups/").concat(d,"/members/").concat(m,"/"),method:"patch",values:{is_mute:!u},cb:{success:function(e,t){},error:function(e,t){null==ne||ne(d,{is_mute:u})}}}).fetchData,re=(0,Fe.v)({entity:"ims-chats",name:"AllImsChats-".concat(v,"-"),deleteData:!0,id:d,url:"",method:"delete",cb:{success:function(e){},error:function(e){},finally:function(){}}}).handleLocalDelete,le=(0,Fe.v)({entity:"ims-chats",name:"AllImsChats-".concat(v,"-").concat(_),method:P?"patch":"delete",url:P?"/".concat(v,"/ims/groups/").concat(d,"/members/").concat(m,"/leave/"):"/".concat(v,"/ims/groups/").concat(d,"/"),deleteData:!0,id:Number(V),cb:{success:function(e){null==I||I(!1),null==E||E(!1),T&&H(),L&&G(),Z(),_&&re()},error:function(e){null==I||I(!1),H()},finally:function(){}}}).handleRequest;return{leaveGroupChat:function(){null==I||I(!0),le()},localDelete:function(){re(),null==E||E(!1),Z()},permissions:[{Component:Pe.kK8,handleChange:ie,iconProp:{},text:h("send_message"),field_name:"is_allowed_send_msg",show:b||X},{Component:s.wZc,handleChange:ie,iconProp:{},text:h("add_users"),field_name:"is_allowed_add_user",show:b||X},{Component:Ee.XH4,handleChange:ie,iconProp:{},text:h("remove_users"),field_name:"is_allowed_remove_user",show:b||X},{Component:g.bI9,handleChange:ie,iconProp:{},text:h("pin_message"),field_name:"is_allowed_pin_msg",show:b||X},{Component:g.$iz,handleChange:ie,iconProp:{width:11,height:11},text:h("edit_group_info"),field_name:"is_allowed_edit_info",show:b||X},{Component:Ae.wzU,handleChange:ie,iconProp:{className:"chat-icon-exit"},text:h("exit_from_group"),field_name:"is_allowed_exit_group",show:b||X},{Component:Ee.L46,handleChange:ie,iconProp:{className:"chat-icon-exit"},text:h("show_chat_history"),field_name:"show_history",className:"white-icon",handler:function(){},hasSwitch:!0,show:b||X}],handlePropertyChange:ie,currentUserProperty:null!==(t=null==Q||null===(n=Q.item)||void 0===n?void 0:n.members.find((function(e){return(null==e?void 0:e.id)===m})))&&void 0!==t?t:{},property:null!==(r=null==Q||null===(c=Q.item)||void 0===c?void 0:c.property)&&void 0!==r?r:{},handlerSwitchMute:function(e){ne(d,{is_mute:!e}),se(e)},canLeaveChat:Y,canDeleteChat:ee,deleteVisible:L,deleteLoading:T,toggleDeleteVisible:G,deleteGroupChat:function(){H(),le()},exitLoading:k,open:P,setExitOpen:E,imsData:null==Q?void 0:Q.item}}({chatId:u,isMuted:d,memberId:h}),b=_.leaveGroupChat,y=_.permissions,j=_.handlePropertyChange,Z=_.property,w=_.handlerSwitchMute,N=_.canLeaveChat,C=_.canDeleteChat,k=_.deleteVisible,I=_.deleteLoading,D=_.toggleDeleteVisible,F=_.deleteGroupChat,P=_.exitLoading,E=_.open,A=_.setExitOpen,R=_.imsData,L=_.currentUserProperty,O=(0,l.m)().isAdmin,B=(0,o.dF)(),K=B.open,T=B.modalHandler,U=B.WhiteModal;return(0,v.jsx)("div",{className:"w-72 ",children:(0,v.jsxs)("div",{className:"permissions font-poppins",children:[(0,v.jsx)("div",{className:"permissions__top",children:(0,v.jsxs)("div",{className:"permission__header flex rounded-lg bg-primary p-2 text-white  shadow-lg",children:[(0,v.jsx)("div",{className:"permissions__img flex-centered mx-2 h-14 w-14 flex-shrink-0 overflow-hidden rounded-md bg-white text-primary-dark",children:r?(0,v.jsx)("img",{src:r.thumbnail_150,alt:n}):null==n||null===(t=n[0])||void 0===t?void 0:t.toUpperCase()}),(0,v.jsxs)("div",{className:"permissions__header-text flex-grow ",children:[(0,v.jsxs)("div",{className:"flex-center-between text-base",children:[(0,v.jsx)("span",{children:n}),O||f||null!=L&&L.is_allowed_edit_info?(0,v.jsx)("div",{className:"cursor-pointer transition hover:text-primary-dark",onClick:T,children:(0,v.jsx)(Ke.vPQ,{})}):null,(0,v.jsx)(U,{handleModalOpen:T,open:K,children:(0,v.jsx)(Te,{onSuccess:T,title:R.title,description:R.description,image:R.image,id:R.id})})]}),(0,v.jsx)("div",{className:"text-sm",children:(0,Ue.t)("members_lowercase",{membersCount:String(c)})})]})]})}),(0,v.jsxs)("div",{className:"permissions__content mt-4",children:[y.map((function(e){return(0,v.jsx)(i.Fragment,{children:e.show?(0,v.jsx)(Oe,{text:e.text,Component:e.Component,iconProp:e.iconProp,field_name:e.field_name,handleChange:j,property:Z},e.text):null},e.text)})),(0,v.jsx)(Be,{text:d?(0,Ue.t)("unmute_notifications"):(0,Ue.t)("mute_notifications"),handler:function(){return w(d)},Icon:d?Re.rZs:Re.sF0}),C?(0,v.jsx)(Be,{text:(0,Ue.t)("delete_group"),handler:D,Icon:Ee.$vK}):null,N?(0,v.jsx)(v.Fragment,{children:(0,v.jsx)(Be,{text:(0,Ue.t)("leave_group"),handler:function(){return A(!0)},Icon:Ae.wzU})}):null,(0,v.jsx)(m.sm,{featureHandler:b,isOpen:Boolean(E),toggleHandler:function(){return A((function(e){return!e}))},title:(0,Ue.t)("exit_group_confirmation",{title:n}),hasLoader:!0,isLoading:P}),(0,v.jsx)(m.sm,{featureHandler:F,isOpen:Boolean(k),toggleHandler:D,title:(0,Ue.t)("delete_group_confirmation",{title:n}),hasLoader:!0,isLoading:I})]})]})})}function He(e){return(0,v.jsx)(m.SV,{isCompact:!0,children:(0,v.jsx)(Ge,(0,S.Z)({},e))})}var We=n(13889);function $e(){var e=(0,x.$G)().t,t=(0,i.useState)(""),n=(0,a.Z)(t,2),s=n[0],o=n[1],c=(0,i.useState)(1),d=(0,a.Z)(c,2),u=d[0],h=d[1],p=(0,r.Z)(s,300),g=(0,a.Z)(p,1)[0],f=(0,de.mx)().entityId,_=(0,l.m)().companyId;return(0,v.jsxs)("div",{className:"group-members",children:[(0,v.jsx)("h2",{className:"mb-4 text-xl font-bold",children:e("group_chat_members")}),(0,v.jsx)("div",{className:"mb-4",children:(0,v.jsx)("input",{type:"text",className:"inline-block w-full rounded-xl border p-2 outline-none hover:border-primary focus:border-primary dark:bg-kdark-lighter dark:text-white",value:s,onChange:function(e){return o(e.target.value)},placeholder:e("search_members")})}),(0,v.jsx)("div",{className:"group-members__content h-48",children:(0,v.jsx)(We.$B,{autoHide:!0,style:{height:"100%"},children:(0,v.jsx)(Y.Z.All,{entity:"group-members",name:"GroupMembers-".concat(f),url:"/".concat(_,"/ims/").concat(f,"/members_list/"),params:{extra:{search:g},page:u,limit:10},appendData:!0,children:function(t){var n=t.items,a=t.isFetched,i=t.meta,s=(0,M.Z)(n);return(0,v.jsxs)(v.Fragment,{children:[s.map((function(t){var n,a,i;return(0,v.jsxs)("div",{className:"msg-info__content-user mb-3 flex items-center",children:[(0,v.jsx)("div",{className:"avatar mr-3 flex-shrink-0",children:(0,v.jsx)(L.Rz,{size:36,smallSize:36,className:"",letter:"".concat(t.user.first_name[0]).concat(t.user.last_name[0]),alt:"".concat(t.user.first_name," ").concat(t.user.last_name),src:(null===(n=t.user.avatar)||void 0===n?void 0:n.thumbnail_150)||(null===(a=t.user.avatar)||void 0===a?void 0:a.thumbnail)||(null===(i=t.user.avatar)||void 0===i?void 0:i.url)})}),(0,v.jsx)("div",{className:"msg-info__user-content",children:(0,v.jsxs)("div",{className:"msg-info__user-name mb-1 text-sm",children:[(0,v.jsx)("span",{children:"".concat(t.user.first_name," ").concat(t.user.last_name)}),"OWNER"===t.role&&(0,v.jsxs)("span",{className:"italic text-kgrey",children:[" ",e("group_owner")]})]})})]},t.id)})),a?null:(0,M.Z)(Array(6)).map((function(e,t){return(0,v.jsx)("div",{className:"mb-2",children:(0,v.jsx)(Qe,{})},t)})),a&&null!=i&&i.current_page&&null!=i&&i.last_page&&(null==i?void 0:i.current_page)<(null==i?void 0:i.last_page)?(0,v.jsx)(m.$K,{setPage:function(){return h((function(e){return e+1}))}}):null]})}})})})]})}function Ve(){return(0,v.jsx)(m.SV,{children:(0,v.jsx)($e,{})})}function Qe(){return(0,v.jsxs)(I.ZP,{speed:2,width:369,height:40,viewBox:"0 0 369 40",backgroundColor:"#f3f3f3",foregroundColor:"#ecebeb",children:[(0,v.jsx)("circle",{cx:"75",cy:"125",r:"27"}),(0,v.jsx)("circle",{cx:"30",cy:"20",r:"20"}),(0,v.jsx)("rect",{x:"55",y:"10",rx:"4",ry:"4",width:"69",height:"18"}),(0,v.jsx)("rect",{x:"131",y:"10",rx:"4",ry:"4",width:"151",height:"18"})]})}function qe(){var e=(0,l.m)(),t=e.setGroupSearchOpen,n=e.groupSearchOpen;return{handleSearchBtnClick:function(){console.log("clicked")},toggleSearchSidebar:function(){return t(!n)}}}var ze=n(45987),Xe=n(88167),Ye=n(38192),Je=n(1370),et=n(58997),tt=n(14621),nt=n(38302),at=n(42541),it=n(70272),st=n(95569),rt=n(81694),lt=n.n(rt),ot=n(78096),ct=n(93969),dt=n(80159),ut=n(64212),mt=n(67025),ht=n(20632),pt=n(57407),gt=n(21079),ft=(0,Ce.Z)((function(e){return{root:{display:"flex","& > *":{margin:e.spacing(1)}},purple:{color:e.palette.getContrastText(st.Z[500]),backgroundColor:st.Z[500]}}})),xt=function(e){var t,n,a=e.member,i=e.areAddedMembers,s=e.onClickHandler,r=void 0===s?function(){}:s,l=e.selectedMembers,o=void 0===l?[]:l,c=e.isAddingMember,d=void 0!==c&&c,u=e.isOwner,m=void 0!==u&&u,h=e.isAdminManager,g=e.showChatEditSettingModal,f=void 0===g?function(){}:g,_=e.setOpen,b=e.currentMember,y=(0,x.$G)().t,j=ft(),Z=d?a.first_name:p()(a,"user.first_name"),w=d?a.last_name:p()(a,"user.last_name"),N=p()(a,"company.name"),C=d?N===(null==a?void 0:a.username):N===p()(a,"user.username"),k=d?p()(a,"avatar.thumbnail_150"):p()(a,"user.avatar.thumbnail_150"),S=null===(t=Z[0])||void 0===t?void 0:t.toUpperCase(),M=null===(n=w[0])||void 0===n?void 0:n.toUpperCase(),I="".concat(Z," ").concat(w),D=d?a.id:p()(a,"user.id"),F=d?null:a.role,P=d?null:null==a?void 0:a.is_admin,E=null==a?void 0:a.is_staff,A="OWNER"===a.role,R=o.find((function(e){var t;return e.id===D&&e.companyId===(null==a||null===(t=a.company)||void 0===t?void 0:t.id)}));return(0,v.jsxs)(ot.Z,{button:!i,onClick:function(){return r(D,a)},className:lt()("member-list-item",{"item-active":o.includes(D)}),children:[(0,v.jsx)(ct.Z,{children:(0,v.jsx)(it.Z,{alt:S,src:k,className:j.purple,children:"".concat(S," ").concat(M)})}),(0,v.jsx)(dt.Z,{primary:I,secondary:"".concat(A?y("group_owner"):""," ").concat(E&&A?"":"".concat(y(E?"staff":"client")," | ").concat(C?y("individual"):N))}),R&&(0,v.jsx)(v.Fragment,{children:(0,v.jsx)(ut.Z,{children:(0,v.jsx)(mt.Z,{edge:"end","aria-label":"checked",children:(0,v.jsx)(ht.Z,{})})})}),i&&(h||m||b.is_allowed_remove_user)&&(0,v.jsxs)(ut.Z,{children:[(h||m)&&(0,v.jsx)(mt.Z,{edge:"end","aria-label":"checked",disabled:"OWNER"===F||P,onClick:function(){return f(a)},children:(0,v.jsx)(gt.Z,{})}),(0,v.jsx)(mt.Z,{edge:"end","aria-label":"checked",disabled:"OWNER"===F,onClick:function(){return _(a)},children:(0,v.jsx)(pt.Z,{})})]})]})},vt=n(52067),_t=n(93188),bt=n(58528);var yt=function(e){var t=e.className,n=e.handler,a=e.text,i=e.Component,s=e.iconProp,r=e.hasSwitch,l=e.field_name,o=e.handleChange,c=e.property,d=e.isMuteSetting,u=e.isMute,m=(0,N.K)().isRTL;return(0,v.jsxs)("div",{className:"chat-sett-toggler flex items-center dark:!bg-kdark-dark333 ".concat(t),onClick:function(){return d?o({target:{checked:!u}}):n(!0)},children:[(0,v.jsx)("div",{className:(0,C.Z)("chat-sett-toggler__icon flex items-center justify-center text-white",{"mr-2.5":!m,"ml-2.5":m}),children:(0,v.jsx)(i,(0,S.Z)({},s))}),(0,v.jsx)("div",{className:"chat-sett-toggler__name",children:a}),r&&!d&&(0,v.jsx)("div",{className:(0,C.Z)("chat-sett-toggler__switch",{"ml-auto":!m,"mr-auto":m}),children:(0,v.jsx)(bt.Z,{color:"primary",edge:"end",name:l,checked:c[l],onChange:o,inputProps:{"aria-labelledby":"switch-list-label-group-admin"}})})]})},jt=K.Z.entity.formRequest,Zt=function(e){var t=e.companyId,n=e.member,s=e.chatId,r=e.isOwner,l=e.staffMembersLength,c=e.isAdminManager,d=n&&n,u=d.is_allowed_send_msg,m=d.is_allowed_add_user,h=d.is_allowed_remove_user,p=d.is_allowed_pin_msg,g=d.is_allowed_edit_info,f=d.is_allowed_delete_group,_=d.is_allowed_exit_group,b=d.is_mute,y=d.show_history,j=(0,i.useState)({is_allowed_send_msg:u,is_allowed_add_user:m,is_allowed_remove_user:h,is_allowed_pin_msg:p,is_allowed_edit_info:g,is_allowed_delete_group:f,is_allowed_exit_group:_,is_mute:b,show_history:y}),Z=(0,a.Z)(j,2),w=Z[0],N=Z[1],C=n.id,k=(0,o.Zp)().reloadEntityAll,M=(0,x.$G)().t,I=(0,T.I0)(),D=function(e){var a=e.target.name,i=e.target.checked,r=(0,S.Z)({},w);N((function(e){return(0,S.Z)((0,S.Z)({},e),{},(0,Me.Z)({},a,i))}));var o=(0,Me.Z)({},a,i);I(jt({id:null==n?void 0:n.id,entity:"chatmembers",name:"Allchatmembers-".concat(s,"-").concat(l),url:"/".concat(t,"/ims/groups/").concat(s,"/members/").concat(C,"/"),method:"patch",params:{},updateData:!0,values:o,normalizeData:function(e){return e},cb:{success:function(e){k({url:"/".concat(t,"/ims/").concat(s,"/members_list/"),entity:"userCompanies",name:"Allchatmembers-".concat(s,"-").concat(l),params:{page:1,limit:10}})},error:function(e){N(r)},finally:function(){}}}))},F=[{Component:B.fu,handleChange:D,iconProp:{},text:M("send_message"),field_name:"is_allowed_send_msg",className:"",handler:function(){},hasSwitch:!0,show:c||r},{Component:B.N_,handleChange:D,iconProp:{},text:M("add_users"),field_name:"is_allowed_add_user",className:"",handler:function(){},hasSwitch:!0,show:c||r},{Component:B.HF,handleChange:D,iconProp:{},text:M("remove_users"),field_name:"is_allowed_remove_user",className:"",handler:function(){},hasSwitch:!0,show:c||r},{Component:B.Dg,handleChange:D,iconProp:{},text:M("pin_message"),field_name:"is_allowed_pin_msg",className:"",handler:function(){},hasSwitch:!0,show:c||r},{Component:B.yl,handleChange:D,iconProp:{width:11,height:11},text:M("change_group_info"),field_name:"is_allowed_edit_info",className:"",handler:function(){},hasSwitch:!0,show:c||r},{Component:B.WC,handleChange:D,iconProp:{className:"chat-icon-exit"},text:M("exit_from_group"),field_name:"is_allowed_exit_group",className:"white-icon",handler:function(){},hasSwitch:!0,show:c||r},{Component:Ee.L46,handleChange:D,iconProp:{className:"chat-icon-exit"},text:M("show_chat_history"),field_name:"show_history",className:"white-icon",handler:function(){},hasSwitch:!0,show:c||r}];return(0,v.jsx)("div",{className:"chat-settings__inner",children:(0,v.jsxs)("div",{className:"chat-settings__content",children:[(0,v.jsx)("div",{className:"chat-settings__title mb-4 font-bold",children:M("individual_permissions")}),(0,v.jsx)("div",{className:"chat-settings__l",children:F.map((function(e){var t=e.className,n=e.handler,a=e.text,i=e.hasSwitch,s=e.field_name,r=e.Component,l=e.iconProp,o=e.show,c=e.handleChange;return o&&(0,v.jsx)("div",{className:"chat-settings__i",children:(0,v.jsx)(yt,{className:t,handler:n,text:a,Component:r,iconProp:l,hasSwitch:i,field_name:s,handleChange:c,property:w,isMuteSetting:!1,isMute:!1})},s)}))})]})})},wt=n(49935),Nt=K.Z.entity.formRequest,Ct=function(e){var t=(0,i.useState)(1),n=(0,a.Z)(t,2),s=n[0],c=n[1],d=(0,i.useState)(""),u=(0,a.Z)(d,2),h=u[0],p=u[1],g=(0,r.Z)(h,300),f=(0,a.Z)(g,1)[0],_=(0,i.useState)(!1),b=(0,a.Z)(_,2),y=b[0],j=b[1],Z=(0,i.useState)(!1),w=(0,a.Z)(Z,2),N=w[0],C=w[1],k=(0,i.useState)(!1),S=(0,a.Z)(k,2),M=S[0],I=S[1],D=(0,l.m)().companyId,F=(0,de.mx)().entityId,P=(0,T.I0)(),E=(0,o.eC)().showNotification,A=(0,x.$G)().t,R=e.isAdminManager,O=e.isOwner,B=e.currentMember,K=e.staffMembersLength,U=function(){return j(!1)};return(0,v.jsx)("div",{className:"members-list",children:(0,v.jsx)(Y.Z.All,{entity:"chatmembers",name:"Allchatmembers-".concat(F,"-").concat(K),url:"/".concat(D,"/ims/").concat(F,"/members_list/"),appendData:!0,params:{page:s,limit:20,extra:{search:f}},onInit:function(e){},children:function(e){var t=e.items,n=e.isFetched,a=e.meta;return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("div",{className:"members-list__search p-4",children:(0,v.jsx)(_t.Z,{label:A("search_members"),value:h,onChange:function(e){return p(e.target.value)},variant:"outlined",size:"small",fullWidth:!0})}),(0,v.jsx)(We.$B,{className:"rct-scroll",autoHide:!0,style:{height:"300px"},children:(0,v.jsx)("div",{className:"members-list__list",children:(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(vt.Z,{dir:"ltr",dense:!0,children:t.map((function(e){return(0,v.jsx)(xt,{member:e,isAdminManager:R,isOwner:O,showChatEditSettingModal:C,setOpen:j,currentMember:B,areAddedMembers:!0},e.id)}))}),n&&(null==a?void 0:a.current_page)&&(null==a?void 0:a.last_page)&&(null==a?void 0:a.current_page)<(null==a?void 0:a.last_page)&&(0,v.jsx)(m.$K,{setPage:function(){return c((function(e){return e+1}))}}),n?null:(0,v.jsx)("div",{className:"case-chat-loader flex items-center justify-center",children:(0,v.jsx)(m.aN,{})}),(0,v.jsx)(m.sm,{featureHandler:function(){return e=y,I(!0),void P(Nt({entity:"chatmembers",name:"Allchatmembers-".concat(F,"-").concat(K),method:"delete",url:"/".concat(D,"/ims/groups/").concat(F,"/members/").concat(e.id,"/"),deleteData:!0,id:e.id,cb:{success:function(){P((0,wt.Gx)({id:F,entity:"ims-chats",name:"GroupChat-".concat(F),url:"/".concat(D,"/ims/groups/").concat(F,"/"),params:{},primaryKey:"id",relations:""})),E({message:A("successfully_deleted"),variant:"success"})},error:function(e){E({message:A("something_went_wrong"),variant:"error"})},finally:function(){j(!1),I(!1)}},params:{},primaryKey:"id",values:{}}));var e},isOpen:Boolean(y),toggleHandler:U,title:A("are_you_sure_delete_member"),hasLoader:!0,isLoading:M}),(0,v.jsx)(L.Cx,{handleModalOpen:function(){return C(!1)},open:N,maxWidth:310,minWidth:310,children:(0,v.jsx)(Zt,{companyId:D,chatId:F,isAdminManager:R,isOwner:O,member:N,staffMembersLength:K})})]})})})]})}})})};function kt(e){return(0,v.jsx)(m.SV,{children:(0,v.jsx)(Ct,(0,S.Z)({},e))})}var St=n(78420),Mt=n(28912),It=n(92475),Dt=n(94135),Ft=n(66828),Pt=n(10083),Et=function(e){var t=e.value,n=e.handleChange,a=(0,x.$G)().t;return(0,v.jsx)("div",{className:"members-list__filter",children:(0,v.jsxs)(Ft.Z,{component:"fieldset",children:[(0,v.jsx)(Pt.Z,{component:"legend",children:a("filter_dot")}),(0,v.jsx)(It.Z,{"aria-label":"gender",name:"filter",value:t,onChange:n,children:(0,v.jsxs)("div",{className:"members-list__filter_inner",children:[(0,v.jsx)("div",{className:"members-list__filter_item",children:(0,v.jsx)(Dt.Z,{value:"all",control:(0,v.jsx)(Mt.Z,{color:"primary"}),label:a("all")})}),(0,v.jsx)("div",{className:"members-list__filter_item",children:(0,v.jsx)(Dt.Z,{value:"staff",control:(0,v.jsx)(Mt.Z,{color:"primary"}),label:a("staff")})}),(0,v.jsx)("div",{className:"members-list__filter_item",children:(0,v.jsx)(Dt.Z,{value:"individual",control:(0,v.jsx)(Mt.Z,{color:"primary"}),label:a("individual_clients")})}),(0,v.jsx)("div",{className:"members-list__filter_item",children:(0,v.jsx)(Dt.Z,{value:"clients",control:(0,v.jsx)(Mt.Z,{color:"primary"}),label:a("business_client_users")})})]})})]})})},At=n(82036),Rt=n(19053),Lt=function(e){var t=(0,x.$G)().t,n=(0,i.useState)(1),s=(0,a.Z)(n,2),c=s[0],d=s[1],u=e.onSuccess,h=e.activeChat,p=e.staffMembersLength,g=(0,l.m)().companyId,f=(0,de.mx)().entityId,_=(0,i.useState)([]),b=(0,a.Z)(_,2),y=b[0],Z=b[1],w=(0,i.useState)([]),N=(0,a.Z)(w,2),C=N[0],k=N[1],S=(0,i.useState)(!1),I=(0,a.Z)(S,2),D=I[0],F=I[1],P=(0,i.useState)("all"),E=(0,a.Z)(P,2),A=E[0],R=E[1],O=(0,i.useState)({is_individual:"true",is_business:"true",is_member:"true"}),B=(0,a.Z)(O,2),K=B[0],U=B[1],G=(0,T.I0)(),H=(0,i.useState)("All"),W=(0,a.Z)(H,2),$=W[0],V=W[1],Q=(0,o.eC)().showNotification,q=(0,Fe.v)({entity:"chatmembers",name:"Allchatmembers-".concat(f,"-").concat(p),method:"post",url:"/".concat(g,"/ims/groups/").concat(f,"/members/"),values:C.reduce((function(e,t){return[].concat((0,M.Z)(e),[{user:{id:t.id},role:"MEMBER",company:{id:t.companyId}}])}),[]),cb:{success:function(e){G((0,wt.Gx)({id:f,entity:"ims-chats",name:"GroupChat-".concat(f),url:"/".concat(g,"/ims/groups/").concat(f,"/"),params:{},primaryKey:"id",relations:""})),Q({message:t("member_added_success"),variant:"success"})},error:function(e){Q({message:t("something_went_wrong"),variant:"error"})},finally:function(){F(!1),u()}}}).handleRequest;(0,i.useEffect)((function(){!function(){switch(A){case"all":V("All");break;case"individual":V("Individual Clients");break;case"clients":V("Business Client Users");break;case"staff":V("Staff");break;default:;}}()}),[A]);var z=K.is_individual,X=K.is_business,J=K.is_member,ee=(0,i.useState)(""),te=(0,a.Z)(ee,2),ne=te[0],ae=te[1],ie=(0,i.useState)(!1),se=(0,a.Z)(ie,2),re=se[0],le=se[1],oe=(0,r.Z)(ne,300),ce=(0,a.Z)(oe,1)[0];(0,i.useEffect)((function(){d(1)}),[ce]);var ue=function(e,t){if(y.includes(e)){var n=y.filter((function(t){return t!==e})),a=C.filter((function(t){return t.id!==e}));Z(n),k(a)}else Z((function(t){return[].concat((0,M.Z)(t),[e])})),k((function(e){var n;return[].concat((0,M.Z)(e),[{id:t.id,companyId:null==t||null===(n=t.company)||void 0===n?void 0:n.id}])}))};return(0,v.jsxs)("div",{className:"members-list relative",children:[(0,v.jsx)(Y.Z.All,{entity:"clientMembers",name:"AllClientMembers-".concat(f,"-").concat(p),url:"/".concat(g,"/my/company/client_users/"),primaryKey:function(e){return"".concat(e.id,"-").concat(e.company.id)},appendData:!0,isUniq:!1,params:{page:c,limit:20,extra:{search:ce,is_individual:z,is_business:X,is_member:J,exclude_ids:h.members.filter((function(e){return"KICKED"!==e.role.toUpperCase()})).reduce((function(e,t){return[].concat((0,M.Z)(e),[null==t?void 0:t.user.id])}),[]).join(",")}},onInit:function(e){F(!1)},children:function(e){var n=e.items,a=e.isFetched,i=e.meta;return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsxs)("div",{className:"members-list__settings",children:[(0,v.jsx)("div",{className:"members-list__search",children:(0,v.jsx)(_t.Z,{label:t("search_members"),value:ne,onChange:function(e){d(1),ae(e.target.value)},variant:"outlined",size:"small",fullWidth:!0})}),(0,v.jsx)("div",{className:"members-list__filter-btn pl-2.5",children:(0,v.jsx)(mt.Z,{"aria-label":"filter",color:"default",onClick:function(){return le(!0)},children:(0,v.jsx)(At.Z,{})})})]}),(0,v.jsxs)("div",{className:"ml-2.5 flex items-center",children:[(0,v.jsx)("div",{className:"mr-2.5",children:(0,v.jsx)("strong",{children:t("filtering_type")})}),(0,v.jsx)("div",{className:"mr-2.5",children:t((0,Rt.u)($))})]}),(0,v.jsx)(We.$B,{className:"rct-scroll",autoHide:!0,style:{height:"300px"},children:(0,v.jsxs)("div",{className:"members-list__list",children:[D&&(0,v.jsx)(m.aN,{tiled:!0}),(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(vt.Z,{dir:"ltr",className:"add-chat-member__list",dense:!0,children:n.map((function(e,t){return(0,v.jsx)(xt,{member:e,onClickHandler:ue,selectedMembers:C,isAddingMember:!0},t)}))}),a&&(null==i?void 0:i.current_page)&&(null==i?void 0:i.last_page)&&(null==i?void 0:i.current_page)<(null==i?void 0:i.last_page)&&(0,v.jsx)(m.$K,{setPage:function(){return d((function(e){return e+1}))}}),a?null:(0,v.jsx)("div",{className:"case-chat-loader flex items-center justify-center",children:(0,v.jsx)(m.aN,{})})]})]})})]})}}),(0,v.jsx)(L.Cx,{handleModalOpen:function(){return le(!1)},open:re,children:(0,v.jsx)(Et,{value:A,handleChange:function(e){var t=e.target.value;switch(R(t),F(!0),d(1),le(!1),t){case"all":U({is_individual:"true",is_business:"true",is_member:"true"});break;case"individual":U({is_individual:"true",is_business:"false",is_member:"false"});break;case"clients":U({is_individual:"false",is_business:"true",is_member:"false"});break;case"staff":U({is_individual:"false",is_business:"false",is_member:"true"});break;default:return null}}})}),(0,v.jsx)("div",{className:"absolute bottom-2.5 right-2.5",children:(0,v.jsx)(j.Z,{color:"primary","aria-label":"add",onClick:function(){F(!0),q()},disabled:0===y.length,children:(0,v.jsx)(St.Z,{})})})]})};function Ot(e){return(0,v.jsx)(m.SV,{children:(0,v.jsx)(Lt,(0,S.Z)({},e))})}var Bt=["children","value","index"];function Kt(e){var t=e.children,n=e.value,a=e.index,i=(0,ze.Z)(e,Bt);return(0,v.jsx)("div",(0,S.Z)((0,S.Z)({role:"tabpanel",hidden:n!==a,id:"scrollable-force-tabpanel-".concat(a),"aria-labelledby":"scrollable-force-tab-".concat(a)},i),{},{children:n===a&&(0,v.jsx)(at.Z,{p:0,children:(0,v.jsx)(nt.Z,{component:"div",children:t})})}))}function Tt(e){return{id:"scrollable-force-tab-".concat(e),"aria-controls":"scrollable-force-tabpanel-".concat(e)}}var Ut=function(e){var t=e.onSuccess,n=(0,l.m)(),s=n.isPermitted,r=n.companyId,c=(0,de.mx)().entityId,d=(0,J.a)().userData,u=i.useState(0),m=(0,a.Z)(u,2),h=m[0],g=m[1],f=(0,x.$G)().t,_=(0,o.QY)({entity:"ims-chats",entityId:c,entityName:"GroupChat-".concat(c,"One")}),b=_.item||{},y=p()(_,"item.members",[]).find((function(e){return"OWNER"===e.role})),j=p()(_,"item.members",[]).find((function(e){return e.user.id===d.id})),Z=(null==y?void 0:y.user.id)===d.id,w=(null==j?void 0:j.is_allowed_add_user)||s;return(0,v.jsxs)("div",{className:"case-form case-form_group-chat -mt-5 rounded-xl",children:[(0,v.jsx)(Xe.Z,{position:"static",color:"default",children:(0,v.jsxs)(Ye.Z,{value:h,onChange:function(e,t){g(t)},variant:"fullWidth",indicatorColor:"primary",textColor:"primary","aria-label":"scrollable2 force tabs example",children:[(0,v.jsx)(Je.Z,(0,S.Z)({label:f("members"),icon:(0,v.jsx)(et.Z,{})},Tt(0))),w?(0,v.jsx)(Je.Z,(0,S.Z)((0,S.Z)({label:f("add_member"),icon:(0,v.jsx)(tt.Z,{})},Tt(1)),{},{disabled:!w})):null]})}),(0,v.jsx)(Kt,{value:h,index:0,children:(0,v.jsx)(kt,{isAdminManager:s,isOwner:Z,currentMember:j,staffMembersLength:123})}),(0,v.jsx)(Kt,{value:h,index:1,children:(0,v.jsx)(Ot,{chatId:c,companyId:r,onSuccess:t,activeChat:b,staffMembersLength:123})})]})},Gt=(0,Ce.Z)((0,ke.Z)({paper:{borderRadius:"16px",padding:"10px"}}));function Ht(e){var t,n,a,s,r,c,d,u,m=e.imsData,h=e.isFetched,p=(0,N.K)().isRTL,f=(0,oe.m)(),x=f.setScrollToMessageHandler,_=f.lastReadMessageId,b=f.entityId,y=(0,de.O9)(),j=y.message,Z=y.reply,w=y.editingMessage,k=(0,J.a)().userData,S=Gt(),M=(0,o.Kx)().removeQueryParams,I=(0,de.RT)().closeSocket,D=(0,l.m)(),F=D.setActiveDraft,P=D.activeDraft,E=D.setGroupSearchOpen,A=D.groupSearchOpen,R=D.isAdmin,O=(0,o.cX)(),K=O.saveDraft,T=O.getLS,U=qe().toggleSearchSidebar,H=m.pin_time,W=(0,o.dF)(),$=W.open,V=W.modalHandler,Q=W.WhiteModal,q=(0,o.r1)().updateEntities,z=(0,o.dF)(),X=z.open,Y=z.modalHandler,ee=z.WhiteModal,te=G(m.pin_time,m.id,!0),ne=te.open,ae=te.handleClick,ie=te.anchorEl,se=te.handleCloseMenu,re=T(),le=m.title,ce=null;h&&!we()(m)&&(ce={avatarSrc:null==m||null===(d=m.image)||void 0===d?void 0:d.thumbnail_150,avatarLetter:null==m||null===(u=m.title)||void 0===u?void 0:u[0],avatarAlt:null==m?void 0:m.title});var ue=null==m||null===(t=m.members)||void 0===t?void 0:t.find((function(e){var t;return(null==e||null===(t=e.user)||void 0===t?void 0:t.id)===k.id})),me=null==m||null===(n=m.members)||void 0===n?void 0:n.find((function(e){return"OWNER"===e.role})),he=(null==me||null===(a=me.user)||void 0===a?void 0:a.id)===k.id;return(0,i.useEffect)((function(){"draft_message"in m&&null!=m&&m.draft_message&&!P&&F(m.draft_message)}),[m]),(0,v.jsx)(Ne.F,{isFetched:!0,HeaderActions:(0,v.jsxs)(v.Fragment,{children:[H?(0,v.jsx)("div",{className:"mr-4",children:(0,v.jsx)(B.Dg,{className:"text-kgrey-menuText"})}):null,R||he||null!=ue&&ue.is_allowed_add_user||null!=ue&&ue.is_allowed_remove_user?(0,v.jsx)("button",{className:"flex-centered mr-2 h-8 w-8 rounded-full bg-primary text-white transition hover:bg-primary-dark active:translate-y-0.5 active:shadow-inner",onClick:Y,children:(0,v.jsx)(g.Zev,{})}):(0,v.jsx)("button",{className:"flex-centered h-8 w-8 rounded-full bg-primary text-white transition hover:bg-primary-dark active:translate-y-0.5 active:shadow-inner",onClick:V,children:(0,v.jsx)(Ke.WY8,{})}),(0,v.jsx)(ee,{handleModalOpen:Y,open:X,noPadding:!0,cropRounded:!0,children:(0,v.jsx)(Ut,{onSuccess:Y})}),(0,v.jsx)(Q,{handleModalOpen:V,open:$,children:(0,v.jsx)(Ve,{})}),(0,v.jsx)("button",{className:"flex-centered mx-2 h-8 w-8 rounded-full bg-primary text-white transition hover:bg-primary-dark active:translate-y-0.5 active:shadow-inner",onClick:U,children:(0,v.jsx)(g.RB5,{})}),(0,v.jsx)("div",{className:"more-btn w-4 cursor-pointer text-right text-kdark-dark333 transition hover:text-primary dark:text-white dark:hover:text-primary",onClick:ae,children:(0,v.jsx)(g.fXH,{className:"inline text-3xl"})}),(0,v.jsx)(L.v2,{id:"long-menu",style:{left:p?"-4%":0},anchorEl:ie,keepMounted:!0,open:ne,classes:{paper:S.paper},onClose:se,children:h?(0,v.jsx)(He,{image:null==m?void 0:m.image,title:null==m?void 0:m.title,membersCount:null==m||null===(s=m.members)||void 0===s?void 0:s.length,isMuted:null==ue?void 0:ue.is_mute,chatId:m.id,memberId:null==ue?void 0:ue.id,isOwner:he}):null}),(0,v.jsx)("button",{className:(0,C.Z)("flex-center-y border-border-solid  px-4 py-2 text-kred-pink transition hover:opacity-80",{"border-l lg:ml-4":!p,"border-r lg:mr-4":p}),type:"button",onClick:function(){A&&E(!1),M(),null==I||I(),b in re&&K("user",{message:j,editingMessage:w,reply:Z,entityId:b});try{q({entity:"ims-chats",entityId:null==m?void 0:m.id,updatingData:{last_read_message:_}})}catch(e){}},children:(0,v.jsx)("div",{className:"icon ",children:(0,v.jsx)(Ae.bjh,{})})})]}),mainText:le,data:ce,pinnedMessage:{title:null==m||null===(r=m.pinned_message)||void 0===r?void 0:r.text,id:null==m||null===(c=m.pinned_message)||void 0===c?void 0:c.id},scrollToHandler:x})}function Wt(e){return(0,v.jsx)(m.SV,{children:(0,v.jsx)(Ht,(0,S.Z)({},e))})}function $t(e){var t,n=e.isUnreadFilterActive,a=(0,x.$G)().t,i=(0,o.Kx)(),s=i.query,r=i.removeQueryParams,c=(0,o.eC)().showNotification,d=(0,l.m)(),u=d.companyId,m=d.groupSearchQuery,h=Number("chat"in s?s.chat:void 0),p=(0,J.a)().userData,g=(0,o.s6)({entity:"ims-chats",entityName:"AllImsChats-".concat(u,"-").concat(m)}).all;return(0,v.jsx)(v.Fragment,{children:h&&u?(0,v.jsx)(Y.Z.One,{id:String(h),relations:"",entity:"ims-chats",name:"GroupChat-".concat(h),url:"/".concat(u,"/ims/groups/").concat(h,"/"),params:{},onError:function(e){var t;404===(null==e||null===(t=e.response)||void 0===t?void 0:t.status)&&(r(),c({variant:"error",message:"You don't have access to the chat."}))},children:function(e){var t,n=e.item,a=e.isFetched,i=(0,S.Z)({},n),s=null==i||null===(t=i.members)||void 0===t?void 0:t.find((function(e){var t;return(null==e||null===(t=e.user)||void 0===t?void 0:t.id)===p.id}));return(0,v.jsx)(de.Rv,{entityId:h,entityType:"ims",children:(0,v.jsx)(de.GR,{children:(0,v.jsx)(de.eo,{entityId:h,entityType:"ims",children:(0,v.jsx)(se.g,{ChatHeader:(0,v.jsx)(Wt,{isFetched:a,imsData:i}),ChatBody:(0,v.jsx)(xe,{chatId:h}),ChatInput:(0,v.jsx)(je,{isAllowedSendMsg:null==s?void 0:s.is_allowed_send_msg})})})})})}}):(0,v.jsx)("div",{className:"flex-centered h-full w-full text-xl font-semibold dark:text-white",children:null!=g&&null!==(t=g.items)&&void 0!==t&&t.length?a("select_group_chat"):a(n?"have_no_unread_group-chats":"have_no_group_chats")})})}function Vt(e){return(0,v.jsx)(m.SV,{children:(0,v.jsx)($t,(0,S.Z)({},e))})}var Qt=n(54270),qt=n(30014),zt=n(17447),Xt=n(96263),Yt=n.n(Xt);function Jt(e){var t=e.searchQuery,n=e.messageText;if(t){var a=t.split(/\s/).filter((function(e){return e})),i=""+(0,E.H$)(n,t,25);return(0,v.jsx)("span",{children:(0,v.jsx)(Yt(),{highlightClassName:"highlighted",searchWords:a,autoEscape:!0,textToHighlight:i})})}return(0,v.jsx)("span",{children:n})}var en=function(e){var t,n,a,i,s=e.message,r=e.listItemClickHandler,l=e.searchQuery,o="".concat(null===(t=s.from_user)||void 0===t?void 0:t.first_name," ").concat(null===(n=s.from_user)||void 0===n?void 0:n.last_name),c=null==s||null===(a=s.from_user)||void 0===a||null===(i=a.avatar)||void 0===i?void 0:i.thumbnail_150;return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsxs)(ot.Z,{onClick:function(){return r(s.message_id)},className:"hover:bg-kprimary-200 cursor-pointer transition",children:[(0,v.jsx)(ct.Z,{children:(0,v.jsx)(it.Z,{alt:o,src:c})}),(0,v.jsx)(dt.Z,{className:"dark:text-white",primary:o,secondary:(0,v.jsx)(Jt,{messageText:(null==s?void 0:s.text)||"",searchQuery:l})})]}),(0,v.jsx)(zt.Z,{variant:"inset",component:"li"})]})};function tn(){var e=(0,x.$G)().t,t=(0,N.K)().isRTL,n=(0,i.useState)(1),s=(0,a.Z)(n,2),r=s[0],c=s[1],d=(0,l.m)(),u=d.groupSearchOpen,h=d.companyId,p=d.setGroupMessageSearchQuery,f=(0,o.A3)(),_=f.query,b=f.setQuery,y=f.searchQuery,j=qe().toggleSearchSidebar,Z=(0,o.Kx)().query,w=(0,o.Kx)().changeUrlParams,k=(0,i.useRef)(null),S=null==Z?void 0:Z.chat,M=(0,i.useCallback)((function(e){y.length>0&&w({chat:Number(Z.chat),searchedMessageId:e})}),[y,Z,w]);(0,i.useEffect)((function(){u&&k.current&&setTimeout((function(){(null==k?void 0:k.current).focus()}),300)}),[u]),(0,i.useEffect)((function(){p(y)}),[y]),(0,i.useEffect)((function(){return function(){b("")}}),[S]);return(0,v.jsxs)("div",{className:(0,C.Z)("flex h-full flex-col border-l p-1 pr-2 dark:bg-kdark-dark333",{"border-r":t}),children:[(0,v.jsxs)("div",{className:"flex items-center justify-between",children:[(0,v.jsx)(mt.Z,{"aria-label":"close",onClick:function(){w({chat:Number(Z.chat)},!0),j()},className:"!mr-1",children:(0,v.jsx)(qt.Z,{})}),(0,v.jsxs)("div",{className:"search-input relative flex-grow",children:[(0,v.jsx)("input",{type:"search",className:(0,C.Z)("group-search-input w-full rounded border p-2  transition focus:outline-none focus:ring focus:ring-primary dark:bg-kdark-lighter dark:text-white",{"pr-4":!t,"pl-4":t}),value:_,onChange:function(e){c(1),b(e.target.value)},ref:k,placeholder:e("type_message_keyword")}),(0,v.jsx)("div",{className:(0,C.Z)("hover:text-kprimary absolute top-3 cursor-pointer",{"right-5":!t,"left-2.5":t}),children:_.length?null:(0,v.jsx)(g.RB5,{})})]})]}),(0,v.jsx)("div",{className:"content flex-grow",children:(0,v.jsx)(v.Fragment,{children:(0,v.jsx)(We.$B,{className:"rct-scroll",autoHide:!0,style:{height:"calc(100vh - 104px)"},onScroll:function(){},children:(0,v.jsx)(vt.Z,{className:"mb-0 p-0",children:y.length&&h?(0,v.jsx)(Y.Z.All,{entity:"search-messages",name:"".concat(h,"-AllSearchMessages-").concat(S),url:"/".concat(h,"/ims/message_search/"),appendData:!0,params:{page:r,limit:20,extra:{search:y,group_chat_id:S}},primaryKey:"message_id",children:function(t){var n=t.isFetched,a=t.items,i=t.meta;return!a.length&&y&&n?(0,v.jsx)("p",{className:"p-4 !text-xl font-bold dark:text-white",children:e("no_messages_found")}):(0,v.jsxs)(v.Fragment,{children:[a.map((function(e){return(0,v.jsx)(en,{searchQuery:y,listItemClickHandler:M,message:e},e.message_id)})),!n&&(0,v.jsx)("div",{style:{textAlign:"center"},children:(0,v.jsx)(m.aN,{})}),n&&null!=i&&i.current_page&&null!=i&&i.last_page&&(null==i?void 0:i.current_page)<(null==i?void 0:i.last_page)?(0,v.jsx)(m.$K,{setPage:function(){return c((function(e){return e+1}))}}):null]})}}):(0,v.jsx)("p",{className:"!p-4 dark:text-white",children:e("please_search_for_messages")})})})})})]})}var nn=285,an=28,sn=362,rn=8,ln=285,on=77,cn=61;function dn(){!function(){var e=(0,l.m)(),t=e.setPageType,n=e.companyId,a=(0,o.O4)().fetchCompanyAllUnreadCounts;(0,i.useEffect)((function(){n&&a({groupUnread:!0})}),[n]),(0,i.useEffect)((function(){return t(!0),function(){t(!1)}}),[t])}();var e=(0,o.gQ)("Group chats"),t=e.unreadCasesQuantity,n=e.isHidden,s=(0,o.Kx)().query,r=(0,l.m)(),c=r.setGroupSearchOpen,d=r.groupSearchOpen,u=r.groupsUnreadCountData,m=r.setStatusPriorityMessagePopup,h=r.statusPriorityMessagePopup,p=r.navCollapsed,g=(0,o.iP)().width,f=(0,i.useState)(!1),x=(0,a.Z)(f,2),v=x[0],_=x[1],b=(0,N.K)().isRTL,y=(0,i.useCallback)((function(){_((function(e){return!e}))}),[]),j=function(){return m(null)};(0,i.useEffect)((function(){var e;!v||null!==(e=Object.values(u))&&void 0!==e&&e.filter((function(e){return e>0})).length||_(!1)}),[u]),(0,i.useEffect)((function(){return function(){c(!1)}}),[]);var Z=g-(p?cn:nn)-an-sn-rn-ln,w=g-nn-an-sn-rn;return(0,V.BX)("div",{className:(0,C.Z)("flex h-full w-full flex-col pb-1 lg:pt-7",{"pl-2 lg:pl-7":!b,"pr-2 lg:pr-7":b}),children:[(0,V.BX)("div",{className:"relative flex h-full",children:[(!n||0===t)&&(0,V.tZ)(Qt.q,{children:(0,V.tZ)("title",{children:"KENNEKT | Group chats"})}),(0,V.tZ)("div",{className:(0,C.Z)("w-full flex-shrink-0 transition-all",{hidden:s.chat&&le.tq,"lg:w-[362px]":!d,"lg:w-[285px]":d,"lg:ml-2":b,"lg:mr-2":!b}),children:(0,V.BX)("div",{className:"group-sidebar flex h-full flex-col pt-4 font-poppins lg:pt-0",children:[(0,V.tZ)(k,{isUnreadFilter:v,toggleIsUnreadFilter:y}),(0,V.tZ)(ne,{isUnreadFilter:v})]})}),(0,V.tZ)("div",{className:(0,C.Z)(!d&&"flex-grow","transition-all"),style:{width:d?"".concat(Z+on,"px"):w},children:(0,V.tZ)(Vt,{isUnreadFilterActive:v})}),(0,V.BX)("div",{className:(0,C.Z)("message-search bottom-o absolute top-0 h-full w-[285px] bg-white transition",{"translate-x-[285px]":!d&&!b,"translate-x-0":d&&!b},{"translate-x-[-285px]":!d&&b,"translate-x-0":d&&b},{"left-0":b,"right-0":!b}),children:[(0,V.tZ)(tn,{}),(0,V.tZ)("span",{className:" hidden focus:ring-2 focus:ring-primary"})]})]}),(0,V.tZ)(L.Cx,{handleModalOpen:j,open:"group"===(null==h?void 0:h.type),maxWidth:446,children:(0,V.tZ)(ce.Rd,{onClose:j})})]})}function un(){return(0,V.tZ)(m.SV,{children:(0,V.tZ)(dn,{})})}},6008:function(e,t,n){n.d(t,{o:function(){return c}});var a=n(1413),i=(n(72791),n(5088)),s=n(38596),r=n(6330),l=n(80184),o=(0,s.Z)((function(e){return(0,r.Z)({root:{border:"1px solid #B8BCCF",fontSize:"15px",lineHeight:1,borderRadius:"12px",padding:"10px 30px",fontWeight:300,width:"100%"},input:{padding:0}})}));function c(e){var t=o();return(0,l.jsx)(i.Z,(0,a.Z)({classes:{root:t.root,input:t.input}},e))}t.Z=c},22906:function(e,t,n){n.d(t,{B:function(){return m.B}});var a=n(6008),i=n(1413),s=(n(72791),n(5088)),r=n(38596),l=n(6330),o=n(1288),c=n(13880),d=n(80184),u=(0,r.Z)((function(e){return(0,l.Z)({root:{border:"1px solid #B8BCCF",fontSize:"15px",lineHeight:1,borderRadius:"12px",padding:"10px 40px 10px 20px",fontWeight:300,width:"100%"},input:{padding:0},gridContainer:{position:"relative"},iconRoot:{position:"absolute",top:"50%",transform:"translateY(-50%)",fontSize:"22px",width:"22px",height:"22px",right:"15px"},svgRoot:{position:"absolute"}})}));var m=n(86053);a.o,m.B}}]);
//# sourceMappingURL=3814.6b811ea8.chunk.js.map