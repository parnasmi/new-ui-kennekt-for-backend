"use strict";(self.webpackChunkkennekt_front_end_client=self.webpackChunkkennekt_front_end_client||[]).push([[8969],{68969:function(e,t,n){n.r(t),n.d(t,{default:function(){return R}});var a=n(1413),s=n(70885),r=n(90325),i=n(57718),l=n(90182),c=n(79513),o=n(28303),u=n(63830),d=n(47313),m=n(31172),p=n(95762),h=n(26926),f=n(44329),x=n(77344),b=n(46417),j=(0,d.createContext)(null),y=function(e,t){return"SET_SEARCH_QUERY"===t.type?(0,a.Z)((0,a.Z)({},e),{},{searchQuery:t.payload}):e};function _(e){var t=e.children,n=(0,d.useReducer)(y,{searchQuery:""}),a=(0,s.Z)(n,2),r=a[0],i=a[1],l=(0,d.useCallback)((function(e){i({type:"SET_SEARCH_QUERY",payload:e})}),[]),c={searchQuery:r.searchQuery,setSearchQuery:l};return(0,b.jsx)(j.Provider,{value:c,children:t})}var v=function(){var e=(0,d.useContext)(j);if(!e)throw new Error("useBusinessContext must be used within the BusinessContextProvider");return e},g=n(94024);function k(e){var t=e.type,n=(0,x.m)().companyId,a=(0,i.h0)(),r=a.page,l=a.handlePage,o=(0,u.TH)(),d=v().searchQuery,j=(0,g.Z)(d,500),y=(0,s.Z)(j,1)[0],_=m.parse(o.search),k=_.department,S=_.sub_department,Z=_.status;return t&&[!!k,!!S,!!Z].every((function(e){return!e}))?(0,b.jsx)("h2",{className:"dark:text-white",children:"Please select from department or status"}):(0,b.jsx)("div",{children:n?(0,b.jsx)(p.Z.All,{entity:"AllCases",name:"AllCasesList",url:"/".concat(n,"/cases/as_business/cases_for_admin/"),params:{limit:10,extra:{department:k,sub_department:S,status:Z,search:y},page:r},children:function(e){var t=e.items,n=(e.isFetched,e.meta),a=t.map((function(e){return e}));return(0,b.jsxs)("div",{children:[(0,b.jsx)(h.xJ,{classes:{root:"relative "},children:(0,b.jsxs)(c.k6,{"aria-label":"simple table",classes:{root:"table-fixed dark-mode-styled-table"},children:[(0,b.jsx)(h.ss,{children:(0,b.jsxs)(c.AF,{children:[(0,b.jsx)(c.EU,{children:"Case #"}),(0,b.jsx)(c.EU,{children:"Case title"}),(0,b.jsx)(c.EU,{children:"Created by"}),(0,b.jsx)(c.EU,{children:"Department"}),(0,b.jsx)(c.EU,{children:"SubDepartment"}),(0,b.jsx)(c.EU,{children:"Created date"}),(0,b.jsx)(c.EU,{children:"Status"}),(0,b.jsx)(c.EU,{children:"Priority"})]})}),(0,b.jsx)(h.RM,{children:a.map((function(e){var t=e.id,n=e.case_number,a=e.title,s=e.created_by,r=e.department,i=e.sub_department,l=e.created_date,o=e.status,u=e.priority;return(0,b.jsxs)(c.AF,{children:[(0,b.jsx)(c.Yk,{children:n}),(0,b.jsx)(c.Yk,{children:(0,b.jsx)("div",{className:"truncate",children:a})}),(0,b.jsx)(c.Yk,{children:"".concat(s.first_name," ").concat(s.last_name)}),(0,b.jsx)(c.Yk,{children:null===r||void 0===r?void 0:r.name}),(0,b.jsx)(c.Yk,{children:null===i||void 0===i?void 0:i.name}),(0,b.jsx)(c.Yk,{children:l}),(0,b.jsx)(c.Yk,{children:o.title}),(0,b.jsx)(c.Yk,{children:u})]},t)}))})]})}),(0,b.jsx)("div",{className:"news__pagination my-4 flex items-center justify-between",children:(0,b.jsx)(f.Z,{count:null===n||void 0===n?void 0:n.last_page,page:r?+r:1,defaultPage:6,siblingCount:1,color:"primary",onChange:l})})]})}}):(0,b.jsx)("div",{className:"flex justify-center",children:(0,b.jsx)(c.aN,{})})})}function S(e){return(0,b.jsx)(c.SV,{children:(0,b.jsx)(k,(0,a.Z)({},e))})}var Z=n(42982),C=n(94715),w=n(61818),N=n(22934),E=n(46225),U=n(69706),A=n.n(U),P=n(95585),T=n.n(P);var Q=n(17480);function V(e){var t=e.type,n=function(e){var t=e.isFromAllCasesPage,n=void 0!==t&&t,r=(e.type,(0,x.m)()),i=r.caseType,l=r.selectedCaseFilter[i],c=(0,d.useState)({flatSubdepartments:{}}),o=(0,s.Z)(c,2),u=o[0],m=o[1],p=u.flatSubdepartments,h=function(e,t){m((function(n){return(0,a.Z)((0,a.Z)({},n),{},{flatSubdepartments:{departments:e,sub_departments:(0,Z.Z)(new Set(t))}})}))},f=function(e,t){var n=(null!==e&&void 0!==e&&e.length?e.reduce((function(e,t){return[].concat((0,Z.Z)(e),[[t.hierarchy[t.hierarchy.length-2].id,t.hierarchy[t.hierarchy.length-1].id]])}),[]):[]).reduce((function(e,t){var n=(0,s.Z)(t,2),r=n[0],i=n[1];return(0,a.Z)((0,a.Z)({},e),{},{departments:[].concat((0,Z.Z)(e.departments),[r]),sub_departments:[].concat((0,Z.Z)(e.sub_departments),[i])})}),{departments:[],sub_departments:[]}),r=null!==e&&void 0!==e&&e.length?e.reduce((function(e,t){return[].concat((0,Z.Z)(e),[t.hierarchy[0].id])}),[]):[],i=t.reduce((function(e,t){return[].concat((0,Z.Z)(e),[t.id])}),[]),l=n.sub_departments.filter((function(e){return!n.departments.includes(e)})),c=(0,Z.Z)(new Set(i)).filter((function(e){return!r.includes(e)}));return h(c,l),{departments:c,sub_departments:(0,Z.Z)(new Set(l))}};return(0,d.useEffect)((function(){if(!n){var e=null===l||void 0===l?void 0:l.filter_json,t=e.sub_department,a=e.department;T()(a)&&a.length>0&&(null!==l&&void 0!==l&&l.filter_json.sub_department&&f(t,a),a&&!t&&h(a.map((function(e){return e.id})),[]))}}),[l]),{flatSubdepartments:p,initialValues:{status:A()(l,"filter_json.status",[]),clientType:A()(l,"filter_json.clientType",{}),client_company:A()(l,"filter_json.client_company",{}),client_user:A()(l,"filter_json.client_user",{}),department:A()(l,"filter_json.department",[]),priority:A()(l,"filter_json.priority",[]),search:A()(l,"filter_json.search",""),sub_department:A()(l,"filter_json.sub_department",[]),unread:A()(l,"filter_json.unread",""),unresponded:A()(l,"filter_json.unresponded",""),rating:A()(l,"filter_json.rating",{}),member:A()(l,"filter_json.member",[]),assignees:A()(l,"filter_json.assignees",[])},makeFlatSubdepartments:f,setDepartments:h}}({isFromAllCasesPage:!0,type:t}),r=n.makeFlatSubdepartments,i=n.setDepartments,l=n.initialValues,o=(0,x.m)().companyId,p=v().setSearchQuery,h=(0,u.TH)(),f=(0,u.k6)();return(0,b.jsx)(C.J9,{onSubmit:function(e,n){var s,i=n.setSubmitting,l=m.parse(h.search),c=t&&"department-".concat(t)in e&&null!==(s=e["department-".concat(t)])&&void 0!==s&&s.length?r(e["sub_department-".concat(t)],e["department-".concat(t)]):{},o={department:c.departments?c.departments.join(","):[],sub_department:c.sub_departments?c.sub_departments.join(","):[],search:A()(e,"search",""),page:1,status:Array.isArray(A()(e,"status-".concat(t)))?A()(e,"status-".concat(t)).reduce((function(e,t){return[].concat((0,Z.Z)(e),[t.id])}),[]).join(","):""};f.push({search:m.stringify((0,a.Z)((0,a.Z)({},l),o),{encode:!1})}),i(!1)},initialValues:l,enableReinitialize:!0,children:function(e){var n=e.handleSubmit,a=e.values,s=e.setFieldValue,l=e.isSubmitting,u=Array.isArray(a["department-".concat(t)])&&a["department-".concat(t)].filter((function(e){return e.sub_departments_count>0}));return(0,b.jsxs)("form",{onSubmit:n,children:[(0,b.jsx)("div",{className:"flex w-full my-4 w-full react-select-dropdown flex-wrap items-center",children:t?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{className:"w-[300px] my-2 mr-3",children:(0,b.jsx)(C.gN,{label:"Status:",labelClasses:"ml-2 text-sm font-light text-kgrey-welcome mb-2 block",component:w.Z,customStylesProps:N.C2,title:"Status",optionLabel:"title",optionValue:"id",loadOptionsUrl:"/".concat(o,"/my/company/case_statuses/"),loadOptionsParams:function(e){return{extra:{search:e,is_staff:"staff"===t?"true":"false"}}},reverse:!0,isSearchable:!E.tq,name:"status-".concat(t),loadOptionsKey:"",placeholder:"Status",maxMenuHeight:220,isMulti:!0})}),(0,b.jsxs)("div",{className:"flex flex-wrap items-center",children:[(0,b.jsx)("div",{className:"w-[300px] my-2 mr-3",children:(0,b.jsx)(C.gN,{label:"".concat(t," departments"),labelClasses:"ml-2 text-sm font-light capitalize text-kgrey-welcome mb-2 block",component:w.Z,title:"Department",optionLabel:"name",optionValue:"id",loadOptionsUrl:"/".concat(o,"/departments/"),loadOptionsParams:function(e){return{extra:{search:e,is_staff:"staff"===t?"true":"false"}}},isSearchable:!E.tq,name:"department-".concat(t),loadOptionsKey:"results",placeholder:"Select Department",isMulti:!0,customStylesProps:N.C2,onChange:function(e){s("sub_department-".concat(t),void 0),i(e?e.map((function(e){return e.id})):[],[])}})}),u.length>0&&(0,b.jsxs)("div",{className:" w-[300px] my-2 mr-3",children:[(0,b.jsx)("div",{className:"!ml-2 !text-sm font-light capitalize text-kgrey-welcome mb-2 block",children:"".concat(t," departments")}),(0,b.jsx)(C.gN,{component:Q.X4,title:"Sub Department",optionLabel:function(e){return"".concat(A()(e,"department.name")," [").concat(A()(e,"name"),"]")},name:"sub_department-".concat(t),optionValue:"id",customStylesProps:N.C2,loadOptionsUrl:"/".concat(o,"/departments/sub_departments/"),loadOptionsParams:function(e){return{extra:{search:e,department_ids:A()(a,"department-".concat(t)).reduce((function(e,t){return[].concat((0,Z.Z)(e),[t.id])}),[]).join(",")}}},onChange:function(e){e?r(e,a["department-".concat(t)]):i(a["department-".concat(t)].map((function(e){return null===e||void 0===e?void 0:e.id})),[])},loadOptionsKey:"results",placeholder:"Select Sub Department",isMulti:!0,isSearchable:!E.tq})]})]}),(0,b.jsx)(c.Ik,{type:"submit",className:"dark:hover:bg-primary-300 mb-2 mt-8 dark:focus:ring-primary-300 dark:text-white",color:"primary",isSubmitting:l,children:"Apply"})]}):null}),(0,b.jsx)("div",{className:"w-1/4",children:(0,b.jsx)(C.gN,{label:"Search",labelClasses:"ml-2 text-sm font-light text-kgrey-welcome mb-2 block",name:"title",component:Q.Mg,inputElementClassNames:"!text-15px font-light text-kdark-424653 dark:text-white",placeholder:"Case title",onChangeHandler:function(e){p(e.target.value)}})})]})}})}function F(e){return(0,b.jsx)(c.SV,{children:(0,b.jsx)(V,(0,a.Z)({},e))})}function Y(e){var t=e.type;return(0,b.jsxs)("div",{children:[(0,b.jsx)(F,{type:t}),(0,b.jsx)(S,{type:t})]})}function O(e){return(0,b.jsx)(c.SV,{children:(0,b.jsx)(Y,(0,a.Z)({},e))})}function D(e){return{id:"simple-tab-".concat(e),"aria-controls":"simple-tabpanel-".concat(e)}}function H(e){var t=e.match,n=(0,i.gQ)("All Cases"),p=n.unreadCasesQuantity,h=n.isHidden,f=(0,d.useState)(0),x=(0,s.Z)(f,2),j=x[0],y=x[1],_=t.url,v=(0,u.k6)(),g=(0,u.TH)(),k=m.parse(g.search);console.log("query",k),(0,d.useEffect)((function(){switch(k.type){case"":default:y(0);break;case"client":y(1);break;case"staff":y(2)}}),[k.type]);var S=function(e){v.push({search:m.stringify((0,a.Z)({},e?{type:e}:{}),{encode:!1})})};return(0,b.jsx)(r.d,{children:(0,b.jsxs)("div",{className:"profile",children:[(!h||0===p)&&(0,b.jsx)(l.q,{children:(0,b.jsx)("title",{children:"KENNEKT | User profile"})}),(0,b.jsxs)("div",{className:"content",children:[(0,b.jsx)("div",{className:"prime-tabs prime-tabs_no-bottom-extend",children:(0,b.jsxs)(c.sJ.Tabs,{scrollButtons:"auto",variant:"scrollable",value:j,onChange:function(e,t){switch(t){case 0:S();break;case 1:S("client");break;case 2:S("staff");break;default:return null}y(t)},"aria-label":"simple tabs example",children:[(0,b.jsx)(c.sJ.Tab,(0,a.Z)({label:"All",component:o.rU,to:_},D(0))),(0,b.jsx)(c.sJ.Tab,(0,a.Z)({label:"Clients cases",component:o.rU,to:"".concat(_,"?type=client")},D(1))),(0,b.jsx)(c.sJ.Tab,(0,a.Z)({label:"Staff cases",component:o.rU,to:"".concat(_,"?type=staff")},D(2)))]})}),(0,b.jsx)("div",{className:"business-profile-tab-content",children:(0,b.jsx)(O,{type:k.type||null})})]})]})})}var R=function(e){return(0,b.jsx)(c.SV,{children:(0,b.jsx)(_,{children:(0,b.jsx)(H,(0,a.Z)({},e))})})}}}]);